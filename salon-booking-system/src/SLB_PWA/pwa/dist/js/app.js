(function(){var e={5358:function(e,t,s){var i={"./af":5639,"./af.js":5639,"./ar":8355,"./ar-dz":8214,"./ar-dz.js":8214,"./ar-kw":6870,"./ar-kw.js":6870,"./ar-ly":9979,"./ar-ly.js":9979,"./ar-ma":3106,"./ar-ma.js":3106,"./ar-ps":7001,"./ar-ps.js":7001,"./ar-sa":2408,"./ar-sa.js":2408,"./ar-tn":4186,"./ar-tn.js":4186,"./ar.js":8355,"./az":5483,"./az.js":5483,"./be":4061,"./be.js":4061,"./bg":923,"./bg.js":923,"./bm":8645,"./bm.js":8645,"./bn":8908,"./bn-bd":9871,"./bn-bd.js":9871,"./bn.js":8908,"./bo":4371,"./bo.js":4371,"./br":7272,"./br.js":7272,"./bs":1887,"./bs.js":1887,"./ca":4024,"./ca.js":4024,"./cs":5362,"./cs.js":5362,"./cv":813,"./cv.js":813,"./cy":6832,"./cy.js":6832,"./da":987,"./da.js":987,"./de":1391,"./de-at":1293,"./de-at.js":1293,"./de-ch":755,"./de-ch.js":755,"./de.js":1391,"./dv":6818,"./dv.js":6818,"./el":5389,"./el.js":5389,"./en-au":7122,"./en-au.js":7122,"./en-ca":8048,"./en-ca.js":8048,"./en-gb":6509,"./en-gb.js":6509,"./en-ie":7930,"./en-ie.js":7930,"./en-il":4417,"./en-il.js":4417,"./en-in":8895,"./en-in.js":8895,"./en-nz":404,"./en-nz.js":404,"./en-sg":7270,"./en-sg.js":7270,"./eo":804,"./eo.js":804,"./es":1456,"./es-do":2404,"./es-do.js":2404,"./es-mx":884,"./es-mx.js":884,"./es-us":4557,"./es-us.js":4557,"./es.js":1456,"./et":5253,"./et.js":5253,"./eu":6294,"./eu.js":6294,"./fa":2005,"./fa.js":2005,"./fi":1405,"./fi.js":1405,"./fil":9637,"./fil.js":9637,"./fo":7439,"./fo.js":7439,"./fr":4812,"./fr-ca":4045,"./fr-ca.js":4045,"./fr-ch":4534,"./fr-ch.js":4534,"./fr.js":4812,"./fy":2141,"./fy.js":2141,"./ga":9500,"./ga.js":9500,"./gd":4471,"./gd.js":4471,"./gl":8671,"./gl.js":8671,"./gom-deva":282,"./gom-deva.js":282,"./gom-latn":5237,"./gom-latn.js":5237,"./gu":2944,"./gu.js":2944,"./he":59,"./he.js":59,"./hi":8471,"./hi.js":8471,"./hr":4882,"./hr.js":4882,"./hu":8315,"./hu.js":8315,"./hy-am":4126,"./hy-am.js":4126,"./id":5681,"./id.js":5681,"./is":7604,"./is.js":7604,"./it":8849,"./it-ch":3053,"./it-ch.js":3053,"./it.js":8849,"./ja":9289,"./ja.js":9289,"./jv":4780,"./jv.js":4780,"./ka":8848,"./ka.js":8848,"./kk":9650,"./kk.js":9650,"./km":5508,"./km.js":5508,"./kn":9981,"./kn.js":9981,"./ko":3710,"./ko.js":3710,"./ku":5052,"./ku-kmr":3355,"./ku-kmr.js":3355,"./ku.js":5052,"./ky":296,"./ky.js":296,"./lb":5062,"./lb.js":5062,"./lo":7361,"./lo.js":7361,"./lt":4288,"./lt.js":4288,"./lv":2554,"./lv.js":2554,"./me":7966,"./me.js":7966,"./mi":6925,"./mi.js":6925,"./mk":4688,"./mk.js":4688,"./ml":4837,"./ml.js":4837,"./mn":2995,"./mn.js":2995,"./mr":2127,"./mr.js":2127,"./ms":7768,"./ms-my":195,"./ms-my.js":195,"./ms.js":7768,"./mt":8621,"./mt.js":8621,"./my":8890,"./my.js":8890,"./nb":8724,"./nb.js":8724,"./ne":9377,"./ne.js":9377,"./nl":3578,"./nl-be":5534,"./nl-be.js":5534,"./nl.js":3578,"./nn":6256,"./nn.js":6256,"./oc-lnc":332,"./oc-lnc.js":332,"./pa-in":4499,"./pa-in.js":4499,"./pl":932,"./pl.js":932,"./pt":4124,"./pt-br":845,"./pt-br.js":845,"./pt.js":4124,"./ro":8419,"./ro.js":8419,"./ru":6426,"./ru.js":6426,"./sd":9819,"./sd.js":9819,"./se":4148,"./se.js":4148,"./si":1680,"./si.js":1680,"./sk":9002,"./sk.js":9002,"./sl":9043,"./sl.js":9043,"./sq":9416,"./sq.js":9416,"./sr":9553,"./sr-cyrl":5360,"./sr-cyrl.js":5360,"./sr.js":9553,"./ss":5650,"./ss.js":5650,"./sv":5981,"./sv.js":5981,"./sw":2766,"./sw.js":2766,"./ta":696,"./ta.js":696,"./te":783,"./te.js":783,"./tet":1203,"./tet.js":1203,"./tg":6305,"./tg.js":6305,"./th":5404,"./th.js":5404,"./tk":8453,"./tk.js":8453,"./tl-ph":7373,"./tl-ph.js":7373,"./tlh":8266,"./tlh.js":8266,"./tr":6942,"./tr.js":6942,"./tzl":4112,"./tzl.js":4112,"./tzm":183,"./tzm-latn":1649,"./tzm-latn.js":1649,"./tzm.js":183,"./ug-cn":6112,"./ug-cn.js":6112,"./uk":8360,"./uk.js":8360,"./ur":1671,"./ur.js":1671,"./uz":8655,"./uz-latn":553,"./uz-latn.js":553,"./uz.js":8655,"./vi":7533,"./vi.js":7533,"./x-pseudo":3741,"./x-pseudo.js":3741,"./yo":563,"./yo.js":563,"./zh-cn":2570,"./zh-cn.js":2570,"./zh-hk":3462,"./zh-hk.js":3462,"./zh-mo":9675,"./zh-mo.js":9675,"./zh-tw":46,"./zh-tw.js":46};function o(e){var t=a(e);return s(t)}function a(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=5358},8753:function(e,t,s){"use strict";var i=s(1469),o=s(6436);function a(e,t,s,i,a,n){const l=(0,o.g2)("TabsList"),r=(0,o.g2)("PWAPrompt");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(l,{onApplyShop:n.applyShop,isShopsEnabled:n.isShopsEnabled},null,8,["onApplyShop","isShopsEnabled"]),(0,o.bF)(r)])}var n=s(7959);function l(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("ShopsTab"),u=(0,o.g2)("b-tab"),c=(0,o.g2)("ShopTitle"),h=(0,o.g2)("UpcomingReservationsTab"),m=(0,o.g2)("ReservationsCalendarTab"),g=(0,o.g2)("CustomersAddressBookTab"),p=(0,o.g2)("UserProfileTab"),f=(0,o.g2)("b-tabs");return(0,o.uX)(),(0,o.CE)("div",{class:(0,n.C4)({"hide-tabs-header":e.isHideTabsHeader})},[(0,o.bF)(f,{pills:"",card:"",end:""},{default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(u,{key:0,active:l.isActiveTab("#shops"),"title-item-class":{hide:!s.isShopsEnabled}},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[0]||(t[0]=e=>l.click("#shops"))},[(0,o.bF)(r,{icon:"fa-solid fa-store"})])]),default:(0,o.k6)(()=>[(0,o.bF)(d,{isShopsEnabled:s.isShopsEnabled,onApplyShop:l.applyShopAndSwitch},null,8,["isShopsEnabled","onApplyShop"])]),_:1},8,["active","title-item-class"])):(0,o.Q3)("",!0),(0,o.bF)(u,{active:l.isActiveTab("#upcoming-reservations")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[1]||(t[1]=t=>{l.click("#upcoming-reservations"),e.scrollInto()}),ref:"upcoming-reservations-tab-link"},[(0,o.bF)(r,{icon:"fa-solid fa-list"})],512)]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(c,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(h,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(u,{active:l.isActiveTab("#reservations-calendar")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[2]||(t[2]=e=>l.click("#reservations-calendar"))},[(0,o.bF)(r,{icon:"fa-solid fa-calendar-days"})])]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(c,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(m,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(u,{active:l.isActiveTab("#customers")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[3]||(t[3]=e=>l.click("#customers"))},[(0,o.bF)(r,{icon:"fa-regular fa-address-book"})])]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(c,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(g,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(u,{"title-item-class":"nav-item-profile",active:l.isActiveTab("#user-profile")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[4]||(t[4]=e=>l.click("#user-profile"))},[...t[5]||(t[5]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 27 30",class:"svg-inline--fa"},[(0,o.Lk)("g",{fill:"none",stroke:"currentcolor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3"},[(0,o.Lk)("path",{d:"M25.5 28.5v-3a6 6 0 0 0-6-6h-12a6 6 0 0 0-6 6v3"}),(0,o.Lk)("path",{d:"M19.5 7.5a6 6 0 1 1-6-6 6 6 0 0 1 6 6Z"})])],-1)])])]),default:(0,o.k6)(()=>[(0,o.bF)(p)]),_:1},8,["active"])]),_:1})],2)}function r(e,t,s,a,n,l){const r=(0,o.g2)("ImagesList"),d=(0,o.g2)("CustomersAddressBook"),u=(0,o.g2)("EditBookingItem"),c=(0,o.g2)("BookingDetails"),h=(0,o.g2)("UpcomingReservations");return(0,o.uX)(),(0,o.CE)("div",null,[e.isShowCustomerImages?((0,o.uX)(),(0,o.Wv)(r,{key:0,customer:e.showImagesCustomer,onClose:l.closeShowCustomerImages,onTakePhoto:e.showTakePhoto,takePhotoFile:e.photo},null,8,["customer","onClose","onTakePhoto","takePhotoFile"])):e.isChooseCustomer?((0,o.uX)(),(0,o.Wv)(d,{key:1,onCloseChooseCustomer:l.closeChooseCustomer,chooseCustomerAvailable:!0,onChoose:l.choose,shop:e.item.shop},null,8,["onCloseChooseCustomer","onChoose","shop"])):e.editItem?((0,o.uX)(),(0,o.Wv)(u,{key:2,booking:e.item,customer:e.customer,onClose:l.closeEditItem,onChooseCustomer:l.chooseCustomer},null,8,["booking","customer","onClose","onChooseCustomer"])):e.showItem?((0,o.uX)(),(0,o.Wv)(c,{key:3,booking:e.item,onClose:l.closeShowItem,onEdit:l.setEditItem,onShowCustomerImages:l.showCustomerImages},null,8,["booking","onClose","onEdit","onShowCustomerImages"])):(0,o.Q3)("",!0),(0,o.bo)((0,o.bF)(h,{onShowItem:l.setShowItem,shop:s.shop},null,8,["onShowItem","shop"]),[[i.aG,!e.showItem]])])}const d={class:"title"},u={class:"search"},c={class:"hours"},h={class:"attendants"},m={class:"bookings-list"},g={key:2,class:"no-result"};function p(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),p=(0,o.g2)("b-form-input"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-col"),v=(0,o.g2)("b-row"),b=(0,o.g2)("b-spinner"),_=(0,o.g2)("BookingItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",d,(0,n.v_)(this.getLabel("upcomingReservationsTitle")),1),(0,o.Lk)("div",u,[(0,o.bF)(r,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(p,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=t=>e.search=t),class:"search-input"},null,8,["modelValue"]),e.search?((0,o.uX)(),(0,o.Wv)(r,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:t[1]||(t[1]=t=>e.search="")})):(0,o.Q3)("",!0)]),(0,o.bF)(v,null,{default:(0,o.k6)(()=>[(0,o.bF)(k,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",c,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.hours,t=>((0,o.uX)(),(0,o.Wv)(f,{key:t.hours,onClick:s=>e.hourValue=t.hours,pressed:e.hourValue===t.hours,variant:"outline-primary"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.label),1)]),_:2},1032,["onClick","pressed"]))),128))])]),_:1})]),_:1}),(0,o.bF)(v,null,{default:(0,o.k6)(()=>[(0,o.bF)(k,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",h,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.attendants,t=>((0,o.uX)(),(0,o.Wv)(f,{key:t.id,variant:"outline-primary",pressed:e.filterAttendant===t.id,onClick:s=>e.filterAttendant===t.id?e.filterAttendant="":e.filterAttendant=t.id},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.name),1)]),_:2},1032,["pressed","onClick"]))),128))])]),_:1})]),_:1}),(0,o.Lk)("div",m,[e.isLoading?((0,o.uX)(),(0,o.Wv)(b,{key:0,variant:"primary"})):l.filteredBookingsList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(l.filteredBookingsList,e=>((0,o.uX)(),(0,o.Wv)(_,{key:e.id,booking:e,onDeleteItem:t=>l.deleteItem(e.id),onShowDetails:t=>l.showDetails(e)},null,8,["booking","onDeleteItem","onShowDetails"]))),128)):((0,o.uX)(),(0,o.CE)("span",g,(0,n.v_)(this.getLabel("upcomingReservationsNoResultLabel")),1))])])}s(8992),s(4520),s(3949),s(1454);const f={class:"booking"},k={class:"customer-info-status-customer-wrapper"},v={class:"customer"},b={class:"id"},_={class:"booking-info-date-time-wrapper"},y={class:"date"},L={class:"time"},S={class:"total"},C=["innerHTML"],w={class:"booking-assistant-info"},D={class:"delete"},F={class:"booking-actions-remaining-amount"},T={class:"details-link"},I={class:"delete-btn-wrapper"},E={class:"delete-btn-wrapper-text"};function A(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row"),c=(0,o.g2)("font-awesome-icon"),h=(0,o.g2)("PayRemainingAmount"),m=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.Wv)(u,{"gutter-x":"0"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",f,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"customer-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",k,[(0,o.Lk)("span",{class:"status",style:(0,n.Tr)("background-color:"+r.statusColor)},null,4),(0,o.Lk)("span",v,(0,n.v_)(r.customer),1)]),(0,o.Lk)("span",b,(0,n.v_)(r.id),1)]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",_,[(0,o.Lk)("span",y,(0,n.v_)(r.date),1),(0,o.Lk)("span",L,(0,n.v_)(r.fromTime)+"-"+(0,n.v_)(r.toTime),1)]),(0,o.Lk)("span",S,[(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,C)])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",w,(0,n.v_)(r.assistants.map(e=>e.name).join(" | ")),1)]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-actions-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("span",D,[(0,o.bF)(c,{icon:"fa-solid fa-trash",onClick:t[0]||(t[0]=t=>e.isDelete=!0)})]),(0,o.Lk)("span",F,[(0,o.bF)(h,{booking:s.booking},null,8,["booking"]),(0,o.Lk)("span",T,[(0,o.bF)(c,{icon:"fa-solid fa-chevron-right",onClick:r.showDetails},null,8,["onClick"])])])]),_:1})]),_:1})]),e.isDelete?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",{class:"delete-backdrop",onClick:t[1]||(t[1]=t=>e.isDelete=!1)}),(0,o.Lk)("div",I,[(0,o.Lk)("p",E,(0,n.v_)(this.getLabel("deleteBookingConfirmText")),1),(0,o.Lk)("p",null,[(0,o.bF)(m,{variant:"primary",onClick:r.deleteItem,class:"delete-btn-wrapper-button"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("deleteBookingButtonLabel")),1)]),_:1},8,["onClick"])]),(0,o.Lk)("p",null,[(0,o.Lk)("a",{href:"#",class:"delete-btn-wrapper-go-back",onClick:t[2]||(t[2]=(0,i.D$)(t=>e.isDelete=!1,["prevent"]))},(0,n.v_)(this.getLabel("deleteBookingGoBackLabel")),1)])])],64)):(0,o.Q3)("",!0)]),_:1})]),_:1})}var M=s.p+"img/requestpayment.png";const x={class:"remaining-amount-payment-link"};function $(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("b-alert");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("span",x,[(0,o.Lk)("img",{src:M,onClick:t[0]||(t[0]=(...e)=>r.payAmount&&r.payAmount(...e))}),l.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(u,{show:l.isSuccess,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("successMessagePayRemainingAmount")),1)]),_:1},8,["show"]),(0,o.bF)(u,{show:l.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("errorMessagePayRemainingAmount")),1)]),_:1},8,["show"])],512)),[[i.aG,r.show]])}var P={name:"PayRemainigAmount",props:{booking:{default:function(){return{}}}},data(){return{isLoading:!1,isSuccess:!1,isError:!1}},computed:{deposit(){return this.booking.deposit},paid_remained(){return this.booking.paid_remained},show(){return this.deposit>0&&!this.paid_remained},id(){return this.booking.id}},methods:{payAmount(){this.isLoading=!0,this.axios.get("bookings/"+this.id+"/pay-remaining-amount").then(e=>{e.data.success&&(this.isSuccess=!0),e.data.error&&(this.isError=!0),setTimeout(()=>{this.isSuccess=!1,this.isError=!1},3e3)}).finally(()=>{this.isLoading=!1})}}},Y=s(5932);const V=(0,Y.A)(P,[["render",$],["__scopeId","data-v-476753b0"]]);var B=V,X={name:"BookingItem",props:{booking:{default:function(){return{}}}},data:function(){return{isDelete:!1}},components:{PayRemainingAmount:B},computed:{customer(){return this.booking.customer_first_name+" "+this.booking.customer_last_name},status(){return this.$root.statusesList[this.booking.status].label},statusColor(){return this.$root.statusesList[this.booking.status].color},date(){return this.dateFormat(this.booking.date)},fromTime(){const e="default"===this.timeFormat?"HH:mm":"h:mma";return this.moment(this.booking.time,"HH:mm").format(e)},toTime(){const e="default"===this.timeFormat?"HH:mm":"h:mma";return this.booking.services.length>0?this.moment(this.booking.services[this.booking.services.length-1].end_at,"HH:mm").format(e):this.moment(this.booking.time,"HH:mm").format(e)},totalSum(){return this.booking.amount+" "+this.booking.currency},id(){return this.booking.id},assistants(){return this.booking.services.map(e=>({id:e.assistant_id,name:e.assistant_name})).filter(e=>+e.id)},timeFormat(){return void 0===this.$root.settings.time_format?"default":this.$root.settings.time_format.type??"default"}},methods:{deleteItem(){this.$emit("deleteItem"),this.isDelete=!1},showDetails(){this.$emit("showDetails")}},emits:["deleteItem","showDetails"]};const H=(0,Y.A)(X,[["render",A],["__scopeId","data-v-e1c2f722"]]);var W=H,j={name:"UpcomingReservations",props:{shop:{default:function(){return{}}}},data:function(){return{hours:[{label:this.getLabel("label8Hours"),hours:8},{label:this.getLabel("label24Hours"),hours:24},{label:this.getLabel("label3Days"),hours:72},{label:this.getLabel("label1Week"),hours:168}],hourValue:8,bookingsList:[],isLoading:!1,filterAttendant:"",search:"",timeout:null}},mounted(){this.load(),setInterval(()=>this.update(),6e4)},components:{BookingItem:W},watch:{hourValue(e){e&&this.load()},search(e){e?(this.hourValue="",this.loadSearch()):this.hourValue=8},shop(){this.load()}},computed:{attendants(){var e={};return e[0]={id:"",name:this.getLabel("allTitle")},this.bookingsList.forEach(t=>{t.services.forEach(t=>{t.assistant_id>0&&(e[t.assistant_id]={id:t.assistant_id,name:t.assistant_name})})}),Object.values(e).length>1?Object.values(e):[]},filteredBookingsList(){return this.bookingsList.filter(e=>{var t=!1;return e.services.forEach(e=>{this.filterAttendant===e.assistant_id&&(t=!0)}),""===this.filterAttendant||t})}},methods:{deleteItem(e){this.axios.delete("bookings/"+e).then(()=>{this.bookingsList=this.bookingsList.filter(t=>t.id!==e)})},showDetails(e){this.$emit("showItem",e)},load(){this.isLoading=!0,this.bookingsList=[],this.axios.get("bookings/upcoming",{params:{hours:this.hourValue,shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items}).finally(()=>{this.isLoading=!1})},loadSearch(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLoading=!0,this.bookingsList=[],this.axios.get("bookings",{params:{search:this.search,per_page:-1,order_by:"date_time",order:"asc",start_date:this.moment().format("YYYY-MM-DD"),shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items}).finally(()=>{this.isLoading=!1})},1e3)},update(){this.axios.get("bookings/upcoming",{params:{hours:this.hourValue,shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items})}},emits:["showItem"]};const N=(0,Y.A)(j,[["render",p],["__scopeId","data-v-645af42f"]]);var R=N;const z={class:"booking-details-customer-info"},U={class:"date"},O={class:"time"},q={class:"customer-firstname"},Q=["src"],K={class:"customer-lastname"},G={class:"customer-email"},Z={class:"customer-phone"},J={key:0,class:"customer-phone-actions"},ee=["href"],te=["href"],se=["href"],ie={class:"customer-note"},oe={class:"booking-details-extra-info"},ae={class:"booking-details-extra-info-header"},ne={class:"booking-details-extra-info-header-title"},le=["aria-expanded"],re={class:"booking-details-total-info"},de={class:"service"},ue=["innerHTML"],ce={class:"resource"},he={class:"attendant"},me={class:"total"},ge=["innerHTML"],pe={class:"transaction-id"},fe={class:"discount"},ke={class:"deposit"},ve={class:"due"},be={class:"booking-details-status-info"};function _e(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row"),h=(0,o.g2)("b-collapse"),m=(0,o.g2)("b-button"),g=(0,o.g2)("PayRemainingAmount");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("bookingDetailsTitle")),1),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",z,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"10"}),(0,o.bF)(d,{sm:"2",class:"actions"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:r.close},null,8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",U,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("dateTitle")),1),t[3]||(t[3]=(0,o.Lk)("br",null,null,-1)),(0,o.bF)(u,{icon:"fa-solid fa-calendar-days"}),(0,o.eW)(" "+(0,n.v_)(r.date),1)])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",O,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("timeTitle")),1),t[4]||(t[4]=(0,o.Lk)("br",null,null,-1)),(0,o.bF)(u,{icon:"fa-regular fa-clock"}),(0,o.eW)(" "+(0,n.v_)(r.time),1)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",q,[(0,o.eW)((0,n.v_)(r.customerFirstname)+" ",1),(0,o.Lk)("div",{class:"images",onClick:t[0]||(t[0]=(0,i.D$)((...e)=>r.showCustomerImages&&r.showCustomerImages(...e),["prevent"]))},[r.photos.length>0?((0,o.uX)(),(0,o.CE)("img",{key:0,src:r.photos.length?r.photos[0]["url"]:"",class:"photo"},null,8,Q)):((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-images"}))])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",K,(0,n.v_)(r.customerLastname),1)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",G,(0,n.v_)(e.getDisplayEmail(r.customerEmail)),1)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Z,[(0,o.eW)((0,n.v_)(e.getDisplayPhone(r.customerPhone))+" ",1),r.customerPhone&&!e.shouldHidePhone?((0,o.uX)(),(0,o.CE)("span",J,[(0,o.Lk)("a",{target:"_blank",href:"tel:"+r.customerPhone,class:"phone"},[(0,o.bF)(u,{icon:"fa-solid fa-phone"})],8,ee),(0,o.Lk)("a",{target:"_blank",href:"sms:"+r.customerPhone,class:"sms"},[(0,o.bF)(u,{icon:"fa-solid fa-message"})],8,te),(0,o.Lk)("a",{target:"_blank",href:"https://wa.me/"+r.customerPhone,class:"whatsapp"},[(0,o.bF)(u,{icon:"fa-brands fa-whatsapp"})],8,se)])):(0,o.Q3)("",!0)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ie,(0,n.v_)(r.customerNote),1)]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",oe,[(0,o.Lk)("div",ae,[(0,o.Lk)("div",ne,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["booking-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[1]||(t[1]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(u,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,le)])]),(0,o.bF)(h,{id:"collapse-2",class:"booking-details-extra-info-fields",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[2]||(t[2]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(c,{key:e.key,class:"booking-details-extra-info-field-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(e.label)+":",1),t[5]||(t[5]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("strong",null,(0,n.v_)(e.value),1)]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,{class:"booking-details-extra-info-field-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("customerPersonalNotesLabel"))+":",1),t[6]||(t[6]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("strong",null,(0,n.v_)(r.customerPersonalNote),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",re,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.services,(e,i)=>((0,o.uX)(),(0,o.Wv)(c,{key:i},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",de,[(0,o.Lk)("strong",null,[(0,o.eW)((0,n.v_)(e.service_name)+" [",1),(0,o.Lk)("span",{innerHTML:e.service_price+s.booking.currency},null,8,ue),t[7]||(t[7]=(0,o.eW)("]",-1))])])]),_:2},1024),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ce,(0,n.v_)(e.resource_name),1)]),_:2},1024),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",he,(0,n.v_)(e.assistant_name),1)]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",me,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("strong",null,(0,n.v_)(this.getLabel("totalTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("strong",null,[(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,ge)])]),_:1})]),_:1})])]),_:1}),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",pe,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("transactionIdTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(r.transactionId.join(", ")),1)]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",fe,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("discountTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.discount},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ke,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("depositTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.deposit},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ve,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("dueTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.due},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",be,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"status"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(r.status),1)]),_:1}),(0,o.bF)(d,{sm:"6",class:"booking-details-actions"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{variant:"primary",onClick:r.edit},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-pen-to-square"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("editButtonLabel")),1)]),_:1},8,["onClick"]),(0,o.bF)(g,{booking:s.booking},null,8,["booking"])]),_:1})]),_:1})])]),_:1})]),_:1})],512)),[[i.aG,e.show]])}var ye=s(8207),Le=s(7551),Se=s.n(Le),Ce={computed:{axios(){return ye.A.create({baseURL:window.slnPWA.api,headers:{"Access-Token":window.slnPWA.token}})},moment(){return Se()},locale(){return window.slnPWA.locale},shouldHideEmail(){return this.$root.settings&&this.$root.settings.hide_customers_email},shouldHidePhone(){return this.$root.settings&&this.$root.settings.hide_customers_phone}},methods:{dateFormat(e,t){var s=this.$root.settings.date_format?this.$root.settings.date_format.js_format:null;if(!s)return e;var i=s.replace("dd","DD").replace("M","MMM").replace("mm","MM").replace("yyyy","YYYY");return Se()(e).format(t||i)},timeFormat(e){return Se()(e,"HH:mm").format(this.getTimeFormat())},getTimeFormat(){var e=this.$root.settings.time_format?this.$root.settings.time_format.js_format:null;if(e){var t=e.indexOf("p")>-1?e.replace("H","hh").replace("p","a").replace("ii","mm"):e.replace("hh","HH").replace("ii","mm");return t}},getQueryParams(){let e=window.location.search;e=e.replace("?","");let t=e.split("&").map(e=>({key:e.split("=")[0],value:e.split("=")[1]})),s={};return t.forEach(e=>{s[e.key]=e.value}),s},getLabel(e){return window.slnPWA.labels[e]},getDisplayEmail(e){return this.shouldHideEmail?"***@***":e},getDisplayPhone(e){return this.shouldHidePhone?"*******":e}}},we={name:"BookingDetails",mixins:[Ce],props:{booking:{default:function(){return{}}}},computed:{date(){return this.dateFormat(this.bookingData.date)},time(){return this.timeFormat(this.bookingData.time)},customerFirstname(){return this.bookingData.customer_first_name},customerLastname(){return this.bookingData.customer_last_name},customerEmail(){return this.getDisplayEmail(this.bookingData.customer_email)},customerPhone(){const e=this.bookingData.customer_phone?this.bookingData.customer_phone_country_code+this.bookingData.customer_phone:"";return this.getDisplayPhone(e)},customerNote(){return this.bookingData.note},customerPersonalNote(){return this.bookingData.customer_personal_note},services(){return this.bookingData.services},totalSum(){return this.bookingData.amount+this.bookingData.currency},transactionId(){return this.bookingData.transaction_id},discount(){return this.bookingData.discounts_details.length>0?this.bookingData.discounts_details.map(e=>e.name+" ("+e.amount_string+")").join(", "):"-"},deposit(){return+this.bookingData.deposit>0?this.bookingData.deposit+this.bookingData.currency:"-"},due(){return+this.bookingData.amount-+this.bookingData.deposit+this.bookingData.currency},status(){return this.$root.statusesList[this.booking.status].label},customFieldsList(){return this.bookingData.custom_fields.filter(e=>-1===["html","file"].indexOf(e.type))},photos(){return this.bookingData.customer_photos}},mounted(){this.toggleShow(),setInterval(()=>this.update(),6e4)},components:{PayRemainingAmount:B},data:function(){return{show:!0,visibleExtraInfo:!1,bookingData:this.booking}},methods:{close(){this.$emit("close")},edit(){this.$emit("edit")},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)},update(){this.axios.get("bookings/"+this.bookingData.id).then(e=>{this.bookingData=e.data.items[0]})},showCustomerImages(){this.$emit("showCustomerImages",{id:this.bookingData.customer_id,photos:this.photos})}},emits:["close","edit","showCustomerImages"]};const De=(0,Y.A)(we,[["render",_e],["__scopeId","data-v-c52acdae"]]);var Fe=De;function Te(e,t,s,a,l,r){const d=(0,o.g2)("EditBooking");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("editReservationTitle")),1),(0,o.bF)(d,{bookingID:s.booking.id,date:s.booking.date,time:s.booking.time,customerID:s.customer?s.customer.id:s.booking.customer_id,customerFirstname:s.customer?s.customer.first_name:s.booking.customer_first_name,customerLastname:s.customer?s.customer.last_name:s.booking.customer_last_name,customerEmail:s.customer?s.customer.email:s.booking.customer_email,customerPhone:s.customer?s.customer.phone:s.booking.customer_phone,customerAddress:s.customer?s.customer.address:s.booking.customer_address,customerNotes:s.booking.note,customerPersonalNotes:s.customer?s.customer.note:s.booking.customer_personal_note,services:s.booking.services,discounts:s.booking.discounts,status:s.booking.status,isLoading:e.isLoading,isSaved:e.isSaved,isError:e.isError,errorMessage:e.errorMessage,customFields:s.booking.custom_fields,shop:s.booking.shop,onClose:r.close,onChooseCustomer:r.chooseCustomer,onErrorState:r.handleErrorState,onSave:r.save},null,8,["bookingID","date","time","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerNotes","customerPersonalNotes","services","discounts","status","isLoading","isSaved","isError","errorMessage","customFields","shop","onClose","onChooseCustomer","onErrorState","onSave"])],512)),[[i.aG,e.show]])}const Ie={class:"booking-details-customer-info"},Ee={class:"date"},Ae={class:"time"},Me=["onClick"],xe={class:"select-existing-client"},$e={class:"customer-firstname"},Pe={class:"customer-lastname"},Ye={class:"customer-email"},Ve={class:"customer-address"},Be={class:"customer-phone"},Xe={class:"customer-notes"},He={class:"save-as-new-customer"},We={class:"booking-details-extra-info"},je={class:"booking-details-extra-info-header"},Ne={class:"booking-details-extra-info-header-title"},Re=["aria-expanded"],ze={class:"customer-personal-notes"},Ue={class:"label",for:"customer_personal_notes"},Oe={class:"booking-details-total-info"},qe={class:"service"},Qe={key:0,class:"option-item option-item-selected"},Ke={class:"name"},Ge={key:0},Ze={class:"service-name"},Je={class:"info"},et={class:"price"},tt=["innerHTML"],st={class:"option-item"},it={class:"availability-wrapper"},ot={class:"name"},at={key:0},nt={class:"service-name"},lt={class:"info"},rt={class:"price"},dt=["innerHTML"],ut={class:"vue-select-search"},ct={class:"resource"},ht={key:0,class:"option-item option-item-selected"},mt={class:"name"},gt={class:"option-item"},pt={class:"availability-wrapper"},ft={class:"name"},kt={class:"vue-select-search"},vt={class:"attendant"},bt={key:0,class:"option-item option-item-selected"},_t={class:"name"},yt={class:"option-item"},Lt={class:"availability-wrapper"},St={class:"name"},Ct={key:0},wt=["innerHTML"],Dt={class:"vue-select-search"},Ft={class:"add-service"},Tt={class:"add-service-required"},It={key:0,class:"booking-discount-info"},Et={class:"discount"},At={key:0,class:"discount-name"},Mt={class:"option-item"},xt={class:"discount-name"},$t={class:"info"},Pt={class:"vue-select-search"},Yt={class:"add-discount"},Vt={class:"booking-details-status-info"};function Bt(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row"),h=(0,o.g2)("b-input-group-text"),m=(0,o.g2)("Datepicker"),g=(0,o.g2)("b-input-group"),p=(0,o.g2)("b-form-input"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-form-textarea"),v=(0,o.g2)("b-form-checkbox"),b=(0,o.g2)("CustomField"),_=(0,o.g2)("b-collapse"),y=(0,o.g2)("vue-select"),L=(0,o.g2)("b-spinner"),S=(0,o.g2)("b-alert"),C=(0,o.g2)("b-form-select");return(0,o.uX)(),(0,o.CE)("div",{onClick:t[19]||(t[19]=t=>e.showTimeslots=!1)},[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ie,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"10"}),(0,o.bF)(d,{sm:"2",class:"actions"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:r.close},null,8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ee,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("dateTitle")),1),(0,o.bF)(g,null,{prepend:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-calendar-days"})]),_:1})]),default:(0,o.k6)(()=>[(0,o.bF)(m,{format:"yyyy-MM-dd",modelValue:e.elDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elDate=t),"auto-apply":!0,"text-input":!0,"hide-input-icon":!0,clearable:!1,class:(0,n.C4)({required:e.requiredFields.indexOf("date")>-1})},null,8,["modelValue","class"])]),_:1})])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ae,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("timeTitle")),1),(0,o.bF)(g,null,{prepend:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-regular fa-clock"})]),_:1})]),default:(0,o.k6)(()=>[(0,o.bF)(p,{modelValue:e.elTime,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elTime=t),onClick:t[2]||(t[2]=(0,i.D$)(t=>e.showTimeslots=!e.showTimeslots,["stop"])),class:(0,n.C4)(["timeslot-input",{required:e.requiredFields.indexOf("time")>-1}])},null,8,["modelValue","class"]),(0,o.Lk)("div",{class:(0,n.C4)(["timeslots",{hide:!this.showTimeslots}]),onClick:t[3]||(t[3]=(0,i.D$)(()=>{},["stop"]))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.timeslots,e=>((0,o.uX)(),(0,o.CE)("span",{key:e,class:(0,n.C4)(["timeslot",{free:r.freeTimeslots.includes(this.moment(e,this.getTimeFormat()).format("HH:mm"))}]),onClick:t=>r.setTime(e)},(0,n.v_)(e),11,Me))),128))],2)]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",xe,[(0,o.bF)(f,{variant:"primary",onClick:r.chooseCustomer},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-users"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("selectExistingClientButtonLabel")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",$e,[(0,o.bF)(p,{placeholder:this.getLabel("customerFirstnamePlaceholder"),modelValue:e.elCustomerFirstname,"onUpdate:modelValue":t[4]||(t[4]=t=>e.elCustomerFirstname=t),class:(0,n.C4)({required:e.requiredFields.indexOf("customer_first_name")>-1})},null,8,["placeholder","modelValue","class"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Pe,[(0,o.bF)(p,{placeholder:this.getLabel("customerLastnamePlaceholder"),modelValue:e.elCustomerLastname,"onUpdate:modelValue":t[5]||(t[5]=t=>e.elCustomerLastname=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ye,[(0,o.bF)(p,{type:this.bookingID&&e.shouldHideEmail?"password":"text",placeholder:e.getLabel("customerEmailPlaceholder"),modelValue:e.elCustomerEmail,"onUpdate:modelValue":t[6]||(t[6]=t=>e.elCustomerEmail=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ve,[(0,o.bF)(p,{placeholder:this.getLabel("customerAddressPlaceholder"),modelValue:e.elCustomerAddress,"onUpdate:modelValue":t[7]||(t[7]=t=>e.elCustomerAddress=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Be,[(0,o.bF)(p,{type:this.bookingID&&e.shouldHidePhone?"password":"tel",placeholder:e.getLabel("customerPhonePlaceholder"),modelValue:e.elCustomerPhone,"onUpdate:modelValue":t[8]||(t[8]=t=>e.elCustomerPhone=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Xe,[(0,o.bF)(k,{modelValue:e.elCustomerNotes,"onUpdate:modelValue":t[9]||(t[9]=t=>e.elCustomerNotes=t),placeholder:this.getLabel("customerNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",He,[(0,o.bF)(v,{modelValue:e.saveAsNewCustomer,"onUpdate:modelValue":t[10]||(t[10]=t=>e.saveAsNewCustomer=t),switch:""},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("saveAsNewCustomerLabel")),1)]),_:1},8,["modelValue"])])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",We,[(0,o.Lk)("div",je,[(0,o.Lk)("div",Ne,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["booking-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[11]||(t[11]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(u,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,Re)])]),(0,o.bF)(_,{id:"collapse-2",class:"mt-2",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[13]||(t[13]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(b,{key:e.key,field:e,value:r.getCustomFieldValue(e.key,e.default_value),onUpdate:r.updateCustomField},null,8,["field","value","onUpdate"]))),128)),(0,o.bF)(c,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ze,[(0,o.Lk)("label",Ue,(0,n.v_)(this.getLabel("customerPersonalNotesLabel")),1),(0,o.bF)(k,{modelValue:e.elCustomerPersonalNotes,"onUpdate:modelValue":t[12]||(t[12]=t=>e.elCustomerPersonalNotes=t),modelModifiers:{lazy:!0},id:"customer_personal_notes",placeholder:this.getLabel("customerPersonalNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Oe,[e.isLoadingServicesAssistants?(0,o.Q3)("",!0):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.elServices,(s,a)=>((0,o.uX)(),(0,o.Wv)(c,{key:a,class:"service-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",qe,[(0,o.bF)(y,{ref_for:!0,ref:"select-service",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_service_"+a)>-1}]),"close-on-select":"",modelValue:s.service_id,"onUpdate:modelValue":e=>s.service_id=e,options:r.getServicesListBySearch(r.servicesList,e.serviceSearch[a]),"label-by":"[serviceName, price, duration, category]","value-by":"value"},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",Qe,[(0,o.Lk)("div",Ke,[(0,o.Lk)("span",null,(0,n.v_)(e.category),1),e.category?((0,o.uX)(),(0,o.CE)("span",Ge," | ")):(0,o.Q3)("",!0),(0,o.Lk)("span",Ze,(0,n.v_)(e.serviceName),1)]),(0,o.Lk)("div",Je,[(0,o.Lk)("div",et,[(0,o.Lk)("span",null,(0,n.v_)(e.price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,tt),t[20]||(t[20]=(0,o.Lk)("span",null," | ",-1)),(0,o.Lk)("span",null,(0,n.v_)(e.duration),1)])])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectServicesPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",st,[(0,o.Lk)("div",it,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",ot,[(0,o.Lk)("span",null,(0,n.v_)(e.category),1),e.category?((0,o.uX)(),(0,o.CE)("span",at," | ")):(0,o.Q3)("",!0),(0,o.Lk)("span",nt,(0,n.v_)(e.serviceName),1)])]),(0,o.Lk)("div",lt,[(0,o.Lk)("div",rt,[(0,o.Lk)("span",null,(0,n.v_)(e.price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,dt),t[21]||(t[21]=(0,o.Lk)("span",null," | ",-1)),(0,o.Lk)("span",null,(0,n.v_)(e.duration),1)])])])]),_:1},8,["modelValue","onUpdate:modelValue","options","class"]),(0,o.Lk)("li",ut,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(p,{modelValue:e.serviceSearch[a],"onUpdate:modelValue":t=>e.serviceSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectServicesSearchPlaceholder"),onMousedown:t[14]||(t[14]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024),r.isShowResource(s)?((0,o.uX)(),(0,o.Wv)(d,{key:0,sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ct,[(0,o.bF)(y,{ref_for:!0,ref:"select-resource",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_assistant_"+a)>-1}]),"close-on-select":"",modelValue:s.resource_id,"onUpdate:modelValue":e=>s.resource_id=e,options:r.getAttendantsOrResourcesListBySearch(r.resourcesList,e.resourceSearch[a]),"label-by":"text","value-by":"value",onFocus:e=>r.loadAvailabilityResources(s.service_id)},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",ht,[(0,o.Lk)("div",mt,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1)])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectResourcesPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",gt,[(0,o.Lk)("div",pt,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",ft,(0,n.v_)(e.text),1)])])]),_:1},8,["modelValue","onUpdate:modelValue","options","class","onFocus"]),(0,o.Lk)("li",kt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(p,{modelValue:e.resourceSearch[a],"onUpdate:modelValue":t=>e.resourceSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectResourcesSearchPlaceholder"),onMousedown:t[15]||(t[15]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024)):(0,o.Q3)("",!0),r.isShowAttendant(s)?((0,o.uX)(),(0,o.Wv)(d,{key:1,sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",vt,[(0,o.bF)(y,{ref_for:!0,ref:"select-assistant",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_assistant_"+a)>-1}]),"close-on-select":"",modelValue:s.assistant_id,"onUpdate:modelValue":e=>s.assistant_id=e,options:r.getAttendantsOrResourcesListBySearch(r.attendantsList,e.assistantSearch[a]),"label-by":"text","value-by":"value",onFocus:e=>r.loadAvailabilityAttendants(s.service_id)},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",bt,[(0,o.Lk)("div",_t,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1)])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectAttendantsPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",yt,[(0,o.Lk)("div",Lt,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",St,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1),e.variable_price?((0,o.uX)(),(0,o.CE)("span",Ct,[t[22]||(t[22]=(0,o.Lk)("span",null," [",-1)),(0,o.Lk)("span",null,(0,n.v_)(e.variable_price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,wt),t[23]||(t[23]=(0,o.Lk)("span",null,"]",-1))])):(0,o.Q3)("",!0)])])])]),_:1},8,["modelValue","onUpdate:modelValue","options","class","onFocus"]),(0,o.Lk)("li",Dt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(p,{modelValue:e.assistantSearch[a],"onUpdate:modelValue":t=>e.assistantSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectAssistantsSearchPlaceholder"),onMousedown:t[16]||(t[16]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024)):(0,o.Q3)("",!0),(0,o.bF)(d,{sm:"1",class:"service-row-delete"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:e=>r.deleteService(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"add-service-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ft,[(0,o.bF)(f,{variant:"primary",onClick:r.addService,disabled:e.isLoadingServicesAssistants},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-plus"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("addServiceButtonLabel")),1)]),_:1},8,["onClick","disabled"]),e.isLoadingServicesAssistants?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary",class:"selects-loader"})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Tt,[(0,o.bF)(S,{show:e.requiredFields.indexOf("services")>-1,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("addServiceMessage")),1)]),_:1},8,["show"])])]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[r.showDiscount?((0,o.uX)(),(0,o.CE)("div",It,[e.isLoadingDiscounts?(0,o.Q3)("",!0):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.elDiscounts,(s,a)=>((0,o.uX)(),(0,o.Wv)(c,{key:a,class:"discount-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"5"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Et,[(0,o.bF)(y,{ref_for:!0,ref:"select-discount",class:"discount-select","close-on-select":"",modelValue:e.elDiscounts[a],"onUpdate:modelValue":t=>e.elDiscounts[a]=t,options:r.getDiscountsListBySearch(r.discountsList,e.discountSearch[a]),"label-by":"text","value-by":"value"},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("span",At,(0,n.v_)(e.text),1)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectDiscountLabel")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",Mt,[(0,o.Lk)("span",xt,(0,n.v_)(e.text),1),(0,o.Lk)("div",$t,[(0,o.Lk)("span",null,"expires: "+(0,n.v_)(e.expires),1)])])]),_:1},8,["modelValue","onUpdate:modelValue","options"]),(0,o.Lk)("li",Pt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(p,{modelValue:e.discountSearch[a],"onUpdate:modelValue":t=>e.discountSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectDiscountsSearchPlaceholder"),onMousedown:t[17]||(t[17]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024),(0,o.bF)(d,{sm:"2",class:"discount-row-delete"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:e=>r.deleteDiscount(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"add-discount-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Yt,[(0,o.bF)(f,{variant:"primary",onClick:r.addDiscount,disabled:e.isLoadingDiscounts},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-plus"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("addDiscountButtonLabel")),1)]),_:1},8,["onClick","disabled"]),e.isLoadingDiscounts?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary",class:"selects-loader"})):(0,o.Q3)("",!0)])]),_:1})]),_:1})])):(0,o.Q3)("",!0)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Vt,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"status"},{default:(0,o.k6)(()=>[(0,o.bF)(C,{modelValue:e.elStatus,"onUpdate:modelValue":t[18]||(t[18]=t=>e.elStatus=t),options:r.statusesList},null,8,["modelValue","options"])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"save-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",onClick:r.save},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-check"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("saveButtonLabel")),1)]),_:1},8,["onClick"])]),_:1}),(0,o.bF)(d,{sm:"6",class:"save-button-result-wrapper"},{default:(0,o.k6)(()=>[s.isLoading?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(S,{show:s.isSaved,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("savedLabel")),1)]),_:1},8,["show"]),(0,o.bF)(S,{show:s.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(s.errorMessage),1)]),_:1},8,["show"]),(0,o.bF)(S,{show:!e.isValid&&e.requiredFields.length>1,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("validationMessage")),1)]),_:1},8,["show"]),(0,o.bF)(S,{show:e.shopError,fade:"",variant:"warning"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("selectShopFirstMessage")),1)]),_:1},8,["show"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})])}s(4114),s(2577),s(7550);const Xt=["for"],Ht=["for"],Wt=["for"];function jt(e,t,s,i,a,l){const r=(0,o.g2)("b-form-input"),d=(0,o.g2)("b-form-textarea"),u=(0,o.g2)("b-form-checkbox"),c=(0,o.g2)("b-form-select"),h=(0,o.g2)("b-col"),m=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(m,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{sm:"12"},{default:(0,o.k6)(()=>["text"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(r,{modelValue:e.elValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elValue=t),modelModifiers:{lazy:!0},id:l.key},null,8,["modelValue","id"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,Xt)],64)):(0,o.Q3)("",!0),"textarea"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(d,{modelValue:e.elValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elValue=t),modelModifiers:{lazy:!0},id:l.key},null,8,["modelValue","id"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,Ht)],64)):(0,o.Q3)("",!0),"checkbox"===l.type?((0,o.uX)(),(0,o.Wv)(u,{key:2,modelValue:e.elValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.elValue=t),id:l.key},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(l.label),1)]),_:1},8,["modelValue","id"])):(0,o.Q3)("",!0),"select"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:3},[(0,o.bF)(c,{modelValue:e.elValue,"onUpdate:modelValue":t[3]||(t[3]=t=>e.elValue=t),id:l.key,options:l.options},null,8,["modelValue","id","options"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,Wt)],64)):(0,o.Q3)("",!0)]),_:1})]),_:1})}var Nt={name:"CustomField",props:{field:{default:function(){return{}}},value:{default:function(){return""}}},mounted(){this.update()},data:function(){let e=this.value;return"checkbox"===this.field.type&&(e=!!e),{elValue:e}},watch:{elValue(){this.update()}},computed:{key(){return this.field.key},type(){return this.field.type},label(){return this.field.label},options(){return this.field.options.map(e=>({value:e.value,text:e.label}))}},methods:{update(){this.$emit("update",this.key,this.elValue)}},emits:["update"]};const Rt=(0,Y.A)(Nt,[["render",jt],["__scopeId","data-v-19833334"]]);var zt=Rt,Ut={name:"EditBooking",props:{bookingID:{default:function(){return""}},date:{default:function(){return""}},time:{default:function(){return""}},customerID:{default:function(){return""}},customerFirstname:{default:function(){return""}},customerLastname:{default:function(){return""}},customerEmail:{default:function(){return""}},customerAddress:{default:function(){return""}},customerPhone:{default:function(){return""}},customerNotes:{default:function(){return""}},customerPersonalNotes:{default:function(){return""}},services:{default:function(){return[]}},discounts:{default:function(){return[]}},status:{default:function(){return""}},isLoading:{default:function(){return!1}},isSaved:{default:function(){return!1}},isError:{default:function(){return!1}},errorMessage:{default:function(){return""}},customFields:{default:function(){return[]}},shop:{default:function(){return{}}}},mixins:[Ce],mounted(){this.loadDiscounts(),this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.loadCustomFields(),this.isLoadingServicesAssistants=!0,Promise.all([this.loadServices(),this.loadAttendants(),this.loadResources(),this.loadServicesCategory()]).then(()=>{this.isLoadingServicesAssistants=!1,this.elServices.forEach((e,t)=>{this.addServicesSelectSearchInput(t),this.addAssistantsSelectSearchInput(t),this.addResourcesSelectSearchInput(t)})})},data:function(){const e=this.customerEmail||"",t=this.customerPhone||"";return{shopError:!1,elDate:this.date,elTime:this.timeFormat(this.time),elCustomerFirstname:this.customerFirstname,elCustomerLastname:this.customerLastname,elCustomerEmail:this.bookingID&&this.shouldHideEmail?"***@***":e,elCustomerPhone:this.bookingID&&this.shouldHidePhone?"*******":t,originalCustomerEmail:e,originalCustomerPhone:t,elCustomerAddress:this.customerAddress,elCustomerNotes:this.customerNotes,elCustomerPersonalNotes:this.customerPersonalNotes,elServices:[...this.services].map(e=>({service_id:e.service_id,assistant_id:e.assistant_id,resource_id:e.resource_id})),bookings:[],elDiscounts:[...this.discounts],elStatus:this.status,visibleDiscountInfo:!1,elDiscountsList:[],elServicesList:[],elServicesNameList:[],elAttendantsList:[],elResourcesList:[],showTimeslots:!1,availabilityIntervals:{},saveAsNewCustomer:!1,availabilityServices:[],serviceSearch:[],discountSearch:[],isValid:!0,requiredFields:[],visibleExtraInfo:!1,customFieldsList:[],elCustomFields:this.customFields,isLoadingServicesAssistants:!1,isLoadingDiscounts:!1,assistantSearch:[],resourceSearch:[],availabilityAttendants:[],availabilityResources:[],vueTelInputOptions:{placeholder:this.getLabel("customerPhonePlaceholder")},specificValidationMessage:this.getLabel("validationMessage")}},watch:{elDate(){this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.loadDiscounts(),this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})},elTime(){this.loadAvailabilityServices(),this.loadDiscounts(),this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})},timeslots(e){e.length&&!this.elTime&&(this.elTime=this.moment(e[0],this.getTimeFormat()).format("HH:mm"))},bookingServices(){this.loadDiscounts()},shop(e,t){e?.id!==t?.id&&(this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.isLoadingServicesAssistants=!0,Promise.all([this.loadServices(),this.loadAttendants(),this.loadResources(),this.loadServicesCategory()]).then(()=>{this.isLoadingServicesAssistants=!1,this.clearServices(),this.elServices.forEach((e,t)=>{this.addServicesSelectSearchInput(t),this.addAssistantsSelectSearchInput(t),this.addResourcesSelectSearchInput(t)}),this.loadDiscounts(),this.requiredFields=[],this.isValid=!0,this.shopError=!1}).catch(()=>{this.isLoadingServicesAssistants=!1}))},elServices:{deep:!0,handler(){this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})}}},computed:{statusesList(){var e=[];for(var t in this.$root.statusesList)e.push({value:t,text:this.$root.statusesList[t].label});return e},discountsList(){var e=[];return this.elDiscountsList.forEach(t=>{e.push({value:t.id,text:t.name,expires:t.valid_to})}),e},servicesList(){var e=[];return this.elServicesList.forEach(t=>{let s=[];t.categories.forEach(e=>{let t=this.elServicesNameList.find(t=>t.id===e);t&&s.push(t.name)});let i=!1,o=this.availabilityServices.find(e=>e.id===t.id);o&&(i=o.available);let a=t.price;this.shop&&t.shops&&t.shops.forEach(e=>{e.id===this.shop.id&&(a=e.price)}),e.push({value:t.id,price:a,duration:t.duration,currency:t.currency,serviceName:t.name,category:s.join(", "),empty_assistants:t.empty_assistants,empty_resources:t.empty_resources,available:i})}),e},attendantsList(){var e=[];return this.elAttendantsList.forEach(t=>{let s=!1,i=!1,o=this.availabilityAttendants.find(e=>e.id===t.id);o&&(s=o.available,i=o.variable_price),e.push({value:t.id,text:t.name,available:s,variable_price:i,currency:t.currency})}),e},resourcesList(){var e=[];return this.elResourcesList.forEach(t=>{let s=!1,i=this.availabilityResources.find(e=>e.id===t.id);i&&(s=1===i.status),e.push({value:t.id,text:t.name,available:s})}),e},timeslots(){var e=this.availabilityIntervals.workTimes?Object.values(this.availabilityIntervals.workTimes):[];return e.map(e=>this.timeFormat(e))},freeTimeslots(){return this.availabilityIntervals.times?Object.values(this.availabilityIntervals.times):[]},showAttendant(){return"undefined"===typeof this.$root.settings.attendant_enabled||this.$root.settings.attendant_enabled},showResource(){return"undefined"===typeof this.$root.settings.resources_enabled||this.$root.settings.resources_enabled},showDiscount(){return"undefined"===typeof this.$root.settings.discounts_enabled||this.$root.settings.discounts_enabled},bookingServices(){return JSON.parse(JSON.stringify(this.elServices)).map(e=>(e.assistant_id?e.assistant_id:e.assistant_id=0,e.resource_id?e.resource_id:e.resource_id=0,e))}},methods:{sprintf(e,...t){return e.replace(/%s/g,e=>t.shift()||e)},close(){this.$emit("close")},chooseCustomer(){this.$emit("chooseCustomer")},convertDurationToMinutes(e){const[t,s]=e.split(":").map(Number);return 60*t+s},isOverlapping(e,t,s,i){return e.isBefore(i)&&t.isAfter(s)},calculateServiceTimes(e){const t=[];let s=this.moment(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm");return e.services.forEach(e=>{const i=this.servicesList.find(t=>t.value===e.service_id);if(!i)return;const o=this.convertDurationToMinutes(i.duration),a=this.moment(s).add(o,"minutes"),n={service_id:e.service_id,assistant_id:e.assistant_id,resource_id:e.resource_id,start:s.clone(),end:a.clone(),duration:o,serviceName:i.serviceName};t.push(n),s=a.clone()}),t},async validateAssistantAvailability(e){try{const t=await this.getExistingBookings(e.date),s=this.calculateServiceTimes(e);for(const e of s){if(!e.assistant_id)continue;const s=t.filter(t=>t.services.some(t=>t.assistant_id===e.assistant_id));for(const t of s){const s=this.calculateServiceTimes({date:t.date,time:t.time,services:t.services});for(const t of s){if(t.assistant_id!==e.assistant_id)continue;const s=this.isOverlapping(e.start,e.end,t.start,t.end);if(s){const s=this.attendantsList.find(t=>t.value===e.assistant_id),i=s?s.text:this.getLabel("assistantBusyTitle"),o=`${i} `+this.sprintf(this.getLabel("assistantBusyMessage"),t.start.format("HH:mm"),t.end.format("HH:mm"));throw new Error(o)}}}}return!0}catch(t){return this.$emit("error-state",{isError:!0,errorMessage:t.message}),t}},async getExistingBookings(e){try{const t=await this.axios.get("bookings",{params:{start_date:this.moment(e).format("YYYY-MM-DD"),end_date:this.moment(e).format("YYYY-MM-DD"),per_page:-1,shop:this.shop?.id||null}});return Array.isArray(t.data.items)?t.data.items.filter(e=>String(e.id)!==String(this.bookingID)):[]}catch(t){return console.error("Error getting existing bookings:",t),[]}},clearServices(){this.elServices=[],this.serviceSearch=[],this.assistantSearch=[],this.resourceSearch=[]},async save(){if(this.isValid=this.validate(),!this.isValid)return this.requiredFields.includes("shop")&&this.$root.settings.shops_enabled?void this.$emit("error",{message:this.getLabel("selectShopFirstMessage"),type:"shop"}):void 0;const e=this.bookingID&&this.shouldHideEmail&&"***@***"===this.elCustomerEmail?this.originalCustomerEmail:this.elCustomerEmail,t=this.bookingID&&this.shouldHidePhone&&"*******"===this.elCustomerPhone?this.originalCustomerPhone:this.elCustomerPhone,s={date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),status:this.elStatus,customer_id:this.customerID||0,customer_first_name:this.elCustomerFirstname,customer_last_name:this.elCustomerLastname,customer_email:e,customer_phone:t,customer_address:this.elCustomerAddress,services:this.bookingServices,discounts:this.elDiscounts,note:this.elCustomerNotes,customer_personal_note:this.elCustomerPersonalNotes,save_as_new_customer:this.saveAsNewCustomer,custom_fields:this.elCustomFields};this.shop&&(s.shop={id:this.shop.id});const i=await this.validateAssistantAvailability(s);i instanceof Error||(this.$emit("error-state",{isError:!1,errorMessage:""}),this.$emit("save",s))},loadDiscounts(){this.isLoadingDiscounts=!0,this.axios.get("discounts",{params:{return_active:!0,date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),customer_email:this.elCustomerEmail,services:this.bookingServices,shop:this.shop?this.shop.id:null}}).then(e=>{this.elDiscountsList=e.data.items,this.isLoadingDiscounts=!1,this.discountSearch=[],this.elDiscounts=this.elDiscounts.filter(e=>{const t=this.discountsList.map(e=>e.value);return t.includes(e)}),this.elDiscounts.forEach((e,t)=>{this.addDiscountsSelectSearchInput(t)})})},loadServices(){return this.axios.get("services",{params:{per_page:-1,shop:this.shop?this.shop.id:null}}).then(e=>{this.elServicesList=e.data.items})},loadServicesCategory(){return this.axios.get("services/categories").then(e=>{this.elServicesNameList=e.data.items})},loadAttendants(){return this.axios.get("assistants",{params:{shop:this.shop?this.shop.id:null,orderby:"order",order:"asc"}}).then(e=>{this.elAttendantsList=e.data.items})},loadResources(){return this.axios.get("resources",{params:{shop:this.shop?this.shop.id:null}}).then(e=>{this.elResourcesList=e.data.items}).catch(()=>{})},loadAvailabilityIntervals(){this.axios.post("availability/intervals",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityIntervals=e.data.intervals})},loadAvailabilityServices(){this.axios.post("availability/booking/services",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,is_all_services:!0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityServices=e.data.services})},loadAvailabilityAttendants(e){this.axios.post("availability/booking/assistants",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,selected_service_id:e||0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityAttendants=e.data.assistants})},loadAvailabilityResources(e){this.axios.post("availability/booking/resources",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,selected_service_id:e||0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityResources=e.data.resources})},loadCustomFields(){this.axios.get("custom-fields/booking").then(e=>{this.customFieldsList=e.data.items.filter(e=>-1===["html","file"].indexOf(e.type))})},addDiscount(){this.elDiscounts.push(null),this.addDiscountsSelectSearchInput(this.elDiscounts.length-1)},deleteDiscount(e){this.elDiscounts.splice(e,1),this.discountSearch.splice(e,1)},addService(){this.elServices.push({service_id:null,assistant_id:null,resource_id:null}),this.addServicesSelectSearchInput(this.elServices.length-1),this.addAssistantsSelectSearchInput(this.elServices.length-1),this.addResourcesSelectSearchInput(this.elServices.length-1)},deleteService(e){this.elServices.splice(e,1),this.serviceSearch.splice(e,1)},setTime(e){this.elTime=this.moment(e,this.getTimeFormat()).format("HH:mm"),this.showTimeslots=!1,this.loadAvailabilityServices(),this.loadDiscounts()},getServicesListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test([e.category,e.serviceName,e.price,e.duration].join(""))):e},getDiscountsListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test(e.text)):e},validate(){return this.requiredFields=[],this.shopError=!1,this.$root.settings.shops_enabled&&(this.shop&&this.shop.id||(this.requiredFields.push("shop"),this.shopError=!0)),this.elDate||this.requiredFields.push("date"),this.elTime.trim()||this.requiredFields.push("time"),this.elCustomerFirstname.trim()||this.requiredFields.push("customer_first_name"),this.bookingServices.length||this.requiredFields.push("services"),this.bookingServices.forEach((e,t)=>{e.service_id||this.requiredFields.push("services_service_"+t),this.isShowAttendant(e)&&!e.assistant_id&&this.requiredFields.push("services_assistant_"+t)}),1===this.requiredFields.length&&this.requiredFields.includes("shop")?this.specificValidationMessage=this.getLabel("selectShopFirstMessage"):this.specificValidationMessage=this.getLabel("validationMessage"),0===this.requiredFields.length},isShowAttendant(e){let t=this.servicesList.find(t=>t.value===e.service_id);return t?this.showAttendant&&(!e.service_id||t&&!t.empty_assistants):this.showAttendant},isShowResource(e){let t=this.servicesList.find(t=>t.value===e.service_id);return t?this.showResource&&(!e.service_id||t&&!t.empty_resources):this.showResource},updateCustomField(e,t){let s=this.elCustomFields.find(t=>t.key===e);s?s.value=t:this.elCustomFields.push({key:e,value:t})},getCustomFieldValue(e,t){let s=this.elCustomFields.find(t=>t.key===e);return s?s.value:t},addServicesSelectSearchInput(e){this.serviceSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".service .vue-dropdown")[e].prepend(window.document.querySelectorAll(".service .vue-select-search")[e]);let t=this.$refs["select-service"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".service .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.serviceSearch[e]=""})},0)},addAssistantsSelectSearchInput(e){this.assistantSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".attendant .vue-dropdown")[e].prepend(window.document.querySelectorAll(".attendant .vue-select-search")[e]);let t=this.$refs["select-assistant"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".attendant .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.assistantSearch[e]=""})},0)},addResourcesSelectSearchInput(e){this.resourceSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".resource .vue-dropdown")[e].prepend(window.document.querySelectorAll(".resource .vue-select-search")[e]);let t=this.$refs["select-resource"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".resource .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.resourceSearch[e]=""})},0)},addDiscountsSelectSearchInput(e){this.discountSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".discount .vue-dropdown")[e].prepend(window.document.querySelectorAll(".discount .vue-select-search")[e]);let t=this.$refs["select-discount"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".discount .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.discountSearch[e]=""})},0)},getAttendantsOrResourcesListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test([e.text].join(""))):e}},emits:["close","chooseCustomer","save","error-state"],components:{CustomField:zt}};const Ot=(0,Y.A)(Ut,[["render",Bt],["__scopeId","data-v-aeeffb06"]]);var qt=Ot,Qt={name:"EditBookingItem",props:{booking:{default:function(){return{}}},customer:{default:function(){return{}}}},components:{EditBooking:qt},mounted(){this.toggleShow()},data:function(){return{isLoading:!1,isSaved:!1,isError:!1,errorMessage:"",show:!0,bookings:[]}},methods:{handleErrorState({isError:e,errorMessage:t}){this.isError=e,this.errorMessage=t},close(e){this.isError=!1,this.$emit("close",e)},chooseCustomer(){this.isError=!1,this.$emit("chooseCustomer")},save(e){this.isLoading=!0,this.axios.put("bookings/"+this.booking.id,e).then(e=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3),this.isLoading=!1,this.axios.get("bookings/"+e.data.id).then(e=>{this.close(e.data.items[0])})},e=>{this.isError=!0,this.errorMessage=e.response.data.message,this.isLoading=!1})},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)}},emits:["close","chooseCustomer"]};const Kt=(0,Y.A)(Qt,[["render",Te]]);var Gt=Kt;const Zt={class:"title"},Jt={class:"search"},es={class:"filters"},ts={class:"customers-list"},ss={key:2,class:"no-result"};function is(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-form-input"),u=(0,o.g2)("b-button"),c=(0,o.g2)("b-col"),h=(0,o.g2)("b-row"),m=(0,o.g2)("b-spinner"),g=(0,o.g2)("CustomerItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",Zt,(0,n.v_)(this.getLabel("customersAddressBookTitle")),1),(0,o.Lk)("div",Jt,[(0,o.bF)(r,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(d,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=t=>e.search=t),class:"search-input"},null,8,["modelValue"]),e.search?((0,o.uX)(),(0,o.Wv)(r,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:t[1]||(t[1]=t=>e.search="")})):(0,o.Q3)("",!0)]),(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(c,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",es,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filters,t=>((0,o.uX)(),(0,o.Wv)(u,{variant:"outline-primary",key:t.value,onClick:s=>e.searchFilter=t.value,pressed:e.searchFilter===t.value},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.label),1)]),_:2},1032,["onClick","pressed"]))),128))])]),_:1})]),_:1}),(0,o.Lk)("div",ts,[e.isLoading?((0,o.uX)(),(0,o.Wv)(m,{key:0,variant:"primary"})):e.customersList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(e.customersList,e=>((0,o.uX)(),(0,o.Wv)(g,{key:e.id,customer:e,chooseCustomerAvailable:s.chooseCustomerAvailable,onChoose:t=>l.choose(e),onShowImages:l.showImages,onEdit:l.edit},null,8,["customer","chooseCustomerAvailable","onChoose","onShowImages","onEdit"]))),128)):((0,o.uX)(),(0,o.CE)("span",ss,(0,n.v_)(this.getLabel("customersAddressBookNoResultLabel")),1))]),s.chooseCustomerAvailable?((0,o.uX)(),(0,o.Wv)(u,{key:0,variant:"primary",class:"go-back",onClick:l.closeChooseCustomer},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("goBackButtonLabel")),1)]),_:1},8,["onClick"])):(0,o.Q3)("",!0)])}const os={class:"customer"},as={class:"customer-firstname"},ns={class:"customer-lastname"},ls={class:"customer-email"},rs={key:0,class:"customer-phone"},ds={class:"total-order-sum"},us=["innerHTML"],cs={class:"total-order-count"},hs={class:"wrapper"},ms={key:0,class:"button-choose"},gs=["src"],ps={class:"customer-phone-wrapper"},fs={key:0},ks=["href"],vs=["href"],bs=["href"];function _s(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",os,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"8",class:"customer-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:"customer-first-last-name-wrapper",onClick:t[0]||(t[0]=(...e)=>r.edit&&r.edit(...e))},[(0,o.Lk)("span",as,(0,n.v_)(r.customerFirstname),1),(0,o.Lk)("span",ns,(0,n.v_)(r.customerLastname),1)]),(0,o.Lk)("div",ls,(0,n.v_)(e.getDisplayEmail(r.customerEmail)),1),r.customerPhone?((0,o.uX)(),(0,o.CE)("div",rs,(0,n.v_)(e.getDisplayPhone(r.customerPhone)),1)):(0,o.Q3)("",!0)]),_:1}),(0,o.bF)(d,{sm:"4",class:"total-order-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("span",ds,[(0,o.bF)(u,{icon:"fa-solid fa-chart-simple"}),(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,us)]),(0,o.Lk)("span",cs,[(0,o.bF)(u,{icon:"fa-solid fa-medal"}),(0,o.eW)(" "+(0,n.v_)(r.customerScore),1)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"total-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",hs,[s.chooseCustomerAvailable?((0,o.uX)(),(0,o.CE)("div",ms,[(0,o.bF)(u,{icon:"fa-solid fa-circle-plus",onClick:(0,i.D$)(r.choose,["prevent"])},null,8,["onClick"])])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"images",onClick:t[1]||(t[1]=(0,i.D$)((...e)=>r.showImages&&r.showImages(...e),["prevent"]))},[r.photos.length>0?((0,o.uX)(),(0,o.CE)("img",{key:0,src:r.photos.length?r.photos[0]["url"]:"",class:"photo"},null,8,gs)):((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-images"}))])]),(0,o.Lk)("div",ps,[r.customerPhone&&!e.shouldHidePhone?((0,o.uX)(),(0,o.CE)("span",fs,[(0,o.Lk)("a",{target:"_blank",href:"tel:"+r.customerPhone,class:"phone"},[(0,o.bF)(u,{icon:"fa-solid fa-phone"})],8,ks),(0,o.Lk)("a",{target:"_blank",href:"sms:"+r.customerPhone,class:"sms"},[(0,o.bF)(u,{icon:"fa-solid fa-message"})],8,vs),(0,o.Lk)("a",{target:"_blank",href:"https://wa.me/"+r.customerPhone,class:"whatsapp"},[(0,o.bF)(u,{icon:"fa-brands fa-whatsapp"})],8,bs)])):(0,o.Q3)("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1})}var ys={name:"CustomerItem",mixins:[Ce],props:{customer:{default:function(){return{}}},chooseCustomerAvailable:{default:function(){return!1}}},computed:{customerFirstname(){return this.customer.first_name},customerLastname(){return this.customer.last_name},customerEmail(){return this.getDisplayEmail(this.customer.email)},customerPhone(){const e=this.customer.phone?this.customer.phone_country_code+this.customer.phone:"";return this.getDisplayPhone(e)},customerScore(){return this.customer.score},totalSum(){return this.$root.settings.currency_symbol+this.customer.total_amount_reservations},totalCount(){return this.customer.bookings.length>0?this.customer.bookings.length:"-"},photos(){return this.customer.photos}},methods:{choose(){this.$emit("choose")},showImages(){this.$emit("showImages",this.customer)},edit(){this.$emit("edit",this.customer)}},emits:["choose","showImages","edit"]};const Ls=(0,Y.A)(ys,[["render",_s],["__scopeId","data-v-4d97c33e"]]);var Ss=Ls,Cs={name:"CustomersAddressBook",props:{chooseCustomerAvailable:{default:function(){return!1}},shop:{default:function(){return{}}},customer:{default:function(){return{}}}},mounted(){this.load()},watch:{searchFilter(e){e&&this.load()},search(e){e?(this.searchFilter="",this.loadSearch()):this.searchFilter="a|b"},shop(){this.load()},customer(){this.customer&&this.customersList.forEach((e,t)=>{this.customer.id===e.id&&(this.customersList[t]=this.customer)})}},data:function(){return{filters:[{label:"a - b",value:"a|b"},{label:"c - d",value:"c|d"},{label:"e - f",value:"e|f"},{label:"g - h",value:"g|h"},{label:"i - j",value:"i|j"},{label:"k - l",value:"k|l"},{label:"m - n",value:"m|n"},{label:"o - p",value:"o|p"},{label:"q - r",value:"q|r"},{label:"s - t",value:"s|t"},{label:"u - v",value:"u|v"},{label:"w - x",value:"w|x"},{label:"y - z",value:"y|z"}],searchFilter:"a|b",customersList:[],isLoading:!1,search:"",timeout:null}},methods:{closeChooseCustomer(){this.$emit("closeChooseCustomer")},choose(e){this.$emit("choose",e)},load(){this.isLoading=!0,this.customersList=[],this.axios.get("customers",{params:{search:this.searchFilter,search_type:"start_with",search_field:"first_name",order_by:"first_name_last_name",shop:this.shop?this.shop.id:null}}).then(e=>{this.customersList=e.data.items}).finally(()=>{this.isLoading=!1})},loadSearch(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLoading=!0,this.customersList=[],this.axios.get("customers",{params:{search:this.search,order_by:"first_name_last_name",shop:this.shop?this.shop.id:null}}).then(e=>{this.customersList=e.data.items}).finally(()=>{this.isLoading=!1})},1e3)},showImages(e){this.$emit("showImages",e)},edit(e){this.$emit("edit",e)}},components:{CustomerItem:Ss},emits:["closeChooseCustomer","choose","showImages","edit"]};const ws=(0,Y.A)(Cs,[["render",is],["__scopeId","data-v-a5f519f6"]]);var Ds=ws;const Fs={class:"images"},Ts={class:"photo-wrapper"},Is=["src"],Es=["onClick"],As=["onClick"],Ms={key:2,class:"date"},xs={class:"take-photo-label"},$s={class:"select-photo-label"};function Ps(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("slide"),h=(0,o.g2)("navigation"),m=(0,o.g2)("pagination"),g=(0,o.g2)("carousel"),p=(0,o.g2)("b-col"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Fs,[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,{sm:"12",class:"list"},{default:(0,o.k6)(()=>[l.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(g,{ref:"carousel",modelValue:l.photoIndex,wrapAround:!0,transition:0},{addons:(0,o.k6)(({slidesCount:e})=>[e>1?((0,o.uX)(),(0,o.Wv)(h,{key:0})):(0,o.Q3)("",!0),e>1?((0,o.uX)(),(0,o.Wv)(m,{key:1})):(0,o.Q3)("",!0)]),default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.photos,(t,s)=>((0,o.uX)(),(0,o.Wv)(c,{key:s},{default:(0,o.k6)(()=>[(0,o.Lk)("span",Ts,[(0,o.Lk)("img",{src:t.url,class:"photo"},null,8,Is),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"photo-icon-wrapper fa-trash-wrapper",onClick:(0,i.D$)(e=>r.remove(t),["prevent","stop"])},[(0,o.bF)(u,{icon:"fa-solid fa-trash"})],8,Es)):(0,o.Q3)("",!0),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",{key:1,class:"photo-icon-wrapper fa-circle-check-wrapper",onClick:(0,i.D$)(e=>r.setAsDefault(t),["prevent","stop"])},[(0,o.bF)(u,{icon:"fa-regular fa-circle-check",class:(0,n.C4)({default:t.default})},null,8,["class"])],8,As)):(0,o.Q3)("",!0),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",Ms,(0,n.v_)(e.dateFormat(1e3*t.created,"DD.MM.YYYY")),1)):(0,o.Q3)("",!0)])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),(0,o.bF)(p,{sm:"12",class:"buttons"},{default:(0,o.k6)(()=>[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,{sm:"6",class:"take-photo",onClick:t[1]||(t[1]=e=>this.$refs.takePhoto.click())},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",size:"lg"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-camera"})]),_:1}),(0,o.Lk)("div",xs,(0,n.v_)(this.getLabel("takePhotoButtonLabel")),1),(0,o.bo)((0,o.Lk)("input",{type:"file",accept:"image/*",capture:"camera",ref:"takePhoto",onChange:t[0]||(t[0]=(...e)=>r.uploadTakePhoto&&r.uploadTakePhoto(...e))},null,544),[[i.aG,!1]])]),_:1}),(0,o.bF)(p,{sm:"6",class:"select-photo"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",size:"lg",onClick:t[2]||(t[2]=e=>this.$refs.downloadImages.click())},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-cloud-arrow-up"})]),_:1}),(0,o.Lk)("div",$s,(0,n.v_)(this.getLabel("selectPhotoButtonLabel")),1),(0,o.bo)((0,o.Lk)("input",{type:"file",accept:"image/*",ref:"downloadImages",onChange:t[3]||(t[3]=(...e)=>r.uploadFromPhone&&r.uploadFromPhone(...e))},null,544),[[i.aG,!1]])]),_:1})]),_:1})]),_:1})]),_:1}),(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,{sm:"12",class:"back"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"outline-primary",onClick:r.close,size:"lg"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("backImagesButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1})]),_:1})}var Ys={name:"ImagesList",props:{customer:{default:function(){return{}}}},data(){let e=0;return this.customer.photos.forEach((t,s)=>{+t.default&&(e=s)}),{baseUrl:"/{SLN_PWA_DIST_PATH}/",customerData:this.customer,photoIndex:e,isLoading:!1}},computed:{photos(){return this.customerData.photos.length?this.customerData.photos:[{url:this.baseUrl+"img/placeholder-image.png"}]},id(){return this.customerData.id}},methods:{close(){this.$emit("close",this.customerData)},uploadTakePhoto(){let e=this.$refs.takePhoto.files[0];this.upload(e),this.$refs.takePhoto.value=""},uploadFromPhone(){let e=this.$refs.downloadImages.files[0];this.upload(e),this.$refs.downloadImages.value=""},upload(e,t){let s=new FormData;s.append("file",e,t),this.isLoading=!0,this.axios.post("customers/"+this.id+"/photos",s,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.customerData=e.data.items[0]}).finally(()=>{this.isLoading=!1})},remove(e){this.isLoading=!0,this.axios.delete("customers/"+this.id+"/photos/"+e.attachment_id).then(e=>{this.customerData=e.data.items[0]}).finally(()=>{this.isLoading=!1})},setAsDefault(e){this.isLoading=!0,this.axios.put("customers/"+this.id+"/photos/"+e.attachment_id,{photo:Object.assign({},e,{default:1})}).then(e=>{this.customerData=e.data.items[0],this.$refs.carousel.slideTo(0)}).finally(()=>{this.isLoading=!1})}},emits:["close"]};const Vs=(0,Y.A)(Ys,[["render",Ps],["__scopeId","data-v-271d799f"]]);var Bs=Vs,Xs={name:"UpcomingReservationsTab",props:{shop:{default:function(){return{}}}},components:{UpcomingReservations:R,BookingDetails:Fe,EditBookingItem:Gt,CustomersAddressBook:Ds,ImagesList:Bs},data:function(){return{showItem:!1,editItem:!1,item:null,isChooseCustomer:!1,customer:null,isShowCustomerImages:!1,showImagesCustomer:null}},methods:{setShowItem(e){this.showItem=!0,this.item=e},closeShowItem(){this.showItem=!1},setEditItem(){this.editItem=!0},closeEditItem(e){this.editItem=!1,this.customer=null,e&&this.setShowItem(e)},chooseCustomer(){this.isChooseCustomer=!0},closeChooseCustomer(){this.isChooseCustomer=!1},choose(e){this.customer=e,this.closeChooseCustomer()},showCustomerImages(e){this.isShowCustomerImages=!0,this.showImagesCustomer=e,this.$emit("hideTabsHeader",!0)},closeShowCustomerImages(e){this.item.customer_photos=e.photos,this.isShowCustomerImages=!1,this.$emit("hideTabsHeader",!1)}},emits:["hideTabsHeader"]};const Hs=(0,Y.A)(Xs,[["render",r]]);var Ws=Hs;function js(e,t,s,i,a,n){const l=(0,o.g2)("b-spinner"),r=(0,o.g2)("ImagesList"),d=(0,o.g2)("CustomersAddressBook"),u=(0,o.g2)("AddBookingItem"),c=(0,o.g2)("EditBookingItem"),h=(0,o.g2)("CustomerDetails"),m=(0,o.g2)("BookingDetails"),g=(0,o.g2)("ReservationsCalendar");return(0,o.uX)(),(0,o.CE)("div",null,[e.isLoading?((0,o.uX)(),(0,o.Wv)(l,{key:0,variant:"primary"})):e.isShowCustomerImages?((0,o.uX)(),(0,o.Wv)(r,{key:1,customer:e.showImagesCustomer,onClose:n.closeShowCustomerImages},null,8,["customer","onClose"])):e.isChooseCustomer?((0,o.uX)(),(0,o.Wv)(d,{key:2,onCloseChooseCustomer:n.closeChooseCustomer,chooseCustomerAvailable:!0,onChoose:n.choose,shop:e.addItem?s.shop:e.item.shop},null,8,["onCloseChooseCustomer","onChoose","shop"])):e.addItem?((0,o.uX)(),(0,o.Wv)(u,{key:3,onClose:n.close,date:e.date,time:e.time,customer:e.customer,onChooseCustomer:n.chooseCustomer,shop:s.shop},null,8,["onClose","date","time","customer","onChooseCustomer","shop"])):e.editItem?((0,o.uX)(),(0,o.Wv)(c,{key:4,booking:e.item,customer:e.customer,onClose:n.closeEditItem,onChooseCustomer:n.chooseCustomer},null,8,["booking","customer","onClose","onChooseCustomer"])):e.showCustomerProfile?((0,o.uX)(),(0,o.Wv)(h,{key:5,customerID:e.selectedCustomer.id,customerFirstname:e.selectedCustomer.first_name,customerLastname:e.selectedCustomer.last_name,customerEmail:e.selectedCustomer.email,customerPhone:e.selectedCustomer.phone,customerAddress:e.selectedCustomer.address,customerPersonalNotes:e.selectedCustomer.note,onClose:n.closeCustomerProfile},null,8,["customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes","onClose"])):e.showItem?((0,o.uX)(),(0,o.Wv)(m,{key:6,booking:e.item,onClose:n.closeShowItem,onEdit:n.setEditItem,onShowCustomerImages:n.showCustomerImages},null,8,["booking","onClose","onEdit","onShowCustomerImages"])):((0,o.uX)(),(0,o.Wv)(g,{key:7,modelValue:e.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedDate=t),onShowItem:n.setShowItem,onAdd:n.add,onViewCustomerProfile:n.openCustomerProfile,shop:s.shop},null,8,["modelValue","onShowItem","onAdd","onViewCustomerProfile","shop"]))])}const Ns={class:"reservations-calendar"},Rs={class:"calendar-header"},zs={class:"title"},Us={key:1,class:"slots-inner"},Os={key:2};function qs(e,t,s,i,a,l){const r=(0,o.g2)("b-toaster"),d=(0,o.g2)("SearchInput"),u=(0,o.g2)("BookingCalendar"),c=(0,o.g2)("SlotsHeadline"),h=(0,o.g2)("b-spinner"),m=(0,o.g2)("TimeAxis"),g=(0,o.g2)("AttendantsList"),p=(0,o.g2)("AttendantTimeSlots"),f=(0,o.g2)("BookingCard"),k=(0,o.g2)("SlotActions"),v=(0,o.g2)("TimeSlots");return(0,o.uX)(),(0,o.CE)("div",Ns,[(0,o.bF)(r,{name:"b-toaster-top-center",class:"toast-container-custom"}),(0,o.Lk)("div",Rs,[(0,o.Lk)("h5",zs,(0,n.v_)(this.getLabel("reservationsCalendarTitle")),1)]),(0,o.bF)(d,{modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=e=>a.search=e),onSearch:l.handleSearch},null,8,["modelValue","onSearch"]),(0,o.bF)(u,{modelValue:l.date,"onUpdate:modelValue":t[1]||(t[1]=e=>l.date=e),"availability-stats":a.availabilityStats,"is-loading":a.isLoadingTimeslots||!a.attendantsLoaded,onMonthYearUpdate:l.handleMonthYear},null,8,["modelValue","availability-stats","is-loading","onMonthYearUpdate"]),(0,o.bF)(c,{date:l.date,settings:e.$root.settings,attendants:a.attendants,"is-attendant-view":a.isAttendantView,"onUpdate:isAttendantView":t[2]||(t[2]=e=>a.isAttendantView=e)},null,8,["date","settings","attendants","is-attendant-view"]),(0,o.Lk)("div",{class:(0,n.C4)(["slots",{"slots--assistants":a.isAttendantView}]),ref:"slotsContainer"},[a.isLoading?((0,o.uX)(),(0,o.Wv)(h,{key:0,variant:"primary"})):l.isReadyToRender?((0,o.uX)(),(0,o.CE)("div",Us,[(0,o.bF)(m,{timeslots:a.timeslots,"slot-height":a.slotHeight,"time-format-new":a.timeFormatNew},null,8,["timeslots","slot-height","time-format-new"]),(0,o.Lk)("div",(0,o.v6)({class:"slots-content",ref:"dragScrollContainer"},(0,o.Tb)(l.dragHandlers,!0)),[a.isAttendantView?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[a.attendantsLoaded?((0,o.uX)(),(0,o.Wv)(g,{key:0,attendants:l.sortedAttendants,"column-widths":l.columnWidths,"column-gap":a.attendantColumnGap,"is-hidden":!l.shouldShowAttendants},null,8,["attendants","column-widths","column-gap","is-hidden"])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"bookings-canvas",style:(0,n.Tr)(l.canvasStyle)},[l.sortedAttendants.length>0&&a.timeslots.length>0?((0,o.uX)(),(0,o.Wv)(p,{key:0,ref:"attendantTimeSlots","sorted-attendants":l.sortedAttendants,timeslots:a.timeslots,"column-widths":l.columnWidths,"slot-height":a.slotHeight,"selected-slots":a.selectedTimeSlots,"processed-bookings":l.processedBookings,"availability-intervals":a.availabilityIntervals,lockedTimeslots:a.lockedTimeslots,"onUpdate:lockedTimeslots":t[3]||(t[3]=e=>a.lockedTimeslots=e),onLock:l.handleAttendantLock,onUnlock:l.handleAttendantUnlock,onSlotProcessing:l.setSlotProcessing,date:l.date,shop:s.shop,onAdd:l.addBookingForAttendant},null,8,["sorted-attendants","timeslots","column-widths","slot-height","selected-slots","processed-bookings","availability-intervals","lockedTimeslots","onLock","onUnlock","onSlotProcessing","date","shop","onAdd"])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.processedBookings,e=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e.id+(e._serviceTime?.start||"")},[e._assistantId?((0,o.uX)(),(0,o.Wv)(f,{key:0,ref_for:!0,ref:"bookingCard",booking:e,style:(0,n.Tr)(l.getBookingStyle(e)),class:(0,n.C4)({"booking-card--default-duration":e._isDefaultDuration}),"is-saving":a.savingBookingIds.has(e.id),"max-duration-minutes":l.getMaxDurationForBooking(e),"px-per-minute":l.pxPerMinute,onDeleteItem:l.deleteItem,onShowDetails:l.showDetails,onViewCustomerProfile:l.viewCustomerProfile,onResizeStart:l.handleResizeStart,onResizeUpdate:l.handleResizeUpdate,onResizeEnd:l.handleResizeEnd},null,8,["booking","style","class","is-saving","max-duration-minutes","px-per-minute","onDeleteItem","onShowDetails","onViewCustomerProfile","onResizeStart","onResizeUpdate","onResizeEnd"])):(0,o.Q3)("",!0)],64))),128))],4)],64)):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"bookings-canvas",style:(0,n.Tr)(l.canvasStyle)},[(0,o.bF)(v,{timeslots:a.timeslots,"slot-style":l.getTimeSlotLineStyle,"is-locked":l.isSlotLocked,"is-system-locked":l.isSystemLocked,"is-manual-locked":l.isManualLocked,"is-processing":(e,t)=>a.slotProcessing[`${e}-${t}`],"active-index":a.activeSlotIndex,onToggle:l.toggleSlotActions},{actions:(0,o.k6)(({timeSlot:e,slotIndex:t})=>[(0,o.bF)(k,{"time-slot":e,index:t,timeslots:a.timeslots,"is-locked":l.isSlotLocked,"is-available":l.isAvailable,"is-system-locked":l.isSystemLocked,"is-schedule-locked":l.isSlotLocked,"is-manual-locked":l.isManualLocked,"is-disabled":a.slotProcessing[`${e}-${a.timeslots[t+1]}`],"has-overlapping":l.hasOverlappingBookings,date:l.date,shop:s.shop,onAdd:l.addBooking,onLock:l.handleSlotLock,onUnlock:l.handleSlotUnlock,onUpdateProcessing:l.updateSlotProcessing},null,8,["time-slot","index","timeslots","is-locked","is-available","is-system-locked","is-schedule-locked","is-manual-locked","is-disabled","has-overlapping","date","shop","onAdd","onLock","onUnlock","onUpdateProcessing"])]),_:1},8,["timeslots","slot-style","is-locked","is-system-locked","is-manual-locked","is-processing","active-index","onToggle"]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.bookingsList,e=>((0,o.uX)(),(0,o.Wv)(f,{key:e.id,ref_for:!0,ref:"bookingCard",booking:e,style:(0,n.Tr)(l.getBookingStyle(e)),"is-saving":a.savingBookingIds.has(e.id),"max-duration-minutes":l.getMaxDurationForBooking(e),"px-per-minute":l.pxPerMinute,onDeleteItem:l.deleteItem,onShowDetails:l.showDetails,onViewCustomerProfile:l.viewCustomerProfile,onResizeStart:l.handleResizeStart,onResizeUpdate:l.handleResizeUpdate,onResizeEnd:l.handleResizeEnd},null,8,["booking","style","is-saving","max-duration-minutes","px-per-minute","onDeleteItem","onShowDetails","onViewCustomerProfile","onResizeStart","onResizeUpdate","onResizeEnd"]))),128))],4))],16),a.showCurrentTimeLine?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"current-time-line",style:(0,n.Tr)({top:a.currentTimeLinePosition+"px"})},null,4)):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("span",Os,(0,n.v_)(this.getLabel("noResultTimeslotsLabel")),1))],2)])}s(670),s(8872),s(3375),s(9225),s(3972),s(9209),s(5714),s(7561),s(6197);const Qs={class:"time-axis"};function Ks(e,t,s,i,a,l){return(0,o.uX)(),(0,o.CE)("div",Qs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.formattedTimeslots,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:"axis-"+t,class:"time-axis-item",style:(0,n.Tr)({height:s.slotHeight+"px"})},(0,n.v_)(e),5))),128))])}var Gs={name:"TimeAxis",props:{timeslots:{type:Array,required:!0},slotHeight:{type:Number,required:!0},timeFormatNew:{type:String,required:!1}},computed:{formattedTimeslots(){return this.timeslots.map(e=>this.formatTime(e,this.timeFormatNew))}},methods:{formatTime(e){return this.timeFormat(e)}}};const Zs=(0,Y.A)(Gs,[["render",Ks],["__scopeId","data-v-1d703707"]]);var Js=Zs;const ei={class:"attendant-header"},ti={class:"attendant-avatar"},si=["src","alt"],ii=["title"];function oi(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",{class:(0,n.C4)(["attendants-list",{"attendants-list--hidden":s.isHidden}])},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.attendants,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"attendant-column",style:(0,n.Tr)({width:s.columnWidths[e.id]+"px",marginRight:(t===s.attendants.length-1?0:s.columnGap)+"px"})},[(0,o.Lk)("div",ei,[(0,o.Lk)("div",ti,[e.image_url?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.image_url,alt:e.name},null,8,si)):((0,o.uX)(),(0,o.Wv)(r,{key:1,icon:"fa-solid fa-user-alt",class:"default-avatar-icon"}))]),(0,o.Lk)("div",{class:"attendant-name",title:e.name},(0,n.v_)(e.name),9,ii)])],4))),128))],2)}var ai={name:"AttendantsList",props:{attendants:{type:Array,required:!0},columnWidths:{type:Object,required:!0},columnGap:{type:Number,required:!0},isHidden:{type:Boolean,default:!1}}};const ni=(0,Y.A)(ai,[["render",oi],["__scopeId","data-v-a81b7f8a"]]);var li=ni;const ri=["onClick"],di={class:"time-slot-actions"};function ui(e,t,s,i,a,l){return(0,o.uX)(),(0,o.CE)("div",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:"line-"+i,class:(0,n.C4)(["time-slot-line",{active:s.activeIndex===i,locked:s.isLocked(s.timeslots[i],s.timeslots[i+1]),processing:s.isProcessing(s.timeslots[i],s.timeslots[i+1])}]),style:(0,n.Tr)(s.slotStyle(i)),onClick:t=>e.$emit("toggle",i)},[(0,o.Lk)("div",di,[(0,o.RG)(e.$slots,"actions",(0,o.v6)({ref_for:!0},{timeSlot:t,slotIndex:i}),void 0,!0)])],14,ri))),128))])}var ci={name:"TimeSlots",props:{timeslots:{type:Array,required:!0},slotStyle:{type:Function,required:!0},isLocked:{type:Function,required:!0},isProcessing:{type:Function,required:!0},activeIndex:{type:Number,default:-1}},emits:["toggle"]};const hi=(0,Y.A)(ci,[["render",ui],["__scopeId","data-v-35d361e4"]]);var mi=hi;const gi={class:"slot-actions"};function pi(e,t,s,i,a,n){const l=(0,o.g2)("BookingAdd"),r=(0,o.g2)("BookingBlockSlot");return(0,o.uX)(),(0,o.CE)("div",gi,[s.isLocked(s.timeSlot,n.getNextSlot())?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(l,{key:0,timeslot:s.timeSlot,"is-available":s.isAvailable(s.timeSlot),onAdd:t[0]||(t[0]=t=>e.$emit("add",s.timeSlot))},null,8,["timeslot","is-available"])),!s.hasOverlapping(s.index)||s.isLocked(s.timeSlot,n.getNextSlot())?((0,o.uX)(),(0,o.Wv)(r,{key:1,"is-lock":s.isLocked(s.timeSlot,n.getNextSlot()),"is-system-locked":s.isSystemLocked(s.timeSlot),"is-manual-locked":s.isManualLocked(s.timeSlot,n.getNextSlot()),"is-disabled":s.isDisabled,start:s.timeSlot,shop:s.shop,end:n.getNextSlot(),date:n.getFormattedDate(),"assistant-id":s.assistantId,onLockStart:n.handleLockStart,onLock:t[1]||(t[1]=t=>e.$emit("lock",t)),onLockEnd:n.handleLockEnd,onUnlockStart:n.handleUnlockStart,onUnlock:t[2]||(t[2]=t=>e.$emit("unlock",t)),onUnlockEnd:n.handleUnlockEnd},null,8,["is-lock","is-system-locked","is-manual-locked","is-disabled","start","shop","end","date","assistant-id","onLockStart","onLockEnd","onUnlockStart","onUnlockEnd"])):(0,o.Q3)("",!0)])}const fi={class:"booking-add"};function ki(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("span",fi,[(0,o.bF)(r,{icon:"fa-solid fa-circle-plus",class:(0,n.C4)({available:s.isAvailable}),onClick:l.add},null,8,["class","onClick"])])}var vi={name:"BookingAdd",props:{timeslot:{default:function(){return"09:00"}},isAvailable:{default:function(){return!0}}},computed:{timeFormat(){return this.$root.settings&&this.$root.settings.time_format?this.$root.settings.time_format.type:"default"}},methods:{add(){this.$emit("add")}},emits:["add"]};const bi=(0,Y.A)(vi,[["render",ki],["__scopeId","data-v-e097b6d8"]]);var _i=bi;const yi={class:"block-slot"};function Li(e,t,s,i,a,l){const r=(0,o.g2)("b-spinner"),d=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",yi,[a.isLoading?((0,o.uX)(),(0,o.Wv)(r,{key:0,variant:"primary",size:"sm"})):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[s.isLock?s.isManualLocked?((0,o.uX)(),(0,o.Wv)(d,{key:1,icon:"fa-solid fa-lock",onClick:l.unlock,class:(0,n.C4)(["icon",{disabled:s.isDisabled}])},null,8,["onClick","class"])):s.isSystemLocked?((0,o.uX)(),(0,o.Wv)(d,{key:2,icon:"fa-solid fa-lock",class:"icon system-locked"})):(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(d,{key:0,icon:"fa-solid fa-unlock",onClick:l.lock,class:(0,n.C4)(["icon",{disabled:s.isDisabled}])},null,8,["onClick","class"]))],64))])}var Si={name:"BookingBlockSlot",props:{isLock:{type:Boolean,default:!1},start:{type:String,default:"08:00"},end:{type:String,default:"08:30"},date:{type:String,required:!0,validator:function(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}},shop:{type:Number,required:!0},isSystemLocked:{type:Boolean,default:!1},isManualLocked:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},assistantId:{type:Number,default:null}},data(){return{isLoading:!1,END_OF_DAY:"24:00",MINUTES_IN_DAY:1440}},computed:{holidayRule(){const e="00:00"===this.end||this.end===this.END_OF_DAY?this.END_OF_DAY:this.normalizeTime(this.end),t={from_date:this.date,to_date:this.date,from_time:this.normalizeTime(this.start),to_time:e,daily:!0};return null!=this.assistantId&&(t.assistant_id=this.assistantId),t}},methods:{lock(){this.isLoading||this.isDisabled||(this.isLoading=!0,this.$emit("lock-start",this.holidayRule),this.$emit("lock",this.holidayRule),setTimeout(()=>{this.$emit("lock-end",this.holidayRule),this.isLoading=!1},300))},unlock(){this.isLoading||this.isDisabled||(this.isLoading=!0,this.$emit("unlock-start",this.holidayRule),this.$emit("unlock",this.holidayRule),setTimeout(()=>{this.$emit("unlock-end",this.holidayRule),this.isLoading=!1},300))},normalizeTime(e){return e===this.END_OF_DAY?this.END_OF_DAY:this.moment(e,this.getTimeFormat()).format("HH:mm")}},emits:["lock","unlock","lock-start","unlock-start","lock-end","unlock-end"]};const Ci=(0,Y.A)(Si,[["render",Li],["__scopeId","data-v-64678cf3"]]);var wi=Ci,Di={name:"SlotActions",components:{BookingAdd:_i,BookingBlockSlot:wi},props:{shop:{default:()=>({})},index:{type:Number,required:!0},timeSlot:{type:String,required:!0},timeslots:{type:Array,required:!0},isLocked:{type:Function,required:!0},isAvailable:{type:Function,required:!0},hasOverlapping:{type:Function,required:!0},date:{type:Date,required:!0},assistantId:{type:Number,default:null},isSystemLocked:{type:Function,required:!0},isManualLocked:{type:Function,required:!0},isDisabled:{type:Boolean,default:!1}},methods:{getNextSlot(){return this.timeslots[this.index+1]||null},getFormattedDate(){return this.dateFormat(this.date,"YYYY-MM-DD")},handleLockStart(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!0})},handleLockEnd(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!1})},handleUnlockStart(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!0}),this.$emit("unlock-start")},handleUnlockEnd(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!1}),this.$emit("unlock-end")}},emits:["add","lock","unlock","lock-start","lock-end","unlock-start","unlock-end","update-processing"]};const Fi=(0,Y.A)(Di,[["render",pi],["__scopeId","data-v-5b07e2cf"]]);var Ti=Fi;const Ii={class:"slots-headline"},Ei={class:"selected-date"},Ai={key:0,class:"attendant-toggle"};function Mi(e,t,s,i,a,l){const r=(0,o.g2)("b-form-checkbox");return(0,o.uX)(),(0,o.CE)("div",Ii,[(0,o.Lk)("div",Ei,(0,n.v_)(l.formattedDate),1),s.settings?.attendant_enabled&&s.attendants.length>0?((0,o.uX)(),(0,o.CE)("div",Ai,[(0,o.eW)((0,n.v_)(this.getLabel("attendantViewLabel"))+" ",1),(0,o.bF)(r,{modelValue:l.isAttendantViewLocal,"onUpdate:modelValue":t[0]||(t[0]=e=>l.isAttendantViewLocal=e),switch:"",size:"lg"},null,8,["modelValue"])])):(0,o.Q3)("",!0)])}var xi={name:"SlotsHeadline",props:{date:{type:Date,required:!0},settings:{type:Object,default:()=>({})},attendants:{type:Array,default:()=>[]},isAttendantView:{type:Boolean,default:!1}},emits:["update:isAttendantView"],computed:{formattedDate(){return this.moment(this.date).locale(this.getLabel("calendarLocale")).format("dddd DD YYYY")},isAttendantViewLocal:{get(){return this.isAttendantView},set(e){this.$emit("update:isAttendantView",e)}}},methods:{getLabel(e){return this.$parent.getLabel?.(e)||e}}};const $i=(0,Y.A)(xi,[["render",Mi],["__scopeId","data-v-4d2aca34"]]);var Pi=$i;const Yi={class:"search"};function Vi(e,t,s,i,a,n){const l=(0,o.g2)("font-awesome-icon"),r=(0,o.g2)("b-form-input");return(0,o.uX)(),(0,o.CE)("div",Yi,[(0,o.bF)(l,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(r,{modelValue:a.searchValue,"onUpdate:modelValue":t[0]||(t[0]=e=>a.searchValue=e),class:"search-input",onInput:n.handleInput},null,8,["modelValue","onInput"]),a.searchValue?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:n.clearSearch},null,8,["onClick"])):(0,o.Q3)("",!0)])}function Bi(e,t=300){let s=null;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>{e(...i)},t)}}var Xi={name:"SearchInput",props:{modelValue:{type:String,default:""},debounceTime:{type:Number,default:600}},data(){return{searchValue:this.modelValue}},watch:{modelValue(e){this.searchValue=e}},created(){this.debouncedEmit=Bi(e=>{this.$emit("update:modelValue",e),this.$emit("search",e)},this.debounceTime)},methods:{handleInput(e){this.debouncedEmit(e)},clearSearch(){this.searchValue="",this.$emit("update:modelValue",""),this.$emit("search","")}}};const Hi=(0,Y.A)(Xi,[["render",Vi],["__scopeId","data-v-5ef7fdca"]]);var Wi=Hi;const ji={class:"calendar"},Ni={key:0,class:"day day-with-bookings"},Ri={key:1,class:"day day-full-booked"},zi={key:2,class:"day day-available-book"},Ui={key:3,class:"day day-holiday"},Oi={key:4,class:"day day-disable-book"},qi={key:0,class:"spinner-wrapper"};function Qi(e,t,s,i,a,l){const r=(0,o.g2)("Datepicker"),d=(0,o.g2)("b-spinner");return(0,o.uX)(),(0,o.CE)("div",ji,[(0,o.bF)(r,{modelValue:l.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedDate=e),inline:"",autoApply:"",noSwipe:"",locale:this.getLabel("calendarLocale"),enableTimePicker:!1,monthChangeOnScroll:!1,onUpdateMonthYear:l.handleMonthYear},{day:(0,o.k6)(({day:e,date:t})=>[l.isDayWithBookings(t)?((0,o.uX)(),(0,o.CE)("div",Ni,(0,n.v_)(e),1)):l.isDayFullBooked(t)?((0,o.uX)(),(0,o.CE)("div",Ri,(0,n.v_)(e),1)):l.isAvailableBookings(t)?((0,o.uX)(),(0,o.CE)("div",zi,(0,n.v_)(e),1)):l.isHoliday(t)?((0,o.uX)(),(0,o.CE)("div",Ui,(0,n.v_)(e),1)):((0,o.uX)(),(0,o.CE)("div",Oi,(0,n.v_)(e),1))]),_:1},8,["modelValue","locale","onUpdateMonthYear"]),s.isLoading?((0,o.uX)(),(0,o.CE)("div",qi)):(0,o.Q3)("",!0),s.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:1,variant:"primary"})):(0,o.Q3)("",!0)])}var Ki={name:"BookingCalendar",props:{modelValue:{type:Date,required:!0},availabilityStats:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["update:modelValue","month-year-update"],computed:{selectedDate:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>{const e=document.querySelector(".dp__calendar"),t=document.querySelector(".spinner-wrapper"),s=document.querySelector(".calendar .spinner-border");e&&t&&s&&(e.appendChild(t),e.appendChild(s))})},methods:{handleMonthYear({year:e,month:t}){this.$emit("month-year-update",{year:e,month:t})},isDayWithBookings(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.data?.bookings>0)},isAvailableBookings(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.available&&!t.full_booked)},isDayFullBooked(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.full_booked)},isHoliday(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&"holiday_rules"===t.error?.type)}}};const Gi=(0,Y.A)(Ki,[["render",Qi],["__scopeId","data-v-482ccf6c"]]);var Zi=Gi;const Ji={key:0,class:"saving-overlay"},eo={class:"booking"},to={class:"customer-info"},so={class:"customer-info-header"},io={class:"booking-id"},oo={class:"services-list"},ao={class:"service-name"},no={class:"assistant-name"},lo={class:"booking-actions-bottom"},ro={key:0,class:"walkin-badge",title:"Walk-In"},uo={class:"booking-status"},co={class:"status-label"},ho={class:"resize-handle",ref:"resizeHandle"},mo={key:1,class:"duration-label"};function go(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("CustomerActionsMenu");return(0,o.uX)(),(0,o.CE)("div",{ref:"bookingCard",class:(0,n.C4)(["booking-wrapper",{"is-resizing":l.isResizing,"is-saving":s.isSaving}])},[s.isSaving?((0,o.uX)(),(0,o.CE)("div",Ji,[(0,o.bF)(d,{variant:"light",small:""})])):(0,o.Q3)("",!0),(0,o.Lk)("div",eo,[(0,o.Lk)("div",to,[(0,o.Lk)("div",so,[(0,o.Lk)("span",{class:"customer-name",onClick:t[0]||(t[0]=(...e)=>r.showDetails&&r.showDetails(...e))},(0,n.v_)(r.customer),1),(0,o.Lk)("span",io,(0,n.v_)(r.id),1)])]),(0,o.Lk)("div",oo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.booking.services,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"service-item",key:t},[(0,o.Lk)("span",ao,(0,n.v_)(e.service_name),1),(0,o.Lk)("span",no,(0,n.v_)(e.assistant_name),1)]))),128))]),(0,o.Lk)("div",lo,[s.booking.is_walkin?((0,o.uX)(),(0,o.CE)("div",ro,"  ")):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"booking-actions-menu-dots",onClick:t[1]||(t[1]=(0,i.D$)((...e)=>r.toggleActionsMenu&&r.toggleActionsMenu(...e),["stop"]))},"  ")]),(0,o.Lk)("div",uo,[(0,o.Lk)("span",co,(0,n.v_)(r.statusLabel),1)])]),(0,o.Lk)("div",ho,[...t[3]||(t[3]=[(0,o.Lk)("div",{class:"resize-handle-visual"},[(0,o.Lk)("span",{class:"handle-icon"},"")],-1)])],512),l.isResizing?((0,o.uX)(),(0,o.CE)("div",mo,(0,n.v_)(l.displayDuration),1)):(0,o.Q3)("",!0),(0,o.bF)(u,{booking:s.booking,show:l.showActionsMenu,onClose:t[2]||(t[2]=e=>l.showActionsMenu=!1),onEdit:r.onEdit,onDelete:r.onDelete,onViewProfile:r.onViewProfile},null,8,["booking","show","onEdit","onDelete","onViewProfile"])],2)}const po={key:0,class:"modal-root"},fo={class:"modal-container"},ko={class:"modal-content"},vo={class:"modal-text"},bo={class:"modal-text"},_o={class:"modal-text"},yo={key:1,class:"modal-divider"},Lo={class:"modal-text"},So={key:3,class:"modal-divider"},Co={class:"modal-text"};function wo(e,t,s,i,a,l){return(0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[s.show?((0,o.uX)(),(0,o.CE)("div",po,[(0,o.Lk)("div",{class:"modal-backdrop",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e))}),(0,o.Lk)("div",fo,[(0,o.Lk)("div",ko,[(0,o.Lk)("div",{class:"modal-item",onClick:t[1]||(t[1]=(...e)=>l.editBooking&&l.editBooking(...e))},[t[7]||(t[7]=(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,o.Lk)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})])],-1)),(0,o.Lk)("div",vo,(0,n.v_)(this.getLabel("bookingActionEdit")),1)]),t[12]||(t[12]=(0,o.Lk)("div",{class:"modal-divider"},null,-1)),(0,o.Lk)("div",{class:"modal-item",onClick:t[2]||(t[2]=(...e)=>l.deleteBooking&&l.deleteBooking(...e))},[t[8]||(t[8]=(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[(0,o.Lk)("path",{fill:"#fff",d:"M135.2 17.7C140.6 6.8 151.7 0 163.8 0L284.2 0c12.1 0 23.2 6.8 28.6 17.7L320 32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 96C14.3 96 0 81.7 0 64S14.3 32 32 32l96 0 7.2-14.3zM32 128l384 0 0 320c0 35.3-28.7 64-64 64L96 512c-35.3 0-64-28.7-64-64l0-320zm96 64c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16z"})])],-1)),(0,o.Lk)("div",bo,(0,n.v_)(this.getLabel("bookingActionDelete")),1)]),t[13]||(t[13]=(0,o.Lk)("div",{class:"modal-divider"},null,-1)),l.hasPhone?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-item",onClick:t[3]||(t[3]=(...e)=>l.callCustomer&&l.callCustomer(...e))},[t[9]||(t[9]=(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[(0,o.Lk)("path",{fill:"#fff",d:"M497.4 361.8l-112-48a24 24 0 0 0 -28 6.9l-49.6 60.6A370.7 370.7 0 0 1 130.6 204.1l60.6-49.6a23.9 23.9 0 0 0 6.9-28l-48-112A24.2 24.2 0 0 0 122.6 .6l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.3 24.3 0 0 0 -14-27.6z"})])],-1)),(0,o.Lk)("div",_o,(0,n.v_)(this.getLabel("bookingActionCallCustomer")),1)])):(0,o.Q3)("",!0),l.hasPhone?((0,o.uX)(),(0,o.CE)("div",yo)):(0,o.Q3)("",!0),l.hasPhone?((0,o.uX)(),(0,o.CE)("div",{key:2,class:"modal-item",onClick:t[4]||(t[4]=(...e)=>l.whatsappCustomer&&l.whatsappCustomer(...e))},[t[10]||(t[10]=(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"31.5",height:"31.5",viewBox:"52.15 351.25 31.5 31.5"},[(0,o.Lk)("path",{d:"M78.932 355.827a15.492 15.492 0 0 0-11.04-4.577c-8.605 0-15.609 7.003-15.609 15.61 0 2.749.718 5.435 2.082 7.804l-2.215 8.086 8.276-2.173a15.562 15.562 0 0 0 7.46 1.899h.007c8.6 0 15.757-7.003 15.757-15.61 0-4.17-1.772-8.086-4.718-11.039Zm-11.04 24.02c-2.334 0-4.619-.627-6.609-1.808l-.47-.281-4.908 1.287 1.307-4.789-.309-.492a12.931 12.931 0 0 1-1.983-6.905c0-7.15 5.822-12.972 12.98-12.972 3.466 0 6.722 1.35 9.169 3.804 2.447 2.454 3.951 5.709 3.944 9.175 0 7.158-5.97 12.98-13.12 12.98Zm7.116-9.718c-.386-.197-2.306-1.14-2.664-1.266-.359-.133-.62-.197-.88.197s-1.005 1.266-1.237 1.533c-.225.26-.457.295-.844.098-2.292-1.146-3.796-2.046-5.308-4.64-.4-.69.4-.64 1.146-2.13.127-.26.063-.486-.035-.683-.099-.197-.88-2.116-1.203-2.897-.316-.759-.64-.654-.878-.668-.225-.014-.486-.014-.746-.014s-.682.099-1.04.486c-.359.393-1.364 1.335-1.364 3.255s1.399 3.776 1.589 4.036c.197.26 2.749 4.198 6.665 5.892 2.475 1.069 3.446 1.16 4.683.977.752-.112 2.306-.942 2.63-1.856.323-.914.323-1.694.225-1.856-.092-.176-.352-.274-.739-.464Z",fill:"#fff","fill-rule":"evenodd"})])],-1)),(0,o.Lk)("div",Lo,(0,n.v_)(this.getLabel("bookingActionWhatsappCustomer")),1)])):(0,o.Q3)("",!0),l.hasCustomer?((0,o.uX)(),(0,o.CE)("div",So)):(0,o.Q3)("",!0),l.hasCustomer?((0,o.uX)(),(0,o.CE)("div",{key:4,class:"modal-item",onClick:t[5]||(t[5]=(...e)=>l.openCustomerProfile&&l.openCustomerProfile(...e))},[t[11]||(t[11]=(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user"},[(0,o.Lk)("path",{stroke:"#fff",d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,o.Lk)("circle",{stroke:"#fff",cx:"12",cy:"7",r:"4"})])],-1)),(0,o.Lk)("div",Co,(0,n.v_)(this.getLabel("bookingActionOpenProfile")),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:"modal-close",onClick:t[6]||(t[6]=(...e)=>l.close&&l.close(...e))},[...t[14]||(t[14]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},[(0,o.Lk)("line",{stroke:"#fff",x1:"18",y1:"6",x2:"6",y2:"18"}),(0,o.Lk)("line",{stroke:"#fff",x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])])):(0,o.Q3)("",!0)])}var Do={name:"CustomerActionsMenu",props:{booking:{type:Object,required:!0},show:{type:Boolean,default:!1}},data(){return{originalOverflow:""}},computed:{customerPhone(){return this.booking?.customer_phone_country_code?this.booking.customer_phone_country_code+this.booking.customer_phone:this.booking?.customer_phone||""},hasPhone(){return!!this.customerPhone},hasCustomer(){return!!this.booking?.customer_id}},watch:{show(e){e?(this.originalOverflow=document.body.style.overflow,document.body.style.overflow="hidden"):document.body.style.overflow=this.originalOverflow}},methods:{close(){this.$emit("close")},editBooking(){this.$emit("edit",this.booking),this.close()},deleteBooking(){this.$emit("delete",this.booking.id),this.close()},callCustomer(){this.customerPhone&&window.open(`tel:${this.customerPhone}`,"_blank"),this.close()},whatsappCustomer(){if(this.customerPhone){const e=this.customerPhone.replace(/\D/g,"");window.open(`https://wa.me/${e}`,"_blank")}this.close()},openCustomerProfile(){this.hasCustomer&&this.$emit("view-profile",{id:this.booking.customer_id,first_name:this.booking.customer_first_name,last_name:this.booking.customer_last_name,email:this.booking.customer_email,phone:this.customerPhone,address:this.booking.customer_address,note:this.booking.customer_personal_note}),this.close()}},beforeUnmount(){this.show&&(document.body.style.overflow=this.originalOverflow)},emits:["close","edit","delete","view-profile"]};const Fo=(0,Y.A)(Do,[["render",wo],["__scopeId","data-v-cfcf264a"]]);var To=Fo;const Io=!1;var Eo={name:"BookingCard",components:{CustomerActionsMenu:To},props:{booking:{default:function(){return{}}},isSaving:{type:Boolean,default:!1},maxDurationMinutes:{type:Number,default:null},pxPerMinute:{type:Number,default:null}},data(){return{isDelete:!1,showActionsMenu:!1,isResizing:!1,displayDuration:"",originalHeight:null,originalDuration:null,currentHeight:null,currentDuration:null,isValidResize:!0,resizeHandlers:null}},computed:{customer(){return`${this.booking.customer_first_name} ${this.booking.customer_last_name}`},id(){return this.booking.id},assistants(){return(this.booking.services||[]).map(e=>({id:e.assistant_id,name:e.assistant_name})).filter(e=>+e.id)},statusLabel(){const e=this.booking.status;return this.$root.statusesList&&this.$root.statusesList[e]?this.$root.statusesList[e].label:e},bookingStartTime(){return this.booking._serviceTime?.start||this.booking.time||this.booking.start}},watch:{booking:{handler(){this.destroyNativeResize(),this.$nextTick(()=>{this.initializeNativeResize()})},deep:!0}},mounted(){console.log(" BookingCard mounted(), booking ID:",this.booking.id),this.$nextTick(()=>{console.log(" $nextTick, refs:",{bookingCard:!!this.$refs.bookingCard,resizeHandle:!!this.$refs.resizeHandle}),this.$refs.bookingCard&&this.$refs.resizeHandle?this.initializeNativeResize():console.warn(" BookingCard refs not available in mounted()")})},beforeUnmount(){this.destroyNativeResize()},methods:{toggleActionsMenu(){this.showActionsMenu=!this.showActionsMenu},onEdit(){this.$emit("showDetails",this.booking),this.$emit("edit",this.booking)},onDelete(){this.$emit("deleteItem",this.booking.id)},onViewProfile(e){this.$emit("viewCustomerProfile",e)},showDetails(){this.$emit("showDetails",this.booking)},getLabel(e){return this.$root.labels?this.$root.labels[e]:e},getBookingDuration(){const e=this.booking.services&&this.booking.services[0];if(!e)return 30;if(e.duration){const[t,s]=e.duration.split(":").map(Number);return 60*t+s}if(e.start_at&&e.end_at){const[t,s]=e.start_at.split(":").map(Number),[i,o]=e.end_at.split(":").map(Number),a=60*t+s,n=60*i+o;return n-a}if(this.booking.duration){const[e,t]=this.booking.duration.split(":").map(Number);return 60*e+t}return 30},calculateEndTime(e,t){const[s,i]=e.split(":").map(Number),o=60*s+i,a=o+t,n=Math.floor(a/60),l=a%60;return`${String(n).padStart(2,"0")}:${String(l).padStart(2,"0")}`},formatTimeRange(e,t){const s=this.calculateEndTime(e,t),i=this.formatDisplayTime(e),o=this.formatDisplayTime(s);return`${i}  ${o}`},formatDisplayTime(e){return this.timeFormat&&"function"===typeof this.timeFormat?this.timeFormat(e):e},initializeNativeResize(){console.log(" initializeNativeResize() called for booking ID:",this.booking.id);const e=this.$refs.bookingCard,t=this.$refs.resizeHandle;if(!e||!t)return void console.warn(" BookingCard or resize handle ref not available");const s=110,i=this.pxPerMinute,o=s/i;if(console.log(" Slot config:",{slotHeight:s,slotInterval:o,pxPerMin:i}),!s||!o||o<=0||!i||i<=0)return void console.error(" Invalid slot configuration:",{slotHeight:s,slotInterval:o,pxPerMin:i});let a=0,n=0,l=0,r=0;const d=t=>{t.preventDefault(),t.stopPropagation(),l=this.getBookingDuration(),n=l*i,a=t.type.includes("touch")?t.touches[0].clientY:t.clientY,e.style.height=`${n}px`,this.isResizing=!0,this.originalHeight=n,this.originalDuration=l,this.currentHeight=n,this.currentDuration=l,"vibrate"in navigator&&navigator.vibrate(10),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",this.$emit("resize-start",{bookingId:this.booking.id,originalHeight:this.originalHeight,originalDuration:this.originalDuration}),console.log(" RESIZE START:",{bookingId:this.booking.id,startHeight:n,startY:a,startDuration:l,slotInterval:o,pxPerMin:i}),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c),document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",c),document.addEventListener("touchcancel",c)},u=t=>{if(!this.isResizing)return;t.preventDefault(),r=t.type.includes("touch")?t.touches[0].clientY:t.clientY;const s=r-a;let l=n+s,d=l/i;const u=o,c=this.maxDurationMinutes||1440;d=Math.max(u,Math.min(c,d));const h=Math.round(d/o)*o,m=Math.max(u,Math.min(c,h)),g=m*i;e.style.height=`${g}px`,this.currentHeight=g,this.currentDuration=m;const p=this.calculateEndTime(this.bookingStartTime,m);this.displayDuration=this.formatTimeRange(this.bookingStartTime,m),this.isValidResize=m>=u&&m<=c,console.log(" RESIZE MOVE:",{deltaY:s,newHeight:l,newDurationMinutes:d,snappedMinutes:m,snappedHeight:g,slotInterval:o,pxPerMin:i,bookingStartTime:this.bookingStartTime,displayDuration:this.displayDuration}),this.$emit("resize-update",{bookingId:this.booking.id,newDuration:m,heightPx:g,newEndTime:p,isValid:this.isValidResize})},c=t=>{if(!this.isResizing)return;t.preventDefault(),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",c),document.removeEventListener("touchcancel",c),this.isResizing=!1,"vibrate"in navigator&&navigator.vibrate([10,20,10]),document.body.style.userSelect="",document.body.style.webkitUserSelect="";const s=this.currentHeight||e.offsetHeight,a=s/i,n=Math.round(a/o)*o,l=o,r=this.maxDurationMinutes||1440,d=Math.max(l,Math.min(r,n)),h=d*i;e.style.height=`${h}px`,this.currentHeight=h,console.log(" RESIZE END:",{bookingId:this.booking.id,finalHeight:s,finalDurationMinutes:a,snappedFinalMinutes:n,finalDuration:d,slotInterval:o,pxPerMin:i,bookingStartTime:this.bookingStartTime,calculation:`(${s} / ${i}) = ${a}  snapped to ${d}`}),this.$emit("resize-end",{bookingId:this.booking.id,finalDuration:d})};this.resizeHandlers={handleStart:d,handleMove:u,handleEnd:c},t.addEventListener("mousedown",d),t.addEventListener("touchstart",d,{passive:!1}),console.log(" Native resize initialized for booking ID:",this.booking.id)},destroyNativeResize(){const e=this.$refs.resizeHandle;if(!e||!this.resizeHandlers)return;const{handleStart:t,handleMove:s,handleEnd:i}=this.resizeHandlers;e.removeEventListener("mousedown",t),e.removeEventListener("touchstart",t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",i),document.removeEventListener("touchcancel",i),this.resizeHandlers=null,Io&&console.log(" Native resize cleanup completed")},revertResize(){this.originalHeight&&this.$refs.bookingCard&&(this.$refs.bookingCard.style.height=`${this.originalHeight}px`,this.displayDuration="",this.isResizing=!1,Io&&console.log(" Reverted resize to original height:",this.originalHeight))}},emits:["deleteItem","showDetails","edit","viewCustomerProfile","resize-start","resize-update","resize-end"]};const Ao=(0,Y.A)(Eo,[["render",go],["__scopeId","data-v-2511aeb6"]]);var Mo=Ao;const xo={class:"attendant-time-slots"},$o={class:"time-slot-lines"},Po=["data-id"],Yo=["onClick"],Vo={key:0,class:"slot-processing-spinner"},Bo={key:0,class:"slot-actions slot-actions--locked"},Xo=["onClick"],Ho={key:1,class:"slot-actions"},Wo=["onClick"],jo=["onClick"];function No(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",xo,[(0,o.Lk)("div",$o,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"time-slot-line",style:(0,n.Tr)(r.getTimeSlotLineStyle(t+1))},null,4))),128))]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.sortedAttendants,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"attendant-column",style:(0,n.Tr)(r.getAttendantColumnStyle(e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:`${e.id}-${t}`,class:"time-slot","data-id":`${e.id}-${t}`,style:(0,n.Tr)(r.getTimeSlotStyle(s))},[(0,o.Lk)("div",{class:(0,n.C4)(["time-slot-inner",{"time-slot-inner--locked":r.isSlotLockedForAttendant(t,r.getNextTimeslot(s),e.id),"time-slot-inner--selected":r.isSelectedSlot(t,e.id),"time-slot-inner--active":l.activeSlot===`${e.id}-${t}`,"time-slot-inner--processing":r.isSlotProcessing(t,r.getNextTimeslot(s),e.id)}]),onClick:i=>r.handleSlotClick(t,e,s)},[r.isSlotProcessing(t,r.getNextTimeslot(s),e.id)?((0,o.uX)(),(0,o.CE)("div",Vo,[(0,o.bF)(d,{variant:"warning",small:"",label:"Processing..."})])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[r.isSlotLockedForAttendant(t,r.getNextTimeslot(s),e.id)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[r.isSlotCenterOfLock(t,e.id)&&r.isSlotManuallyLockable(t,e.id)?((0,o.uX)(),(0,o.CE)("div",Bo,[(0,o.Lk)("button",{onClick:(0,i.D$)(i=>r.unlockSlot(t,e,s),["stop"]),class:"unlock-button"},[(0,o.bF)(u,{icon:"fa-solid fa-lock"})],8,Xo)])):(0,o.Q3)("",!0)],64)):((0,o.uX)(),(0,o.CE)("div",Ho,[(0,o.Lk)("button",{onClick:(0,i.D$)(s=>r.addBooking(t,e),["stop"]),class:"add-button"},[(0,o.bF)(u,{icon:"fa-solid fa-circle-plus"})],8,Wo),(0,o.Lk)("button",{onClick:(0,i.D$)(i=>r.lockSlot(t,e,s),["stop"]),class:"lock-button"},[(0,o.bF)(u,{icon:"fa-solid fa-unlock"})],8,jo)]))],64))],10,Yo)],12,Po))),128))],4))),128))])}s(3215);var Ro={name:"AttendantTimeSlots",data(){return{processingSlots:new Set,activeSlot:null,timeCache:new Map,END_OF_DAY:"24:00",MINUTES_IN_DAY:1440}},props:{date:{type:Date,required:!0,validator:function(e){return e instanceof Date&&!isNaN(e)}},shop:{default:function(){return{}}},sortedAttendants:{type:Array,required:!0},timeslots:{type:Array,required:!0},columnWidths:{type:Object,required:!0},slotHeight:{type:Number,default:110},selectedSlots:{type:Array,default:()=>[]},lockedTimeslots:{type:Array,default:()=>[]},processedBookings:{type:Array,default:()=>[]},availabilityIntervals:{type:Object,default:()=>({})}},watch:{lockedTimeslots:{immediate:!0,deep:!0,handler(){this.$nextTick(()=>{this.$forceUpdate()})}}},computed:{isShopsEnabled(){return!!window?.slnPWA?.is_shops},selectedShopId(){return this.shop?.id||null}},methods:{getFormattedDate(e=this.date){return this.dateFormat(e,"YYYY-MM-DD")},getTimeInMinutes(e){if(!e)return 0;if(e===this.END_OF_DAY||"24:00"===e)return this.MINUTES_IN_DAY;if(this.timeCache.has(e))return this.timeCache.get(e);const t=this.normalizeTime(e),s=this.timeToMinutes(t);return this.timeCache.set(e,s),s},isInHolidayPeriod(e,t,s,i){return!(!e||!e.length)&&e.some(e=>{const o=this.moment(e.from_date,"YYYY-MM-DD").startOf("day"),a=this.moment(e.to_date,"YYYY-MM-DD").startOf("day"),n=this.moment(t,"YYYY-MM-DD").startOf("day");return n.isBetween(o,a,"day","[]")&&this.doTimeslotsOverlap(s,i,e.from_time,e.to_time)})},isTimeInShifts(e,t){return e.some(e=>{if(!e.from||!e.to||e.disabled)return!1;const s=this.getTimeInMinutes(e.from),i=this.getTimeInMinutes(e.to);return t>=s&&t<i})},isTimeInFromToFormat(e,t,s){const i=e[0]&&t[0]&&this.getTimeInMinutes(e[0])<=s&&this.getTimeInMinutes(t[0])>s,o=e[1]&&t[1]&&this.getTimeInMinutes(e[1])<=s&&this.getTimeInMinutes(t[1])>s;return i||o},isTimeInAvailability(e,t,s){return!(!e.days||1!==e.days[s])&&(e.shifts&&e.shifts.length>0?this.isTimeInShifts(e.shifts,t):Array.isArray(e.from)&&Array.isArray(e.to)?this.isTimeInFromToFormat(e.from,e.to,t):!!e.always)},isBlockedByHolidayRule(e,t,s,i){if(null!==e.assistant_id&&e.assistant_id!==t)return!1;const o=this.moment(e.from_date,"YYYY-MM-DD"),a=this.moment(e.to_date,"YYYY-MM-DD"),n=s.isBetween(o,a,"day","[]");if(!n)return!1;const l=this.getTimeInMinutes(e.from_time);let r=this.getTimeInMinutes(e.to_time);return("00:00"===e.to_time||"24:00"===e.to_time)&&s.isSame(o,"day")&&s.isSame(a,"day")&&(r=this.MINUTES_IN_DAY),s.isSame(o,"day")&&s.isSame(a,"day")?i>=l&&i<r:s.isSame(o,"day")?i>=l:!s.isSame(a,"day")||i<r},hasWorkingDay(e,t){return e.some(e=>e.days&&1===e.days[t])},async updateLockedTimeslots(e=this.date){const t=this.getFormattedDate(e);try{const e=await this.axios.get("holiday-rules",{params:this.withShop({assistants_mode:!0,date:t})});if(e.data?.assistants_rules){const t=e.data.assistants_rules,s=Object.entries(t).flatMap(([e,t])=>t.map(t=>({...t,assistant_id:Number(e)||null,is_manual:!0===t.is_manual})));this.$emit("update:lockedTimeslots",s),this.sortedAttendants.forEach(e=>{const t=s.filter(t=>t.assistant_id===e.id);if(e.holidays=t.map(e=>({from_date:e.from_date,to_date:e.to_date,from_time:e.from_time,to_time:e.to_time,is_manual:!0===e.is_manual})),this.shop?.id){const s=e.shops?.find(e=>e.id===this.shop.id);s&&(s.holidays=t.map(e=>({from_date:e.from_date,to_date:e.to_date,from_time:e.from_time,to_time:e.to_time,is_manual:!0===e.is_manual})))}})}return e}catch(s){throw console.error("Error updating locked timeslots:",s),s}},isSlotManuallyLockable(e,t){const s=this.getFormattedDate(),i=this.getTimeInMinutes(e),o=this.lockedTimeslots.find(e=>{if(e.assistant_id!==t||e.from_date!==s)return!1;const o=this.getTimeInMinutes(e.from_time);let a=this.getTimeInMinutes(e.to_time);return"00:00"===e.to_time&&e.from_date===e.to_date&&(a=this.MINUTES_IN_DAY),i>=o&&i<a});return!!o?.is_manual},async lockSlot(e,t,s){const i=this.getNextTimeslot(s),o=this.getSlotKey(e,i,t.id);if(!this.processingSlots.has(o)){this.processingSlots.add(o);try{const s=this.getFormattedDate(),o=this.normalizeTime(e);let a;if(i)a="00:00"===i||"24:00"===i||i===this.END_OF_DAY?this.END_OF_DAY:this.normalizeTime(i);else{const e=this.moment(o,"HH:mm").add(30,"minutes"),t=e.hours(),s=e.minutes();a=0===t&&0===s?this.END_OF_DAY:e.format("HH:mm")}const n=this.withShop({assistants_mode:!0,assistant_id:t.id||null,date:s,from_date:s,to_date:s,from_time:o,to_time:a,daily:!0,is_manual:!0}),l=await this.axios.post("holiday-rules",n);if(!l.data||1!==l.data.success&&!l.data.assistants_rules)throw new Error("Lock request failed: Invalid response from server");await this.updateLockedTimeslots(),this.$emit("lock",n)}catch(a){console.error("Slot lock error:",a),a.response?.data?.message?alert("Failed to lock slot: "+a.response.data.message):a.message?alert("Failed to lock slot: "+a.message):alert("Failed to lock slot. Please try again.")}finally{this.processingSlots.delete(o)}}},async unlockSlot(e,t,s){const i=this.getNextTimeslot(s),o=this.getSlotKey(e,i,t.id);if(!this.processingSlots.has(o)){this.processingSlots.add(o);try{const s=this.getFormattedDate(),i=this.getTimeInMinutes(e),a=this.lockedTimeslots.find(e=>{const o=e.assistant_id===t.id,a=e.from_date===s,n=this.getTimeInMinutes(e.from_time),l=this.getTimeInMinutes(e.to_time);return o&&a&&i>=n&&i<l});if(!a)return void this.processingSlots.delete(o);const n=this.withShop({assistants_mode:!0,assistant_id:t.id,from_date:s,to_date:s,from_time:this.normalizeTime(a.from_time),to_time:this.normalizeTime(a.to_time),daily:!0});await this.axios.delete("holiday-rules",{data:n}),await this.updateLockedTimeslots(),this.$emit("unlock",n)}catch(a){console.error("Slot unlock error:",a)}finally{this.processingSlots.delete(o)}}},handleSlotClick(e,t,s){const i=this.isSlotLockedForAttendant(e,this.getNextTimeslot(s),t.id),o=this.lockedTimeslots.some(s=>s.assistant_id===t.id&&s.from_date===this.getFormattedDate()&&this.getTimeInMinutes(e)>=this.getTimeInMinutes(s.from_time)&&this.getTimeInMinutes(e)<this.getTimeInMinutes(s.to_time));if(i&&!o)return;const a=`${t.id}-${e}`;if(this.activeSlot){const e=document.querySelector(`.time-slot[data-id="${this.activeSlot}"]`);e&&e.classList.remove("time-slot--active")}this.activeSlot=this.activeSlot===a?null:a,this.$nextTick(()=>{if(this.activeSlot){const e=document.querySelector(`.time-slot[data-id="${a}"]`);e&&e.classList.add("time-slot--active")}})},getAttendantColumnStyle(e){const t=this.columnWidths[e.id]||245,s=this.getAssistantColumnLeft(this.sortedAttendants.findIndex(t=>t.id===e.id));return{position:"absolute",width:`${t}px`,left:`${s}px`,height:"100%",background:"rgba(171, 180, 187, .33)",borderRadius:"8px",zIndex:10}},getTimeSlotStyle(e){return{position:"absolute",top:e*this.slotHeight+"px",left:0,right:0,height:`${this.slotHeight}px`}},getAssistantColumnLeft(e){return this.sortedAttendants.slice(0,e).reduce((e,t)=>{const s=this.columnWidths[t.id]||245;return e+s+8},0)},doTimeslotsOverlap(e,t,s,i){const o=this.getTimeInMinutes(e),a=t?this.getTimeInMinutes(t):o+30,n=this.getTimeInMinutes(s),l=this.getTimeInMinutes(i);return o<l&&a>n},isSlotCenterOfLock(e,t){const s=this.getFormattedDate(),i=this.lockedTimeslots.filter(e=>{const i=e.assistant_id===t||null===e.assistant_id,o=e.from_date===s;return i&&o});if(0===i.length||i.every(e=>null===e.assistant_id))return!1;const o=this.getTimeInMinutes(e),a=i.find(e=>{const t=this.getTimeInMinutes(e.from_time);let s=this.getTimeInMinutes(e.to_time);return"00:00"===e.to_time&&e.from_date===e.to_date&&(s=this.MINUTES_IN_DAY),o>=t&&o<s});if(!a?.is_manual)return!1;const n=this.getTimeInMinutes(a.from_time);let l=this.getTimeInMinutes(a.to_time);"00:00"===a.to_time&&a.from_date===a.to_date&&(l=this.MINUTES_IN_DAY);const r=this.timeslots.filter(e=>{const t=this.getTimeInMinutes(e);return t>=n&&t<l}),d=Math.floor(r.length/2),u=r[d];return this.normalizeTime(e)===this.normalizeTime(u)},timeToMinutes(e){if(!e)return 0;if(e===this.END_OF_DAY||"24:00"===e)return this.MINUTES_IN_DAY;if("h:iip"===this.$root.settings.time_format.js_format){const t=this.moment(e,"h:mm A"),[s,i]=[t.hours(),t.minutes()];return 60*s+i}const[t,s]=e.split(":").map(Number);return 60*t+s},isSelectedSlot(e,t){return this.selectedSlots.some(s=>s.timeslot===e&&s.attendantId===t)},addBooking(e,t){this.$emit("add",{timeslot:e,attendantId:t.id})},isSlotProcessing(e,t,s){return this.processingSlots.has(this.getSlotKey(e,t,s))},getNextTimeslot(e){return e+1<this.timeslots.length?this.timeslots[e+1]:null},getSlotKey(e,t,s){return`${s}-${e}-${t}`},isTimeSlotAllowedByRule(e,t,s){if(e.select_specific_dates&&e.specific_dates){const i=e.specific_dates.split(","),o=this.getFormattedDate(s);return!!i.includes(o)&&(Array.isArray(e.from)&&Array.isArray(e.to)&&e.from.length>0&&e.to.length>0?Object.keys(e.from).some(s=>{if(s>0&&e.disable_second_shift)return!1;const i=this.getTimeInMinutes(e.from[s]),o=this.getTimeInMinutes(e.to[s]);return t>=i&&t<o}):!!e.always)}if(!e.always&&(e.from_date||e.to_date)){const t=e.from_date?this.moment(e.from_date,"YYYY-MM-DD"):null,i=e.to_date?this.moment(e.to_date,"YYYY-MM-DD"):null;if(t&&s.isBefore(t,"day"))return!1;if(i&&s.isAfter(i,"day"))return!1}return e.shifts&&e.shifts.length?this.isTimeInShifts(e.shifts,t):Array.isArray(e.from)&&Array.isArray(e.to)?!(!e.days||1!==e.days[s.isoWeekday()])&&Object.keys(e.from).some(s=>{if(s>0&&e.disable_second_shift)return!1;const i=this.getTimeInMinutes(e.from[s]),o=this.getTimeInMinutes(e.to[s]);return t>=i&&t<o}):!(!e.always||!e.days||1!==e.days[s.isoWeekday()])},isSlotLockedForAttendant(e,t,s){try{if(!e)return!0;const t=this.getFormattedDate(),i=this.moment(t,"YYYY-MM-DD"),o=i.day()+1,a=this.sortedAttendants.find(e=>e.id===s);if(!a)return!0;const n=this.getTimeInMinutes(e),l=this.$root.settings?.available_days||{};if("1"!==l[o])return!0;const r=this.lockedTimeslots.find(e=>this.isBlockedByHolidayRule(e,s,i,n));if(r)return!0;const d=this.$root.settings?.holidays?.some(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),s=this.moment(e.to_date,"YYYY-MM-DD");if(!i.isBetween(t,s,"day","[]"))return!1;if(i.isSame(t,"day")&&i.isSame(s,"day")){const t=this.getTimeInMinutes(e.from_time),s=this.getTimeInMinutes(e.to_time);return n>=t&&n<s}return i.isSame(t,"day")?n>=this.getTimeInMinutes(e.from_time):!i.isSame(s,"day")||n<this.getTimeInMinutes(e.to_time)});if(d)return!0;if(a.availabilities?.length){const e=a.availabilities.some(e=>this.isTimeSlotAllowedByRule(e,n,i));return!e}const u=this.$root.settings?.availabilities||[];if(!u.length)return!0;{const e=u.filter(e=>"1"===e.days?.[o]);if(0===e.length)return!0;const t=e.some(e=>e.shifts?.length?this.isTimeInShifts(e.shifts,n):Array.isArray(e.from)&&Array.isArray(e.to)?this.isTimeInFromToFormat(e.from,e.to,n):!!e.always);if(!t)return!0}return!1}catch(i){return console.error("Error in isSlotLockedForAttendant:",i),!0}},getAssistantShopData(e,t,s){if(!e||!e.shops||!t)return null;const i=e.shops.find(e=>e.id===t);return i?.[s]||null},normalizeTime(e){if(!e)return e;if(e===this.END_OF_DAY||"24:00"===e)return this.END_OF_DAY;if("h:iip"===this.$root.settings?.time_format?.js_format){const t=this.moment(e,"h:mm A");return t.format("HH:mm")}const t=this.getTimeFormat();return this.moment(e,t).format("HH:mm")},getTimeSlotLineStyle(e){const t=e*this.slotHeight;return{position:"absolute",left:0,right:0,top:`${t}px`,height:"1px",backgroundColor:"#ddd",zIndex:1}},withShop(e={}){return this.isShopsEnabled&&this.selectedShopId?{...e,shop:this.selectedShopId}:{...e}}},emits:["add","update:lockedTimeslots","slot-processing","lock","unlock"]};const zo=(0,Y.A)(Ro,[["render",No],["__scopeId","data-v-b821116e"]]);var Uo=zo;const Oo=!1;var qo={name:"ReservationsCalendar",mixins:[Ce],components:{TimeAxis:Js,AttendantsList:li,TimeSlots:mi,SlotActions:Ti,SlotsHeadline:Pi,SearchInput:Wi,BookingCalendar:Zi,BookingCard:Mo,AttendantTimeSlots:Uo},props:{modelValue:{type:Date,default:()=>new Date},shop:{default:function(){return{}}}},data(){return{timeslots:[],lockedTimeslots:[],availabilityStats:[],bookingsList:[],availabilityIntervals:{},search:"",activeSlotIndex:-1,currentTimeLinePosition:0,showCurrentTimeLine:!0,isLoadingTimeslots:!1,isLoadingCalendar:!1,isLoading:!1,loadingQueue:[],slotHeight:110,cardWidth:245,gap:0,isDragging:!1,wasRecentlyDragging:!1,possibleDrag:!1,startX:0,startY:0,scrollLeft:0,updateIntervalId:null,timelineIntervalId:null,abortControllers:{},isAttendantView:"true"===localStorage.getItem("isAttendantView")||!1,attendantColumnWidth:245,attendantColumnGap:8,attendants:[],attendantsLoaded:!1,timeFormatNew:"simple",slotProcessingStates:new Map,slotProcessing:{},selectedTimeSlots:[],resizingBookingId:null,tempDurations:{},originalBookingStates:{},savingBookingIds:new Set,END_OF_DAY:"24:00",MINUTES_IN_DAY:1440}},computed:{pxPerMinute(){return this.slotHeight/this.calcSlotStep()},dragHandlers(){return{mousedown:this.onMouseDown,mousemove:this.onMouseMove,mouseup:this.onMouseUp,mouseleave:this.onMouseLeave,touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd}},date:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canvasWidth(){return this.$refs.dragScrollContainer?.clientWidth??500},canvasHeight(){return this.timeslots.length*this.slotHeight},canvasStyle(){if(this.isAttendantView){const e=this.sortedAttendants.reduce((e,t,s)=>{const i=this.columnWidths?.[t.id]??this.attendantColumnWidth,o=s<this.sortedAttendants.length-1?this.attendantColumnGap:0;return e+i+o},0);return{height:`${this.canvasHeight}px`,width:`${e}px`,minWidth:`${e}px`}}const e=Math.max(this.bookingsList.length*(this.cardWidth+this.gap),this.canvasWidth);return{height:`${this.canvasHeight}px`,width:`${e}px`,minWidth:"calc(100% + 245px)"}},processedBookings(){return this.isAttendantView?this.bookingsList.flatMap(e=>{if(!e.services||0===e.services.length)return[{...e,_serviceTime:{start:e.time,end:this.calculateEndTime(e.time,this.getDefaultDuration(e))},_assistantId:0,_isDefaultDuration:!0}];const t=e.services.reduce((e,t)=>{const s=t.assistant_id||0;return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.entries(t).map(([t,s])=>{const i=[...s].sort((t,s)=>{const i=this.getMinutes(t.start_at||e.time),o=this.getMinutes(s.start_at||e.time);return i-o}),o=i[0],a=i[i.length-1];return{...e,services:i,_serviceTime:{start:o.start_at||e.time,end:a.end_at||this.calculateEndTime(a.start_at||e.time,this.getDefaultDuration(e))},_assistantId:parseInt(t),_isDefaultDuration:!a.end_at}})}):[...this.bookingsList]},sortedAttendants(){return Array.isArray(this.attendants)&&0!==this.attendants.length?this.attendants:[]},shouldShowAttendants(){return this.isAttendantView&&this.attendants&&this.attendants.length>0},columnWidths(){if(!this.isAttendantView)return{};const e={};return this.sortedAttendants.forEach(t=>{const s=new Map,i=this.processedBookings.filter(e=>e._assistantId===t.id);i.forEach(e=>{if(!e._serviceTime)return;const t=this.getMinutes(e._serviceTime.start),i=this.getMinutes(e._serviceTime.end)-t,o=this.getDisplayDuration(e,i),a=t+o;for(let n=t;n<a;n++){const e=s.get(n)||0;s.set(n,e+1)}});const o=s.size>0?Math.max(...s.values()):1;e[t.id]=this.cardWidth*o+this.attendantColumnGap*(o-1)}),e},isReadyToRender(){if(this.bookingsList.length>0&&this.timeslots.length>0&&this.availabilityIntervals.length>0&&this.bookingsList.forEach(e=>{let t=e.time;!this.timeslots.includes(t)&&t<this.timeslots[0]&&this.timeslots.unshift(t)}),this.isAttendantView){if(!this.attendantsLoaded)return!1;if(0===this.attendants.length)return!1;if(!this.availabilityIntervals||0===Object.keys(this.availabilityIntervals).length)return!1}return!this.isLoadingTimeslots&&this.attendantsLoaded&&this.timeslots.length>0},validatedHolidayRule(){return e=>!(!e||"object"!==typeof e)&&(!(!e.from_date||!e.to_date)&&(!(!e.from_time||!e.to_time)&&(this.moment(e.from_date,"YYYY-MM-DD").isValid()&&this.moment(e.to_date,"YYYY-MM-DD").isValid()&&/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e.from_time)&&/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e.to_time))))},isShopsEnabled(){return!!window?.slnPWA?.is_shops},selectedShopId(){return this.shop?.id||null}},watch:{shop:{handler(e,t){e?.id!==t?.id&&(this.activeSlotIndex=-1,this.loadAllData())},deep:!0},bookingsList(){this.arrangeBookings(),this.$nextTick(()=>{this.$forceUpdate()})},attendantsLoaded(e){e&&this.$nextTick(()=>{this.$forceUpdate()})},"$root.settings":{handler(e){e?.attendant_enabled?this.loadAttendants():(this.attendantsLoaded=!0,this.isAttendantView=!1),this.timeFormatNew="H:iip"===e?.time_format.js_format?"am":"simple",this.dateFormat=e?.date_format||"YYYY-MM-DD"},deep:!0},isAttendantView(e){localStorage.setItem("isAttendantView",e),this.loadAllData()},date(e,t){e.getTime()!==t?.getTime()&&this.loadAllData()}},mounted(){this.loadAllData(),this._calendarResetHandler=()=>this.loadAllData(),window.addEventListener("sln-calendar-cache-cleared",this._calendarResetHandler),setTimeout(()=>{const e=window.document.querySelectorAll(".dp__calendar");if(e[0]){const t=window.document.querySelectorAll(".spinner-wrapper")[0],s=window.document.querySelectorAll(".calendar .spinner-border")[0];t&&e[0].appendChild(t),s&&e[0].appendChild(s)}},0),this.updateIntervalId=setInterval(()=>this.update(),6e4),this.timelineIntervalId=setInterval(()=>{this.updateCurrentTimeLinePosition()},6e4),this.$nextTick(()=>{this.updateCurrentTimeLinePosition();const e=this.$refs.dragScrollContainer;e&&e.addEventListener("touchmove",this.onTouchMove,{passive:!1})}),this.$refs.slotsContainer&&this.$refs.slotsContainer.addEventListener("click",e=>{e.target===this.$refs.slotsContainer&&this.handleOutsideClick()})},beforeUnmount(){window.removeEventListener("sln-calendar-cache-cleared",this._calendarResetHandler),this.updateIntervalId&&clearInterval(this.updateIntervalId),this.timelineIntervalId&&clearInterval(this.timelineIntervalId),Object.values(this.abortControllers).forEach(e=>{e&&e.abort&&e.abort()}),this.abortControllers={};const e=this.$refs.dragScrollContainer;e&&e.removeEventListener("touchmove",this.onTouchMove),this.$refs.slotsContainer&&this.$refs.slotsContainer.removeEventListener("click",this.handleOutsideClick)},methods:{loadAllData(){this.cancelPendingLoads(),this.isLoading=!0;const e=()=>this.shop?.id?this.axios.get("app/settings",{params:{shop:this.shop.id}}).then(e=>(e.data?.settings&&(this.$root.settings=e.data.settings),e)):this.axios.get("app/settings").then(e=>(e.data?.settings&&(this.$root.settings=e.data.settings),e));e().then(()=>this.loadTimeslots()).then(()=>{const e=[this.loadLockedTimeslots(),this.loadBookingsList(),this.loadAvailabilityIntervals()],t=this.date,s=t.getFullYear(),i=t.getMonth(),o=new Date(s,i,1),a=new Date(s,i+1,0);return e.push(this.loadAvailabilityStats(o,a)),this.isAttendantView&&this.$root.settings?.attendant_enabled&&!this.attendantsLoaded&&e.push(this.loadAttendants()),this.loadingQueue=e,Promise.all(e)}).then(()=>{this.$nextTick(()=>{this.arrangeBookings(),this.$forceUpdate()})}).catch(e=>{console.error("Error loading calendar data:",e)}).finally(()=>{this.isLoading=!1})},cancelPendingLoads(){this.loadingQueue=[]},async loadTimeslots(){const e="timeslots";this.abortControllers[e]&&this.abortControllers[e].abort();const t=new AbortController;this.abortControllers[e]=t,this.isLoadingTimeslots=!0;try{const s=await this.axios.get("calendar/intervals",{params:this.withShop({}),signal:t.signal});return this.timeslots=(s.data.items||[]).map(e=>"00:00"===e?this.END_OF_DAY:e),this.updateCurrentTimeLinePosition(),delete this.abortControllers[e],s}catch(s){if("AbortError"===s.name||"CanceledError"===s.name)return void console.log("Timeslots request cancelled");throw s}finally{this.isLoadingTimeslots=!1}},async loadLockedTimeslots(){try{const e=await this.axios.get("holiday-rules",{params:this.withShop({assistants_mode:!1,date:this.moment(this.date).format("YYYY-MM-DD")})}),t=e.data?.items||[];if(this.isAttendantView){const e=await this.axios.get("holiday-rules",{params:this.withShop({assistants_mode:!0,date:this.moment(this.date).format("YYYY-MM-DD")})}),s=e.data?.assistants_rules||{},i=Object.entries(s).flatMap(([e,t])=>t.map(t=>({...t,assistant_id:Number(e)||null,is_manual:!0===t.is_manual}))),o=t.map(e=>({...e,assistant_id:null}));this.lockedTimeslots=this.dedupeRules([...o,...i])}else this.lockedTimeslots=this.dedupeRules(t);return this.$nextTick(()=>{this.$forceUpdate()}),{data:{status:"OK"}}}catch(e){throw console.error("Error loading locked timeslots:",e.response?.data||e.message),e}},dedupeRules(e){const t=new Set;return e.filter(e=>{const s=[e.assistant_id??null,e.from_date,e.to_date,this.normalizeTime(e.from_time),this.normalizeTime(e.to_time),e.daily?1:0,e.is_manual?1:0].join("|");return!t.has(s)&&(t.add(s),!0)})},async loadBookingsList(){const e="bookings";this.abortControllers[e]&&this.abortControllers[e].abort();const t=new AbortController;this.abortControllers[e]=t;try{const s=await this.axios.get("bookings",{params:{start_date:this.moment(this.date).format("YYYY-MM-DD"),end_date:this.moment(this.date).format("YYYY-MM-DD"),per_page:-1,statuses:["sln-b-pendingpayment","sln-b-pending","sln-b-paid","sln-b-paylater","sln-b-confirmed"],shop:this.shop?.id||null},signal:t.signal}),i=s.data.items||[],o=new Map(i.map(e=>[e.id,e]));return this.bookingsList=[],this.bookingsList=this.bookingsList.map(e=>o.has(e.id)?{...e,...o.get(e.id)}:e),i.forEach(e=>{this.bookingsList.some(t=>t.id===e.id)||this.bookingsList.push(e)}),delete this.abortControllers[e],s}catch(s){if("AbortError"===s.name||"CanceledError"===s.name)return void console.log("Bookings request cancelled");throw console.error("Error loading bookings list:",s),s}},updateSlotProcessing({slot:e,status:t}){this.slotProcessing={...this.slotProcessing,[e]:t}},handleAttendantLock(e){console.log("Lock payload:",e)},handleAttendantUnlock(e){console.log("Unlock payload:",e)},async loadAvailabilityStats(e,t){this.isLoadingCalendar=!0;try{const s=await this.axios.get("availability/stats",{params:this.withShop({from_date:this.moment(e).format("YYYY-MM-DD"),to_date:this.moment(t).format("YYYY-MM-DD")})});return this.availabilityStats=s.data.stats,s}finally{this.isLoadingCalendar=!1}},async loadAvailabilityIntervals(){const e="availabilityIntervals";this.abortControllers[e]&&this.abortControllers[e].abort();const t=new AbortController;this.abortControllers[e]=t;const s=this.timeslots.length>0?this.timeslots[0]:"09:00",i=this.moment(this.date).format("YYYY-MM-DD");try{const o=await this.axios.post("availability/intervals",this.withShop({date:i,time:s}),{signal:t.signal}),a=o.data.intervals,n=a?.universalSuggestedDate;return n&&n!==i?(console.warn(`Date mismatch: requested ${i}, got ${n}`),this.availabilityIntervals={times:{},workTimes:{},dates:a.dates||[],fullDays:a.fullDays||[]}):this.availabilityIntervals=a,delete this.abortControllers[e],o}catch(o){if("AbortError"===o.name||"CanceledError"===o.name)return void console.log("Availability intervals request cancelled");throw console.error("Error loading availability intervals:",o),o}},async loadAttendants(){try{const e=await this.axios.get("assistants",{params:this.withShop({per_page:-1,orderby:"order",order:"asc"})});return this.attendants=e.data.items,this.attendantsLoaded=!0,e}catch(e){throw console.error("Error loading attendants:",e),this.attendantsLoaded=!0,e}},async update(){await this.loadBookingsList(),this.$refs.attendantTimeSlots&&await this.$refs.attendantTimeSlots.updateLockedTimeslots()},withShop(e={}){return this.isShopsEnabled&&this.selectedShopId?{...e,shop:this.selectedShopId}:{...e}},addBookingForAttendant({timeslot:e,attendantId:t}){const s=this.modelValue;this.$emit("add",s,e,t)},handleSearch(e){this.activeSlotIndex=-1,e?this.loadFilteredBookings(e):this.loadBookingsList()},async loadFilteredBookings(e){this.isLoadingTimeslots=!0,this.bookingsList=[];const t=this.isAttendantView;try{const s=await this.axios.get("bookings",{params:{start_date:this.moment(this.date).format("YYYY-MM-DD"),end_date:this.moment(this.date).format("YYYY-MM-DD"),search:e,per_page:-1,statuses:["sln-b-pendingpayment","sln-b-pending","sln-b-paid","sln-b-paylater","sln-b-confirmed"],shop:this.shop?.id||null}});this.bookingsList=s.data.items,this.arrangeBookings(),this.isAttendantView=t}finally{this.isLoadingTimeslots=!1}},handleSlotLock(e){this.lockedTimeslots.push(e),this.axios.post("holiday-rules",this.withShop(this.normalizeRule(e))).catch(()=>{this.lockedTimeslots=this.lockedTimeslots.filter(t=>!this.isSameRule(t,e))})},async handleSlotUnlock(e){const t=`${e.from_time}-${e.to_time}`;this.updateSlotProcessing({slot:t,status:!0}),this.lockedTimeslots=this.lockedTimeslots.filter(t=>!this.isSameRule(t,e)),this.updateLocalAvailability(e,!0);try{await this.axios.delete("holiday-rules",{data:this.withShop(this.normalizeRule(e))})}catch(s){this.lockedTimeslots.push(e),console.error("Unlock failed:",s)}finally{this.updateSlotProcessing({slot:t,status:!1}),this.$nextTick(()=>this.$forceUpdate())}},updateLocalAvailability(e,t){if(!this.availabilityIntervals)return;const{times:s={},workTimes:i={}}=this.availabilityIntervals,o=this.calcSlotStep(),a=this.timeToMinutes(e.from_time),n=this.timeToMinutes(e.to_time);if(t){const e={...s},t={...i};for(let s=a;s<n;s+=o){const i=`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`;e[s]=i,t[s]=i}this.availabilityIntervals={...this.availabilityIntervals,times:e,workTimes:t}}},isSameRule(e,t){const s=this.normalizeTime(e.from_time),i=this.normalizeTime(e.to_time),o=this.normalizeTime(t.from_time),a=this.normalizeTime(t.to_time);return e.from_date===t.from_date&&e.to_date===t.to_date&&s===o&&i===a&&(e.assistant_id??null)===(t.assistant_id??null)},normalizeRule(e){return{from_date:e.from_date,to_date:e.to_date,from_time:this.moment(e.from_time,"HH:mm").format("HH:mm"),to_time:this.moment(e.to_time,"HH:mm").format("HH:mm"),daily:!0,assistant_id:e.assistant_id??null}},handleMonthYear({year:e,month:t}){const s=new Date(e,t,1),i=new Date(e,t+1,0);this.loadAvailabilityStats(s,i)},isSlotLocked(e){try{if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!1;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if(!1===this.$root.settings?.available_days?.[o])return!0;const a=this.$root.settings.holidays?.find(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(a)return!0;const n=this.lockedTimeslots.find(e=>null==e.assistant_id&&(e.from_date===t&&e.to_date===t&&i>=this.timeToMinutes(this.normalizeTime(e.from_time))&&i<this.timeToMinutes(this.normalizeTime(e.to_time))));if(n)return!0;const l=this.lockedTimeslots.find(e=>{const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(l)return!0;const r=this.$root.settings.availabilities||[];if(r.length){const e=r.filter(e=>"1"===e.days?.[o]);if(0===e.length)return!0;const t=e.some(e=>e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s}));if(!t)return!0}const d=this.availabilityIntervals.workTimes||{},u=this.availabilityIntervals.times||{},c=Object.keys(d).length?d:u;return!Object.values(c).some(e=>i===this.timeToMinutes(e))}catch{return!0}},isAvailable(e){if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!0;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if(!1===this.$root.settings?.available_days?.[o])return!1;const a=this.$root.settings.holidays?.find(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(a)return!1;const n=this.lockedTimeslots.find(e=>null==e.assistant_id&&(e.from_date===t&&e.to_date===t&&i>=this.timeToMinutes(this.normalizeTime(e.from_time))&&i<this.timeToMinutes(this.normalizeTime(e.to_time))));if(n)return!1;const l=this.lockedTimeslots.find(e=>!(t<e.from_date||t>e.to_date)&&(t===e.from_date?i>=this.timeToMinutes(e.from_time):t!==e.to_date||i<this.timeToMinutes(e.to_time)));if(l)return!1;const r=this.availabilityStats.find(e=>e.date===t&&"holiday_rules"===e.error?.type);if(r)return!1;const d=this.$root.settings.availabilities||[];if(d.length){const e=d.find(e=>e.days?.[o]);if(!e)return!1;const t=e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s});if(!t)return!1}const u=this.availabilityIntervals.workTimes||{},c=this.availabilityIntervals.times||{},h=Object.keys(u).length?u:c;return Object.values(h).some(e=>i===this.timeToMinutes(e))},isSystemLocked(e){try{if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!1;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if("1"!==this.$root.settings?.available_days?.[o])return!0;const a=this.$root.settings.availabilities||[];if(a.length){const e=a.find(e=>"1"===e.days?.[o]);if(!e)return!0;const t=e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s});if(!t)return!0}return!1}catch(t){return console.error("error isSlotLocked:",t),!0}},isManualLocked(e){const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.timeToMinutes(this.normalizeTime(e)),i=this.moment(t,"YYYY-MM-DD"),o=this.lockedTimeslots.some(e=>{if(null!=e.assistant_id)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");if(!i.isBetween(t,o,"day","[]"))return!1;const a=this.timeToMinutes(this.normalizeTime(e.from_time)),n=this.timeToMinutes(this.normalizeTime(e.to_time));return t.isSame(o,"day")?s>=a&&s<n:i.isSame(t,"day")?s>=a:!i.isSame(o,"day")||s<n}),a=this.$root.settings.holidays?.some(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!i.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?s>=this.timeToMinutes(e.from_time)&&s<this.timeToMinutes(e.to_time):i.isSame(t,"day")?s>=this.timeToMinutes(e.from_time):!i.isSame(o,"day")||s<this.timeToMinutes(e.to_time))})||!1;return o||a},normalizeTime(e){if(!e)return e;if(e===this.END_OF_DAY||"24:00"===e)return this.END_OF_DAY;if("h:iip"===this.$root.settings?.time_format?.js_format){const t=this.moment(e,"h:mm A");return t.format("HH:mm")}const t=this.getTimeFormat();return this.moment(e,t).format("HH:mm")},timeToMinutes(e){if(!e)return 0;if(e===this.END_OF_DAY||"24:00"===e)return this.MINUTES_IN_DAY;const[t,s]=e.split(":").map(Number);return 60*t+s},setSlotProcessing(e,t){t?this.slotProcessingStates.set(e,!0):this.slotProcessingStates.delete(e)},toggleSlotActions(e){this.isDragging||this.wasRecentlyDragging||(this.activeSlotIndex=this.activeSlotIndex===e?-1:e)},addBooking(e){const t=this.modelValue,s=e||this.timeslots[0];this.$emit("add",t,s)},deleteItem(e){this.axios.delete("bookings/"+e).then(()=>{this.bookingsList=this.bookingsList.filter(t=>t.id!==e)})},showDetails(e){this.$emit("showItem",e)},handleResizeStart({bookingId:e,originalDuration:t,originalHeight:s}){this.resizingBookingId=e;const i=this.bookingsList.find(t=>t.id===e);i&&(this.originalBookingStates[e]={duration:t,height:s,services:JSON.parse(JSON.stringify(i.services))}),Oo&&console.log(" Resize started, original state saved:",this.originalBookingStates[e])},handleResizeUpdate({bookingId:e,newDuration:t,heightPx:s}){Oo&&console.log(" handleResizeUpdate RECEIVED:",{bookingId:e,newDuration:t,heightPx:s});const i=this.bookingsList.find(t=>t.id===e);if(!i)return void console.warn(" Booking not found during resize update:",e);const o=this.validateResizeDuration(i,t);o.valid?(this.tempDurations[e]=t,Oo&&console.log(" tempDurations updated:",this.tempDurations)):Oo&&console.warn(" Invalid duration during drag:",o.error)},async handleResizeEnd({bookingId:e,finalDuration:t}){Oo&&console.log(" handleResizeEnd CALLED:",{bookingId:e,finalDuration:t});const s=t||this.tempDurations[e];if(Oo&&console.log(" Using duration:",s),!s)return console.error(" No duration found! Aborting save."),void this.revertBookingResize(e);const i=this.bookingsList.find(t=>t.id===e);if(!i)return console.error(" Booking not found! ID:",e),void this.revertBookingResize(e);const o=this.validateResizeDuration(i,s);if(!o.valid)return this.showResizeError(o.error),this.revertBookingResize(e),void(this.resizingBookingId=null);const a=this.checkBookingOverlap(i,s);if(a.hasOverlap){const t=`${a.conflictingBooking.customer_first_name} ${a.conflictingBooking.customer_last_name}`;return this.showResizeError(`Time slot conflicts with another booking (${t})`),this.revertBookingResize(e),void(this.resizingBookingId=null)}this.savingBookingIds.add(e),this.tempDurations[e]=s;try{const t=Math.floor(s/60),o=s%60,a=`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}`,n={date:i.date,time:i.time,services:i.services.map(e=>({service_id:e.service_id,assistant_id:e.assistant_id||0,resource_id:e.resource_id||0,duration:a}))};Oo&&console.log(" SENDING PUT request:",n);const l=await this.axios.put(`bookings/${e}`,n);console.log(" PUT response:",l.data),console.log(` Duration saved: ${a} (${s} min)`);const r=this.bookingsList.find(t=>t.id===e);r&&r.services&&r.services.length>0&&r.services.forEach(e=>{e.duration=a}),await this.loadBookingsList(),await this.$nextTick();const d=this.$refs.bookingCard;if(d){const t=Array.isArray(d)?d:[d];for(const s of t)if(s&&(s.booking?.id===e||s.$attrs?.booking?.id===e)){const t=s.$el?.querySelector?.(".booking-wrapper")||s.$el;t&&(t.style.height="",console.log(" Cleared inline height style for booking",e));break}}const u=this.bookingsList.find(t=>t.id===e);if(u){const t=u.services&&u.services[0];let i=30;if(t)if(t.duration){const[e,s]=t.duration.split(":").map(Number);i=60*e+s}else if(t.start_at&&t.end_at){const[e,s]=t.start_at.split(":").map(Number),[o,a]=t.end_at.split(":").map(Number),n=60*e+s,l=60*o+a;i=l-n}if(30===i&&u.duration){const[e,t]=u.duration.split(":").map(Number);i=60*e+t}console.log(" Duration verification:",{expected:s,reloaded:i,service:t?{start_at:t.start_at,end_at:t.end_at,duration:t.duration}:null,bookingDuration:u.duration}),Math.abs(i-s)<=1?(delete this.tempDurations[e],delete this.originalBookingStates[e],console.log(" Resize completed successfully, booking updated correctly")):console.warn(" Duration mismatch after reload. Expected:",s,"Got:",i)}else console.error(" Booking not found after reload!")}catch(n){console.error(" Failed to save duration:",n);const t=n.response?.data?.message||"Failed to update booking. Please try again.";this.showResizeError(t),this.revertBookingResize(e)}finally{this.savingBookingIds.delete(e),this.resizingBookingId=null,this.$forceUpdate()}},updateCurrentTimeLinePosition(){if(!this.timeslots||!this.timeslots.length)return void(this.showCurrentTimeLine=!1);const e=this.timeslots[0],t=this.timeslots[this.timeslots.length-1],s=this.moment(),i=this.moment(e,"HH:mm").set({year:s.year(),month:s.month(),date:s.date()});let o=this.moment(t,"HH:mm").set({year:s.year(),month:s.month(),date:s.date()});if(o.isBefore(i)&&o.add(1,"day"),s.isBefore(i))return this.currentTimeLinePosition=0,void(this.showCurrentTimeLine=!0);if(s.isAfter(o))return this.currentTimeLinePosition=this.timeslots.length*this.slotHeight-2,void(this.showCurrentTimeLine=!0);const a=this.calcSlotStep(),n=s.diff(i,"minutes"),l=n/a*this.slotHeight;this.currentTimeLinePosition=Math.max(0,Math.min(l,this.timeslots.length*this.slotHeight)),this.showCurrentTimeLine=!0},arrangeBookings(){if(!Array.isArray(this.bookingsList))return;this.columns=[];const e=[...this.bookingsList].sort((e,t)=>{const s=this.getBookingStart(e),i=this.getBookingStart(t);return s-i});e.forEach(e=>{e&&(e._column=this.findFreeColumn(e))}),null!==document.querySelector(".dp__active_date.dp__today")?null!==document.querySelector(".current-time-line")&&(document.querySelector(".current-time-line").style.display="block",document.querySelector(".current-time-line").scrollIntoView({behavior:"smooth",block:"center"})):null!==document.querySelector(".current-time-line")&&(document.querySelector(".current-time-line").style.display="none")},findFreeColumn(e){for(let t=0;t<this.columns.length;t++)if(!this.doesOverlapColumn(e,this.columns[t]))return this.columns[t].push(e),t;return this.columns.push([e]),this.columns.length-1},doesOverlapColumn(e,t){const s=this.getBookingStart(e),i=this.getBookingEnd(e);return t.some(e=>{const t=this.getBookingStart(e),o=this.getBookingEnd(e);return s<o&&i>t})},hasOverlappingBookings(e){const t=this.getMinutes(this.timeslots[e]),s=e+1<this.timeslots.length?this.getMinutes(this.timeslots[e+1]):t+this.calcSlotStep();return this.bookingsList.some(e=>{const i=this.getBookingStart(e),o=this.getBookingEnd(e);return i<s&&o>t})},calcSlotStep(){if(!this.timeslots||this.timeslots.length<2)return 30;const e=this.getMinutes(this.timeslots[0]),t=this.getMinutes(this.timeslots[1]);return t-e},getBookingStart(e){return e&&e.time?this.getMinutes(e.time):0},getBookingEnd(e){if(!e)return 0;let t=e.time;if(e.services?.length){const s=e.services[e.services.length-1];t=s.end_at||e.time}const s=this.getMinutes(e.time),i=this.getMinutes(t),o=i-s,a=this.getDisplayDuration(e,o);return s+a},getBookingStyle(e){const t=this.timeslots[0],s=this.getMinutes(t);let i,o,a;if(this.isAttendantView){i=this.getMinutes(e._serviceTime.start);const t=this.getMinutes(e._serviceTime.end)-i;a=this.getDisplayDuration(e,t),o=i+a}else if(i=this.getMinutes(e.time),e.services?.length){const t=e.services[e.services.length-1],s=t.end_at||e.time,n=this.getMinutes(s)-i;a=this.getDisplayDuration(e,n),o=i+a}else a=this.getDefaultDuration(e),o=i+a;this.tempDurations[e.id]&&(a=this.tempDurations[e.id],o=i+a);const n=this.slotHeight/this.calcSlotStep(),l=(i-s)*n,r=Math.max((o-i)*n,this.slotHeight);let d=0;if(this.isAttendantView){const t=this.sortedAttendants.findIndex(t=>t.id===e._assistantId);t>=0&&(d=this.getAssistantColumnLeft(t),d+=this.getBookingPosition(e))}else{const t=e._column||0;d=t*this.cardWidth}return{position:"absolute",top:`${l}px`,left:`${d}px`,width:`${this.cardWidth}px`,height:`${r}px`}},getTimeSlotLineStyle(e){const t=e*this.slotHeight;return{position:"absolute",left:"0",right:"0",top:`${t}px`,height:`${this.slotHeight}px`,display:"flex",alignItems:"center",borderTop:e>0?"1px solid #ddd":"none",backgroundColor:"#EDF0F5",boxSizing:"border-box"}},getAssistantColumnLeft(e){return this.sortedAttendants.slice(0,e).reduce((e,t)=>{const s=this.columnWidths[t.id]||this.attendantColumnWidth;return e+s+this.attendantColumnGap},0)},getBookingPosition(e){const t=e._assistantId,s=this.getMinutes(e._serviceTime.start),i=this.getMinutes(e._serviceTime.end)-s,o=this.getDisplayDuration(e,i),a=s+o,n=this.processedBookings.filter(i=>{if(i._assistantId!==t||i.id===e.id)return!1;const o=this.getMinutes(i._serviceTime.start),n=this.getMinutes(i._serviceTime.end)-o,l=this.getDisplayDuration(i,n),r=o+l;return s<r&&a>o}).sort((e,t)=>{const s=this.getMinutes(e._serviceTime.start),i=this.getMinutes(t._serviceTime.start);return s===i?e.id-t.id:s-i});if(0===n.length)return e._position=0,0;const l=new Set(n.map(e=>e._position||0));let r=0;while(l.has(r))r++;return e._position=r,r*this.cardWidth},getMinutes(e){if(e===this.END_OF_DAY||"24:00"===e)return this.MINUTES_IN_DAY;const[t,s]=e.split(":").map(Number);return 60*t+s},getDefaultDuration(e){return e.services?.length?this.getDisplayDuration(e,30):30},getDisplayDuration(e,t){return t},calculateEndTime(e,t){const[s,i]=e.split(":").map(Number),o=60*s+i+t,a=Math.floor(o/60),n=o%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},onMouseDown(e){this.$refs.dragScrollContainer&&(this.possibleDrag=!0,this.isDragging=!1,this.wasRecentlyDragging=!1,this.startX=e.pageX-this.$refs.dragScrollContainer.offsetLeft,this.scrollLeft=this.$refs.dragScrollContainer.scrollLeft,document.body.style.userSelect="none")},onMouseMove(e){if(!this.possibleDrag)return;const t=e.pageX-this.$refs.dragScrollContainer.offsetLeft,s=Math.abs(t-this.startX);s>5&&(this.isDragging=!0,this.activeSlotIndex=-1),this.isDragging&&(e.preventDefault(),this.$refs.dragScrollContainer.scrollLeft=this.scrollLeft-(t-this.startX))},onMouseUp(){this.possibleDrag=!1,this.isDragging&&(this.isDragging=!1,this.wasRecentlyDragging=!0,setTimeout(()=>{this.wasRecentlyDragging=!1},200)),document.body.style.userSelect=""},onMouseLeave(){this.possibleDrag&&this.onMouseUp()},onTouchStart(e){this.$refs.dragScrollContainer&&(this.isDragging=!1,this.possibleDrag=!0,this.startX=e.touches[0].clientX-this.$refs.dragScrollContainer.offsetLeft,this.startY=e.touches[0].clientY,this.scrollLeft=this.$refs.dragScrollContainer.scrollLeft)},onTouchMove(e){if(!this.possibleDrag)return;const t=e.touches[0].clientX-this.$refs.dragScrollContainer.offsetLeft,s=e.touches[0].clientY,i=Math.abs(t-this.startX),o=Math.abs(s-this.startY);i>5&&i>o&&(this.isDragging=!0,this.activeSlotIndex=-1,e.cancelable&&e.preventDefault(),this.$refs.dragScrollContainer.scrollLeft=this.scrollLeft-(t-this.startX))},onTouchEnd(){this.possibleDrag=!1,this.isDragging&&(this.isDragging=!1,this.wasRecentlyDragging=!0,setTimeout(()=>{this.wasRecentlyDragging=!1},200))},handleOutsideClick(){this.isDragging||this.wasRecentlyDragging||(this.activeSlotIndex=-1)},viewCustomerProfile(e){this.$emit("viewCustomerProfile",e)},getDayBounds(){if(!this.timeslots||0===this.timeslots.length)return{minTime:0,maxTime:this.MINUTES_IN_DAY};const e=this.timeslots[0],t=this.timeslots[this.timeslots.length-1];return{minTime:this.getMinutes(e),maxTime:this.getMinutes(t===this.END_OF_DAY?"23:59":t)}},validateResizeDuration(e,t){const s=this.$root.settings?.interval;let i=10;if("number"===typeof s)i=s;else if("string"===typeof s){const[e,t]=s.split(":").map(Number);i=60*e+t}if(t<i)return{valid:!1,error:`Duration too short (minimum: ${i} minutes)`};const o=this.getMinutes(e.time),a=o+t,n=this.getDayBounds();return a>n.maxTime?{valid:!1,error:"Cannot extend beyond opening hours"}:{valid:!0}},checkBookingOverlap(e,t){const s=this.getMinutes(e.time),i=s+t,o=this.isAttendantView?this.processedBookings.filter(t=>t.id!==e.id&&t._assistantId===e._assistantId):this.bookingsList.filter(t=>t.id!==e.id);for(const a of o){const e=this.getBookingStart(a),t=this.getBookingEnd(a);if(s<t&&i>e)return{hasOverlap:!0,conflictingBooking:a}}return{hasOverlap:!1}},revertBookingResize(e){const t=this.originalBookingStates[e];if(!t)return void console.warn(" No original state found for booking:",e);delete this.tempDurations[e];const s=this.$refs.bookingCard;if(s){const t=Array.isArray(s)?s:[s],i=t.find(t=>t&&t.booking&&t.booking.id===e);i&&"function"===typeof i.revertResize&&i.revertResize()}this.$nextTick(()=>{this.$forceUpdate()}),Oo&&console.log(" Reverted booking resize:",e),delete this.originalBookingStates[e]},showResizeError(e){this.$bvToast?.toast(e,{title:"Resize Error",variant:"danger",solid:!0,autoHideDelay:5e3,toaster:"b-toaster-top-center"}),this.$bvToast||(console.error("Resize error:",e),alert(e))},getMaxDurationForBooking(e){const t=this.getMinutes(e.time),s=this.getDayBounds(),i=s.maxTime-t;return Math.max(i,this.calcSlotStep())}},emits:["update:modelValue","update:lockedTimeslots","add","showItem","viewCustomerProfile","lock","unlock","lock-start","lock-end","unlock-start"]};const Qo=(0,Y.A)(qo,[["render",qs],["__scopeId","data-v-60b6bcd2"]]);var Ko=Qo;function Go(e,t,s,a,l,r){const d=(0,o.g2)("EditBooking");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("addReservationTitle")),1),(0,o.bF)(d,{date:s.date,time:s.time,customerID:s.customer?s.customer.id:"",customerFirstname:s.customer?s.customer.first_name:"",customerLastname:s.customer?s.customer.last_name:"",customerEmail:s.customer?s.customer.email:"",customerPhone:s.customer?s.customer.phone:"",customerAddress:s.customer?s.customer.address:"",customerPersonalNotes:s.customer?s.customer.note:"",status:"sln-b-confirmed",shop:s.shop,isLoading:e.isLoading,isSaved:e.isSaved,isError:e.isError,errorMessage:e.errorMessage,onClose:r.close,onChooseCustomer:r.chooseCustomer,onErrorState:r.handleErrorState,onSave:r.save},null,8,["date","time","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes","shop","isLoading","isSaved","isError","errorMessage","onClose","onChooseCustomer","onErrorState","onSave"])],512)),[[i.aG,e.show]])}var Zo={name:"AddBookingItem",props:{date:{default:function(){return""}},time:{default:function(){return""}},customer:{default:function(){return{}}},shop:{default:function(){return{}}}},mounted(){this.toggleShow()},components:{EditBooking:qt},data:function(){return{isLoading:!1,isSaved:!1,isError:!1,errorMessage:"",show:!0,bookings:[]}},methods:{handleErrorState({isError:e,errorMessage:t}){this.isError=e,this.errorMessage=t},close(e){this.isError=!1,this.$emit("close",e)},chooseCustomer(){this.isError=!1,this.$emit("chooseCustomer")},save(e){this.isLoading=!0,this.axios.post("bookings",e).then(e=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3),this.isLoading=!1,this.axios.get("bookings/"+e.data.id).then(e=>{this.close(e.data.items[0])})},e=>{this.isError=!0,this.errorMessage=e.response.data.message,this.isLoading=!1})},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)}},emits:["close","chooseCustomer"]};const Jo=(0,Y.A)(Zo,[["render",Go]]);var ea=Jo;const ta={class:"customer-details-info"},sa={class:"customer-firstname"},ia={class:"customer-lastname"},oa={class:"customer-email"},aa={class:"customer-address"},na={class:"customer-phone"},la={class:"customer-details-extra-info"},ra={class:"customer-details-extra-info-header"},da={class:"customer-details-extra-info-header-title"},ua=["aria-expanded"],ca={class:"customer-personal-notes"},ha={class:"label",for:"customer_personal_notes"};function ma(e,t,s,i,a,l){const r=(0,o.g2)("b-form-input"),d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row"),c=(0,o.g2)("font-awesome-icon"),h=(0,o.g2)("CustomField"),m=(0,o.g2)("b-form-textarea"),g=(0,o.g2)("b-collapse"),p=(0,o.g2)("b-spinner"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-alert");return(0,o.uX)(),(0,o.Wv)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ta,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",sa,[(0,o.bF)(r,{placeholder:this.getLabel("customerFirstnamePlaceholder"),modelValue:e.elCustomerFirstname,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elCustomerFirstname=t),class:(0,n.C4)({required:e.requiredFields.indexOf("customer_first_name")>-1})},null,8,["placeholder","modelValue","class"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ia,[(0,o.bF)(r,{placeholder:this.getLabel("customerLastnamePlaceholder"),modelValue:e.elCustomerLastname,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elCustomerLastname=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",oa,[(0,o.bF)(r,{type:e.shouldHideEmail?"password":"text",placeholder:this.getLabel("customerEmailPlaceholder"),modelValue:e.elCustomerEmail,"onUpdate:modelValue":t[2]||(t[2]=t=>e.elCustomerEmail=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",aa,[(0,o.bF)(r,{placeholder:this.getLabel("customerAddressPlaceholder"),modelValue:e.elCustomerAddress,"onUpdate:modelValue":t[3]||(t[3]=t=>e.elCustomerAddress=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",na,[(0,o.bF)(r,{type:e.shouldHidePhone?"password":"tel",placeholder:this.getLabel("customerPhonePlaceholder"),modelValue:e.elCustomerPhone,"onUpdate:modelValue":t[4]||(t[4]=t=>e.elCustomerPhone=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",la,[(0,o.Lk)("div",ra,[(0,o.Lk)("div",da,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["customer-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[5]||(t[5]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(c,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(c,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,ua)])]),(0,o.bF)(g,{id:"collapse-2",class:"mt-2",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[7]||(t[7]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(h,{key:e.key,field:e,value:l.getCustomFieldValue(e.key,e.default_value),onUpdate:l.updateCustomField},null,8,["field","value","onUpdate"]))),128)),(0,o.bF)(u,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ca,[(0,o.Lk)("label",ha,(0,n.v_)(this.getLabel("customerPersonalNotesLabel")),1),(0,o.bF)(m,{modelValue:e.elCustomerPersonalNotes,"onUpdate:modelValue":t[6]||(t[6]=t=>e.elCustomerPersonalNotes=t),modelModifiers:{lazy:!0},id:"customer_personal_notes",placeholder:this.getLabel("customerPersonalNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"save-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",onClick:l.save,class:"save-button"},{default:(0,o.k6)(()=>[e.isLoading?((0,o.uX)(),(0,o.Wv)(p,{key:0,small:"",variant:"primary"})):(0,o.Q3)("",!0),(0,o.eW)(" "+(0,n.v_)(this.getLabel("customerDetailsUpdateButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"go-back-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"outline-primary",onClick:l.close,class:"go-back-button"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("customerDetailsGoBackButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"save-button-result-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(k,{show:e.isSaved,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("savedLabel")),1)]),_:1},8,["show"]),(0,o.bF)(k,{show:e.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(e.errorMessage),1)]),_:1},8,["show"]),(0,o.bF)(k,{show:!e.isValid,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("validationMessage")),1)]),_:1},8,["show"])]),_:1})]),_:1})])]),_:1})}var ga={name:"CustomerDetails",components:{CustomField:zt},mixins:[Ce],props:{customerID:{default:function(){return""}},customerFirstname:{default:function(){return""}},customerLastname:{default:function(){return""}},customerEmail:{default:function(){return""}},customerAddress:{default:function(){return""}},customerPhone:{default:function(){return""}},customerPersonalNotes:{default:function(){return""}}},mounted(){this.loadCustomFields()},data:function(){return{elCustomerFirstname:this.customerFirstname,elCustomerLastname:this.customerLastname,elCustomerAddress:this.customerAddress,originalEmail:this.customerEmail,originalPhone:this.customerPhone,elCustomerEmail:this.shouldHideEmail?"***@***":this.customerEmail,elCustomerPhone:this.shouldHidePhone?"*******":this.customerPhone,elCustomerPersonalNotes:this.customerPersonalNotes,isValid:!0,requiredFields:[],visibleExtraInfo:!1,customFieldsList:[],elCustomFields:[],vueTelInputOptions:{placeholder:this.getLabel("customerPhonePlaceholder")},isLoading:!1,isSaved:!1,isError:!1,errorMessage:""}},methods:{close(){this.$emit("close")},save(){if(this.isValid=this.validate(),this.isValid){var e={id:this.customerID?this.customerID:0,first_name:this.elCustomerFirstname,last_name:this.elCustomerLastname,email:this.originalEmail,phone:this.originalPhone,address:this.elCustomerAddress,note:this.elCustomerPersonalNotes,custom_fields:this.customFieldsList};this.isLoading=!0,this.axios.put("customers/"+e.id,e).then(()=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3)},e=>{this.isError=!0,this.errorMessage=e.response.data.message,setTimeout(()=>{this.isError=!1,this.errorMessage=""},3e3)}).finally(()=>{this.isLoading=!1})}},validate(){return this.requiredFields=[],this.elCustomerFirstname.trim()||this.requiredFields.push("customer_first_name"),0===this.requiredFields.length},updateCustomField(e,t){let s=this.customFieldsList.find(t=>t.key===e);s?s.value=t:this.customFieldsList.push({key:e,value:t})},getCustomFieldValue(e,t){let s=this.customFieldsList.find(t=>t.key===e);return s?s.value:t},loadCustomFields(){this.axios.get("custom-fields/booking",{params:{user_profile:1,customer_id:this.customerID}}).then(e=>{this.customFieldsList=e.data.items.filter(e=>-1===["html","file"].indexOf(e.type))})}},emits:["close","save"]};const pa=(0,Y.A)(ga,[["render",ma],["__scopeId","data-v-708a7652"]]);var fa=pa,ka={name:"ReservationsCalendarTab",props:{shop:{default:function(){return{}}}},components:{ReservationsCalendar:Ko,AddBookingItem:ea,CustomersAddressBook:Ds,BookingDetails:Fe,EditBookingItem:Gt,ImagesList:Bs,CustomerDetails:fa},mounted(){let e=this.getQueryParams();"undefined"!==typeof e["booking_id"]&&(this.isLoading=!0,this.axios.get("bookings/"+e["booking_id"]).then(e=>{this.isLoading=!1,this.setShowItem(e.data.items[0])}))},data:function(){return{addItem:!1,showItem:!1,isChooseCustomer:!1,item:null,editItem:!1,customer:null,date:"",time:"",isLoading:!1,isShowCustomerImages:!1,showImagesCustomer:null,selectedDate:new Date,showCustomerProfile:!1,selectedCustomer:null}},methods:{add(e,t){this.addItem=!0,this.date=e,this.time=t},setShowItem(e){this.showItem=!0,this.item=e},close(e){this.addItem=!1,this.customer=null,e&&this.setShowItem(e)},chooseCustomer(){this.isChooseCustomer=!0},closeChooseCustomer(){this.isChooseCustomer=!1},closeShowItem(){this.showItem=!1},setEditItem(){this.editItem=!0},closeEditItem(e){this.editItem=!1,this.customer=null,e&&this.setShowItem(e)},choose(e){this.customer=e,this.closeChooseCustomer()},showCustomerImages(e){this.isShowCustomerImages=!0,this.showImagesCustomer=e,this.$emit("hideTabsHeader",!0)},closeShowCustomerImages(e){this.item.customer_photos=e.photos,this.isShowCustomerImages=!1,this.$emit("hideTabsHeader",!1)},openCustomerProfile(e){this.selectedCustomer=e,this.showItem=!1,this.showCustomerProfile=!0},closeCustomerProfile(){this.showCustomerProfile=!1,this.selectedCustomer=null,this.item&&(this.showItem=!0)}},emits:["hideTabsHeader"]};const va=(0,Y.A)(ka,[["render",js]]);var ba=va;function _a(e,t,s,i,a,n){const l=(0,o.g2)("ImagesList"),r=(0,o.g2)("CustomerDetails"),d=(0,o.g2)("CustomersAddressBook");return(0,o.uX)(),(0,o.CE)("div",null,[e.isShowImages?((0,o.uX)(),(0,o.Wv)(l,{key:0,customer:e.customer,onClose:n.closeShowImages},null,8,["customer","onClose"])):e.editCustomer?((0,o.uX)(),(0,o.Wv)(r,{key:1,onClose:n.closeCustomerDetails,customerID:e.customer.id,customerFirstname:e.customer.first_name,customerLastname:e.customer.last_name,customerEmail:e.customer.email,customerPhone:e.customer.phone,customerAddress:e.customer.address,customerPersonalNotes:e.customer.note},null,8,["onClose","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes"])):((0,o.uX)(),(0,o.Wv)(d,{key:2,shop:s.shop,onShowImages:n.showImages,onEdit:n.edit,customer:e.customerData,ref:"customersAddressBook"},null,8,["shop","onShowImages","onEdit","customer"]))])}var ya={name:"CustomersAddressBookTab",props:{shop:{default:function(){return{}}}},components:{CustomerDetails:fa,CustomersAddressBook:Ds,ImagesList:Bs},data:function(){return{isShowImages:!1,customer:null,customerData:null,editCustomer:!1}},methods:{showImages(e){this.isShowImages=!0,this.customer=e,this.$emit("hideTabsHeader",!0)},closeShowImages(e){this.isShowImages=!1,this.customerData=e,this.$emit("hideTabsHeader",!1)},edit(e){this.customer=e,this.editCustomer=!0},closeCustomerDetails(){this.editCustomer=!1,this.$refs.customersAddressBook&&this.$refs.customersAddressBook.load()}},emits:["hideTabsHeader"]};const La=(0,Y.A)(ya,[["render",_a]]);var Sa=La;const Ca={key:1,class:"user-profile"},wa={class:"user-profile-top"},Da={class:"user-profile-name"},Fa={class:"user-profile-email"},Ta={class:"user-profile-role"},Ia={key:0,class:"admin-tools-section"},Ea=["disabled"],Aa=["disabled"],Ma={key:2};function xa(e,t,s,i,a,l){const r=(0,o.g2)("b-toaster"),d=(0,o.g2)("b-spinner"),u=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(r,{name:"b-toaster-top-center",class:"toast-container-custom"}),a.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:0,variant:"primary"})):a.user?((0,o.uX)(),(0,o.CE)("div",Ca,[(0,o.Lk)("div",wa,[(0,o.Lk)("h2",Da,(0,n.v_)(a.user.name),1),(0,o.Lk)("p",Fa,(0,n.v_)(a.user.email),1),(0,o.Lk)("p",Ta,(0,n.v_)(a.user.role),1)]),l.isAdmin?((0,o.uX)(),(0,o.CE)("div",Ia,[t[2]||(t[2]=(0,o.Lk)("h3",{class:"admin-tools-title"},"Administrator Tools",-1)),(0,o.Lk)("button",{class:"btn-reset-calendar",onClick:t[0]||(t[0]=(...e)=>l.resetCalendar&&l.resetCalendar(...e)),disabled:a.isResetting,title:"Reset calendar cache - clears all cached data and reloads from server"},[(0,o.Lk)("i",{class:(0,n.C4)(["fas fa-sync-alt",{"fa-spin":a.isResetting}])},null,2),(0,o.eW)(" "+(0,n.v_)(a.isResetting?"Resetting...":"Reset Calendar Cache"),1)],8,Ea),(0,o.Lk)("button",{class:"btn-force-update",onClick:t[1]||(t[1]=(...e)=>l.forcePwaUpdate&&l.forcePwaUpdate(...e)),disabled:a.isUpdating,title:"Force PWA update - clears all caches including service worker, ensures latest code is loaded"},[(0,o.Lk)("i",{class:(0,n.C4)(["fas fa-download",{"fa-spin":a.isUpdating}])},null,2),(0,o.eW)(" "+(0,n.v_)(a.isUpdating?"Updating...":"Force PWA Update"),1)],8,Aa),t[3]||(t[3]=(0,o.Lk)("p",{class:"admin-tools-description"},[(0,o.Lk)("strong",null,"Reset Calendar Cache:"),(0,o.eW)(" Clears calendar data cache. Use if you experience data sync issues."),(0,o.Lk)("br"),(0,o.Lk)("strong",null,"Force PWA Update:"),(0,o.eW)(" Clears service worker cache and reloads. Use if booking emails show wrong data, or after plugin updates. ")],-1))])):(0,o.Q3)("",!0),(0,o.bF)(u,{class:"btn-logout",variant:"primary",onClick:l.logOut},{default:(0,o.k6)(()=>[...t[4]||(t[4]=[(0,o.eW)("Log-out",-1)])]),_:1},8,["onClick"])])):((0,o.uX)(),(0,o.CE)("div",Ma,[...t[5]||(t[5]=[(0,o.Lk)("p",null,"Failed to load user information. Please try again.",-1)])]))])}var $a={name:"UserProfileTab",data(){return{isLoading:!0,user:null,isResetting:!1,isUpdating:!1}},computed:{isAdmin(){return this.user?.role?.toLowerCase().includes("admin")||this.user?.role?.toLowerCase().includes("administrator")}},methods:{loadUserProfile(){this.isLoading=!0,this.axios.get("/users/current").then(e=>{this.user=e.data}).catch(e=>{console.error("Error loading user profile:",e),this.user=null}).finally(()=>{this.isLoading=!1})},logOut(){this.axios.post("/users/logout").then(()=>{this.user=null,window.location.href="/"}).catch(e=>{console.error("Logout failed:",e)})},async resetCalendar(){if(!this.isResetting)try{this.isResetting=!0;let e=0;const t=["isAttendantView"],s=["sln_","salon_"];Object.keys(localStorage).forEach(i=>{const o=s.some(e=>i.startsWith(e)),a=t.includes(i);(o||a)&&(localStorage.removeItem(i),e++)}),sessionStorage.clear(),window.dispatchEvent(new CustomEvent("sln-calendar-cache-cleared")),this.$bvToast.toast(e>0?`Cache cleared (${e} items). Calendar data reloaded.`:"Cache cleared. Switch to Calendar tab to reload data.",{title:"Cache Cleared",variant:"success",solid:!0,autoHideDelay:5e3})}catch(e){this.$bvToast.toast("Failed to clear calendar cache. Please try again or contact support.",{title:"Reset Failed",variant:"danger",solid:!0,autoHideDelay:5e3})}finally{this.isResetting=!1}},async forcePwaUpdate(){if(!this.isUpdating)try{if(this.isUpdating=!0,console.log("=== ADMIN: FORCE PWA UPDATE ==="),"serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister(),console.log("   Unregistered service worker")}if("caches"in window){const e=await caches.keys();for(const t of e)await caches.delete(t),console.log("   Deleted cache:",t)}localStorage.clear(),sessionStorage.clear(),console.log("   Cleared storage"),console.log("=== RELOADING TO LOAD FRESH CODE ==="),this.$bvToast.toast("PWA cache cleared. Page will reload with latest code.",{title:"Update Complete",variant:"success",solid:!0,autoHideDelay:2e3}),setTimeout(()=>{window.location.reload()},500)}catch(e){console.error("Force update error:",e),this.$bvToast.toast("Failed to clear cache. Try a hard refresh (Ctrl+Shift+R) or close and reopen the PWA.",{title:"Update Failed",variant:"danger",solid:!0,autoHideDelay:5e3}),this.isUpdating=!1}}},mounted(){this.loadUserProfile()}};const Pa=(0,Y.A)($a,[["render",xa],["__scopeId","data-v-785c5294"]]);var Ya=Pa;const Va={key:0};function Ba(e,t,s,i,a,n){const l=(0,o.g2)("ShopsList");return s.isShopsEnabled?((0,o.uX)(),(0,o.CE)("div",Va,[(0,o.bF)(l,{isShopsEnabled:s.isShopsEnabled,onApplyShop:n.applyShop},null,8,["isShopsEnabled","onApplyShop"])])):(0,o.Q3)("",!0)}const Xa={class:"title"},Ha={class:"shops-list"},Wa={key:2,class:"no-result"};function ja(e,t,s,i,a,l){const r=(0,o.g2)("b-spinner"),d=(0,o.g2)("ShopItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",Xa,(0,n.v_)(this.getLabel("shopsTitle")),1),(0,o.Lk)("div",Ha,[e.isLoading?((0,o.uX)(),(0,o.Wv)(r,{key:0,variant:"primary"})):e.shopsList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(e.shopsList,e=>((0,o.uX)(),(0,o.Wv)(d,{key:e.id,shop:e,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"]))),128)):((0,o.uX)(),(0,o.CE)("span",Wa,(0,n.v_)(this.getLabel("shopsNoResultLabel")),1))])])}const Na={class:"shop"},Ra={class:"shop-name"},za={class:"shop-address"},Ua={class:"shop-email"},Oa={class:"shop-actions"},qa={class:"shop-phone"},Qa={class:"shop-actions-wrapper"},Ka={class:"details-link"};function Ga(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"shop-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Na,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"shop-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ra,(0,n.v_)(l.name),1),(0,o.Lk)("div",za,(0,n.v_)(l.address),1),(0,o.Lk)("div",Ua,(0,n.v_)(l.email),1),(0,o.Lk)("div",Oa,[(0,o.Lk)("div",qa,(0,n.v_)(l.phone),1),(0,o.Lk)("div",Qa,[(0,o.Lk)("span",Ka,[(0,o.bF)(r,{icon:"fa-solid fa-chevron-right",onClick:l.applyShop},null,8,["onClick"])])])])]),_:1})]),_:1})])]),_:1})]),_:1})}var Za={name:"ShopItem",props:{shop:{default:function(){return{}}}},computed:{name(){return this.shop.name},address(){return this.shop.address},email(){return this.shop.email},phone(){return this.shop.phone}},methods:{applyShop(){this.$emit("applyShop",this.shop)}},emits:["applyShop"]};const Ja=(0,Y.A)(Za,[["render",Ga],["__scopeId","data-v-36220f6c"]]);var en=Ja,tn={name:"ShopsList",props:{isShopsEnabled:{type:Boolean,required:!0}},data:function(){return{shopsList:[],isLoading:!1}},mounted(){this.isShopsEnabled&&this.load()},components:{ShopItem:en},methods:{load(){this.isShopsEnabled&&(this.isLoading=!0,this.shopsList=[],this.axios.get("shops").then(e=>{this.shopsList=e.data.items}).finally(()=>{this.isLoading=!1}))},applyShop(e){this.$emit("applyShop",e)}},emits:["applyShop"]};const sn=(0,Y.A)(tn,[["render",ja],["__scopeId","data-v-236a4de0"]]);var on=sn,an={name:"ShopsTab",props:{isShopsEnabled:{type:Boolean,required:!0}},components:{ShopsList:on},methods:{applyShop(e){this.$emit("applyShop",e)}},emits:["applyShop"]};const nn=(0,Y.A)(an,[["render",Ba]]);var ln=nn;const rn={class:"shop-title-wrapper"},dn={class:"shop-selector"},un={class:"selector-label"},cn={class:"selector-dropdown"},hn={key:0},mn={key:1},gn={key:0,class:"dropdown-content"},pn={key:0,class:"loading-spinner"},fn={key:1,class:"no-shops"},kn={key:2,class:"shops-list"},vn=["onClick"],bn={class:"shop-info"},_n={class:"shop-name"},yn={class:"shop-address"};function Ln(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-spinner"),u=(0,o.gN)("click-outside");return(0,o.uX)(),(0,o.CE)("div",rn,[(0,o.Lk)("div",dn,[(0,o.Lk)("div",un,(0,n.v_)(this.getLabel("shopTitleLabel"))+":",1),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",cn,[(0,o.Lk)("div",{class:"selected-value",onClick:t[0]||(t[0]=(...e)=>l.toggleDropdown&&l.toggleDropdown(...e))},[l.selectedShopName?((0,o.uX)(),(0,o.CE)("span",hn,(0,n.v_)(l.selectedShopName),1)):((0,o.uX)(),(0,o.CE)("span",mn,(0,n.v_)(this.getLabel("selectShopPlaceholder")),1)),(0,o.bF)(r,{icon:"fa-solid fa-chevron-right",class:(0,n.C4)(["dropdown-icon",{"dropdown-icon--open":a.isDropdownOpen}])},null,8,["class"])]),a.isDropdownOpen?((0,o.uX)(),(0,o.CE)("div",gn,[a.isLoading?((0,o.uX)(),(0,o.CE)("div",pn,[(0,o.bF)(d,{variant:"primary"})])):0===a.shopsList.length?((0,o.uX)(),(0,o.CE)("div",fn,(0,n.v_)(this.getLabel("shopsNoResultLabel")),1)):((0,o.uX)(),(0,o.CE)("div",kn,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.shopsList,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"shop-item",onClick:t=>l.selectShop(e)},[(0,o.Lk)("div",bn,[(0,o.Lk)("div",_n,(0,n.v_)(e.name),1),(0,o.Lk)("div",yn,(0,n.v_)(e.address),1)])],8,vn))),128))]))])):(0,o.Q3)("",!0)])),[[u,l.closeDropdown]])])])}var Sn={name:"ShopTitle",props:{shop:{default:function(){return{}}}},data(){return{isDropdownOpen:!1,shopsList:[],isLoading:!1}},computed:{name(){return this.shop&&this.shop.id?this.shop.name:""},selectedShopName(){return this.shop&&this.shop.id?this.shop.name:""}},methods:{toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen&&this.loadShops()},closeDropdown(){this.isDropdownOpen=!1},loadShops(){this.isLoading=!0,this.shopsList=[],this.axios.get("shops").then(e=>{this.shopsList=e.data.items}).finally(()=>{this.isLoading=!1})},selectShop(e){this.$emit("applyShop",e),this.closeDropdown()}},emits:["applyShop"],directives:{"click-outside":{mounted(e,t){e.clickOutsideEvent=function(s){e===s.target||e.contains(s.target)||t.value(s)},document.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.removeEventListener("click",e.clickOutsideEvent)}}}};const Cn=(0,Y.A)(Sn,[["render",Ln],["__scopeId","data-v-169ad628"]]);var wn=Cn,Dn={name:"TabsList",props:{isShopsEnabled:{default:function(){return!1}}},components:{UpcomingReservationsTab:Ws,ReservationsCalendarTab:ba,CustomersAddressBookTab:Sa,UserProfileTab:Ya,ShopsTab:ln,ShopTitle:wn},mounted(){window.addEventListener("hashchange",()=>{this.hash=window.location.hash});let e=this.getQueryParams();"undefined"!==typeof e["tab"]&&(this.hash="#"+e["tab"])},data:function(){return{hash:window.location.hash?window.location.hash:this.isShopsEnabled?"#shops":"#upcoming-reservations",shop:null,isHideTabsHeader:!1,isShopSelected:!1}},watch:{shop(e){this.isShopSelected=!!e&&!!e.id}},methods:{click(e){window.location.href=e,null!==document.querySelector(".dp__active_date.dp__today")?(document.querySelector(".current-time-line").style.display="block",document.querySelector(".current-time-line").scrollIntoView({behavior:"smooth",block:"center"})):document.querySelector(".current-time-line").style.display="none"},isActiveTab(e){return this.hash===e?"":void 0},applyShop(e){this.shop=e,this.$emit("applyShop",e)},applyShopAndSwitch(e){this.shop=e,this.$refs["upcoming-reservations-tab-link"].click(),this.$emit("applyShop",e)},hideTabsHeader(e){this.isHideTabsHeader=e}},emits:["applyShop"]};const Fn=(0,Y.A)(Dn,[["render",l],["__scopeId","data-v-2c96b20a"]]);var Tn=Fn,In=s.p+"img/logo.png";const En={class:"text"};function An(e,t,s,i,a,l){const r=(0,o.g2)("b-alert"),d=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.CE)("div",null,[e.showIOS?((0,o.uX)(),(0,o.Wv)(r,{key:0,show:"",dismissible:"",variant:"secondary",class:"add-to-home-screen"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAIOSText")),1)]),_:1})):((0,o.uX)(),(0,o.Wv)(r,{key:1,show:e.shown,dismissible:"",variant:"secondary",class:"add-to-home-screen"},{default:(0,o.k6)(()=>[t[0]||(t[0]=(0,o.Lk)("span",{class:"logo"},[(0,o.Lk)("img",{src:In})],-1)),(0,o.Lk)("span",En,(0,n.v_)(this.getLabel("installPWAPromptText")),1),(0,o.bF)(d,{onClick:l.installPWA,class:"btn-install"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAPromptInstallBtnLabel")),1)]),_:1},8,["onClick"]),(0,o.bF)(d,{onClick:l.dismissPrompt},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAPromptNoInstallBtnLabel")),1)]),_:1},8,["onClick"])]),_:1},8,["show"]))])}var Mn={data:()=>({shown:!1,showIOS:!1}),beforeMount(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.installEvent=e,this.shown=!0});const e=()=>{const e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},t=()=>"standalone"in window.navigator&&window.navigator.standalone;e()&&!t()&&(this.showIOS=!0)},methods:{dismissPrompt(){this.shown=!1},installPWA(){this.installEvent.prompt(),this.installEvent.userChoice.then(e=>{this.dismissPrompt(),e.outcome})}}};const xn=(0,Y.A)(Mn,[["render",An],["__scopeId","data-v-bb2ebf3c"]]);var $n=xn,Pn={name:"App",mounted(){this.loadSettings(),this.displayBuildVersion()},computed:{isShopsEnabled(){return window.slnPWA.is_shops}},data:function(){return{settings:{},statusesList:{"sln-b-pendingpayment":{label:this.getLabel("pendingPaymentStatusLabel"),color:"#ffc107"},"sln-b-pending":{label:this.getLabel("pendingStatusLabel"),color:"#ffc107"},"sln-b-paid":{label:this.getLabel("paidStatusLabel"),color:"#28a745"},"sln-b-paylater":{label:this.getLabel("payLaterStatusLabel"),color:"#17a2b8"},"sln-b-error":{label:this.getLabel("errorStatusLabel"),color:"#dc3545"},"sln-b-confirmed":{label:this.getLabel("confirmedStatusLabel"),color:"#28a745"},"sln-b-canceled":{label:this.getLabel("canceledStatusLabel"),color:"#dc3545"}},shop:null}},watch:{shop(){this.loadSettings()}},methods:{loadSettings(){this.axios.get("app/settings",{params:{shop:this.shop?this.shop.id:null}}).then(e=>{this.settings=e.data.settings,this.$root.settings={...this.$root.settings,...this.settings}})},applyShop(e){this.shop=e},async displayBuildVersion(){try{const e=await fetch(`/{SLN_PWA_DIST_PATH}/version.json?t=${Date.now()}`),t=await e.json();console.log("\n"),console.log(" PWA BUILD VERSION"),console.log(""),console.log(` Build Time: ${t.buildTime}`),console.log(` Build Hash: ${t.buildHash}`),console.log(`  Timestamp:  ${t.timestamp}`),console.log("\n"),window.PWA_BUILD_VERSION=t}catch(e){console.warn("  Could not load build version:",e)}}},components:{TabsList:Tn,PWAPrompt:$n},beforeCreate(){this.$OneSignal&&(this.$OneSignal.showSlidedownPrompt(),this.$OneSignal.on("subscriptionChange",e=>{e&&this.$OneSignal.getUserId(e=>{e&&this.axios.put("users",{onesignal_player_id:e})})}))}};const Yn=(0,Y.A)(Pn,[["render",a]]);var Vn=Yn,Bn=s(9501);setInterval(()=>{navigator.serviceWorker.getRegistration().then(e=>{e&&e.update()})},6e4),(0,Bn.k)("/{SLN_PWA_DIST_PATH}/service-worker.js",{ready(){console.log(" PWA ready - served from cache by service worker")},registered(e){console.log(" Service worker registered"),setInterval(()=>{e.update()},6e4)},cached(){console.log(" Content cached for offline use")},updatefound(){console.log(" New PWA version downloading...")},updated(e){console.log(" New PWA version available!"),console.log(" Auto-reloading to get fresh code..."),e&&e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}),setTimeout(()=>{console.log(" Reloading page now..."),window.location.reload()},1e3)},offline(){console.log(" Offline mode - no internet connection")},error(e){console.error(" Service worker error:",e)}}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log(" Service worker updated - reloading..."),window.location.reload()});var Xn=s(5222),Hn=(0,Xn.y$)({state:{},getters:{},mutations:{},actions:{},modules:{}}),Wn=s(9592),jn=s(1893),Nn=s(3975),Rn=s(4394),zn=s(7947),Un=s(8565),On=s(376),qn=s(1975),Qn=s(5329),Kn=s(7797),Gn=s(1341);jn.Yv.add(Rn.ITF,Rn.l6G,zn.vlp,Rn.$UM,zn.a$,Rn.XkK,Rn.yLS,Rn.bnw,Rn.LFz,Rn.e68,Rn.gdJ,Rn.e9J,Rn.QLR,Rn.dzk,Rn.ivC,Rn.s67,Rn.B9e,Rn.KKb,Rn.DW4,Rn.KKr,Rn.TOj,Rn.q_k,Un.EYA,Rn.H37,Rn.yvG,Rn.rwq,Rn.rk5,zn.QRE);var Zn=(0,i.Ef)(Vn).use(Hn).use(Wn.Ay).use(Gn.A).component("font-awesome-icon",Nn.gc).component("Datepicker",On.A).component("vue-select",Qn.A).component("Carousel",Kn.FN).component("Slide",Kn.q7).component("Pagination",Kn.dK).component("Navigation",Kn.Vx).mixin(Ce),Jn=window.slnPWA.onesignal_app_id;Jn&&Zn.use(qn.A,{appId:Jn,serviceWorkerParam:{scope:"/{SLN_PWA_DIST_PATH}/"},serviceWorkerPath:"{SLN_PWA_DIST_PATH}/OneSignalSDKWorker.js"}),Zn.mount("#app")}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=e,function(){var e=[];s.O=function(t,i,o,a){if(!i){var n=1/0;for(u=0;u<e.length;u++){i=e[u][0],o=e[u][1],a=e[u][2];for(var l=!0,r=0;r<i.length;r++)(!1&a||n>=a)&&Object.keys(s.O).every(function(e){return s.O[e](i[r])})?i.splice(r--,1):(l=!1,a<n&&(n=a));if(l){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[i,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){s.p="/{SLN_PWA_DIST_PATH}/"}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,a,n=i[0],l=i[1],r=i[2],d=0;if(n.some(function(t){return 0!==e[t]})){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(r)var u=r(s)}for(t&&t(i);d<n.length;d++)a=n[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},i=self["webpackChunksalon_booking_plugin_pwa"]=self["webpackChunksalon_booking_plugin_pwa"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[453,504],function(){return s(8753)});i=s.O(i)})();
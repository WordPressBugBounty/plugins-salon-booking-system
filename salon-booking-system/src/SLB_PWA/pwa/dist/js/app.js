(function(){var e={3044:function(e,t,s){"use strict";var i=s(5130),o=s(6768);function a(e,t,s,i,a,n){const l=(0,o.g2)("TabsList"),r=(0,o.g2)("PWAPrompt");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(l,{onApplyShop:n.applyShop,isShopsEnabled:n.isShopsEnabled},null,8,["onApplyShop","isShopsEnabled"]),(0,o.bF)(r)])}var n=s(4232);const l=e=>((0,o.Qi)("data-v-2c96b20a"),e=e(),(0,o.jt)(),e),r=l(()=>(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 27 30",class:"svg-inline--fa"},[(0,o.Lk)("g",{fill:"none",stroke:"currentcolor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3"},[(0,o.Lk)("path",{d:"M25.5 28.5v-3a6 6 0 0 0-6-6h-12a6 6 0 0 0-6 6v3"}),(0,o.Lk)("path",{d:"M19.5 7.5a6 6 0 1 1-6-6 6 6 0 0 1 6 6Z"})])],-1)),d=[r];function u(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),u=(0,o.g2)("ShopsTab"),c=(0,o.g2)("b-tab"),h=(0,o.g2)("ShopTitle"),m=(0,o.g2)("UpcomingReservationsTab"),p=(0,o.g2)("ReservationsCalendarTab"),g=(0,o.g2)("CustomersAddressBookTab"),f=(0,o.g2)("UserProfileTab"),k=(0,o.g2)("b-tabs");return(0,o.uX)(),(0,o.CE)("div",{class:(0,n.C4)({"hide-tabs-header":e.isHideTabsHeader})},[(0,o.bF)(k,{pills:"",card:"",end:""},{default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(c,{key:0,active:l.isActiveTab("#shops"),"title-item-class":{hide:!s.isShopsEnabled}},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[0]||(t[0]=e=>l.click("#shops"))},[(0,o.bF)(r,{icon:"fa-solid fa-store"})])]),default:(0,o.k6)(()=>[(0,o.bF)(u,{isShopsEnabled:s.isShopsEnabled,onApplyShop:l.applyShopAndSwitch},null,8,["isShopsEnabled","onApplyShop"])]),_:1},8,["active","title-item-class"])):(0,o.Q3)("",!0),(0,o.bF)(c,{active:l.isActiveTab("#upcoming-reservations")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[1]||(t[1]=t=>{l.click("#upcoming-reservations"),e.scrollInto()}),ref:"upcoming-reservations-tab-link"},[(0,o.bF)(r,{icon:"fa-solid fa-list"})],512)]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(h,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(m,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(c,{active:l.isActiveTab("#reservations-calendar")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[2]||(t[2]=e=>l.click("#reservations-calendar"))},[(0,o.bF)(r,{icon:"fa-solid fa-calendar-days"})])]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(h,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(p,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(c,{active:l.isActiveTab("#customers")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[3]||(t[3]=e=>l.click("#customers"))},[(0,o.bF)(r,{icon:"fa-regular fa-address-book"})])]),default:(0,o.k6)(()=>[s.isShopsEnabled?((0,o.uX)(),(0,o.Wv)(h,{key:0,shop:e.shop,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"])):(0,o.Q3)("",!0),(0,o.bF)(g,{shop:e.shop,onHideTabsHeader:l.hideTabsHeader},null,8,["shop","onHideTabsHeader"])]),_:1},8,["active"]),(0,o.bF)(c,{"title-item-class":"nav-item-profile",active:l.isActiveTab("#user-profile")},{title:(0,o.k6)(()=>[(0,o.Lk)("span",{onClick:t[4]||(t[4]=e=>l.click("#user-profile"))},d)]),default:(0,o.k6)(()=>[(0,o.bF)(f)]),_:1},8,["active"])]),_:1})],2)}function c(e,t,s,a,n,l){const r=(0,o.g2)("ImagesList"),d=(0,o.g2)("CustomersAddressBook"),u=(0,o.g2)("EditBookingItem"),c=(0,o.g2)("BookingDetails"),h=(0,o.g2)("UpcomingReservations");return(0,o.uX)(),(0,o.CE)("div",null,[e.isShowCustomerImages?((0,o.uX)(),(0,o.Wv)(r,{key:0,customer:e.showImagesCustomer,onClose:l.closeShowCustomerImages,onTakePhoto:e.showTakePhoto,takePhotoFile:e.photo},null,8,["customer","onClose","onTakePhoto","takePhotoFile"])):e.isChooseCustomer?((0,o.uX)(),(0,o.Wv)(d,{key:1,onCloseChooseCustomer:l.closeChooseCustomer,chooseCustomerAvailable:!0,onChoose:l.choose,shop:e.item.shop},null,8,["onCloseChooseCustomer","onChoose","shop"])):e.editItem?((0,o.uX)(),(0,o.Wv)(u,{key:2,booking:e.item,customer:e.customer,onClose:l.closeEditItem,onChooseCustomer:l.chooseCustomer},null,8,["booking","customer","onClose","onChooseCustomer"])):e.showItem?((0,o.uX)(),(0,o.Wv)(c,{key:3,booking:e.item,onClose:l.closeShowItem,onEdit:l.setEditItem,onShowCustomerImages:l.showCustomerImages},null,8,["booking","onClose","onEdit","onShowCustomerImages"])):(0,o.Q3)("",!0),(0,o.bo)((0,o.bF)(h,{onShowItem:l.setShowItem,shop:s.shop},null,8,["onShowItem","shop"]),[[i.aG,!e.showItem]])])}const h={class:"title"},m={class:"search"},p={class:"hours"},g={class:"attendants"},f={class:"bookings-list"},k={key:2,class:"no-result"};function v(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-form-input"),u=(0,o.g2)("b-button"),c=(0,o.g2)("b-col"),v=(0,o.g2)("b-row"),b=(0,o.g2)("b-spinner"),_=(0,o.g2)("BookingItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",h,(0,n.v_)(this.getLabel("upcomingReservationsTitle")),1),(0,o.Lk)("div",m,[(0,o.bF)(r,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(d,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=t=>e.search=t),class:"search-input"},null,8,["modelValue"]),e.search?((0,o.uX)(),(0,o.Wv)(r,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:t[1]||(t[1]=t=>e.search="")})):(0,o.Q3)("",!0)]),(0,o.bF)(v,null,{default:(0,o.k6)(()=>[(0,o.bF)(c,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",p,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.hours,t=>((0,o.uX)(),(0,o.Wv)(u,{key:t.hours,onClick:s=>e.hourValue=t.hours,pressed:e.hourValue===t.hours,variant:"outline-primary"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.label),1)]),_:2},1032,["onClick","pressed"]))),128))])]),_:1})]),_:1}),(0,o.bF)(v,null,{default:(0,o.k6)(()=>[(0,o.bF)(c,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",g,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.attendants,t=>((0,o.uX)(),(0,o.Wv)(u,{key:t.id,variant:"outline-primary",pressed:e.filterAttendant===t.id,onClick:s=>e.filterAttendant===t.id?e.filterAttendant="":e.filterAttendant=t.id},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.name),1)]),_:2},1032,["pressed","onClick"]))),128))])]),_:1})]),_:1}),(0,o.Lk)("div",f,[e.isLoading?((0,o.uX)(),(0,o.Wv)(b,{key:0,variant:"primary"})):l.filteredBookingsList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(l.filteredBookingsList,e=>((0,o.uX)(),(0,o.Wv)(_,{key:e.id,booking:e,onDeleteItem:t=>l.deleteItem(e.id),onShowDetails:t=>l.showDetails(e)},null,8,["booking","onDeleteItem","onShowDetails"]))),128)):((0,o.uX)(),(0,o.CE)("span",k,(0,n.v_)(this.getLabel("upcomingReservationsNoResultLabel")),1))])])}s(3725),s(5019),s(9838),s(1339);const b={class:"booking"},_={class:"customer-info-status-customer-wrapper"},y={class:"customer"},L={class:"id"},C={class:"booking-info-date-time-wrapper"},S={class:"date"},w={class:"time"},F={class:"total"},D=["innerHTML"],T={class:"booking-assistant-info"},I={class:"delete"},A={class:"booking-actions-remaining-amount"},E={class:"details-link"},M={class:"delete-btn-wrapper"},x={class:"delete-btn-wrapper-text"};function $(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row"),c=(0,o.g2)("font-awesome-icon"),h=(0,o.g2)("PayRemainingAmount"),m=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.Wv)(u,{"gutter-x":"0"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",b,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"customer-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",_,[(0,o.Lk)("span",{class:"status",style:(0,n.Tr)("background-color:"+r.statusColor)},null,4),(0,o.Lk)("span",y,(0,n.v_)(r.customer),1)]),(0,o.Lk)("span",L,(0,n.v_)(r.id),1)]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",C,[(0,o.Lk)("span",S,(0,n.v_)(r.date),1),(0,o.Lk)("span",w,(0,n.v_)(r.fromTime)+"-"+(0,n.v_)(r.toTime),1)]),(0,o.Lk)("span",F,[(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,D)])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",T,(0,n.v_)(r.assistants.map(e=>e.name).join(" | ")),1)]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"booking-actions-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("span",I,[(0,o.bF)(c,{icon:"fa-solid fa-trash",onClick:t[0]||(t[0]=t=>e.isDelete=!0)})]),(0,o.Lk)("span",A,[(0,o.bF)(h,{booking:s.booking},null,8,["booking"]),(0,o.Lk)("span",E,[(0,o.bF)(c,{icon:"fa-solid fa-chevron-right",onClick:r.showDetails},null,8,["onClick"])])])]),_:1})]),_:1})]),e.isDelete?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",{class:"delete-backdrop",onClick:t[1]||(t[1]=t=>e.isDelete=!1)}),(0,o.Lk)("div",M,[(0,o.Lk)("p",x,(0,n.v_)(this.getLabel("deleteBookingConfirmText")),1),(0,o.Lk)("p",null,[(0,o.bF)(m,{variant:"primary",onClick:r.deleteItem,class:"delete-btn-wrapper-button"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("deleteBookingButtonLabel")),1)]),_:1},8,["onClick"])]),(0,o.Lk)("p",null,[(0,o.Lk)("a",{href:"#",class:"delete-btn-wrapper-go-back",onClick:t[2]||(t[2]=(0,i.D$)(t=>e.isDelete=!1,["prevent"]))},(0,n.v_)(this.getLabel("deleteBookingGoBackLabel")),1)])])],64)):(0,o.Q3)("",!0)]),_:1})]),_:1})}var P=s.p+"img/requestpayment.png";const Y={class:"remaining-amount-payment-link"};function V(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("b-alert");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("span",Y,[(0,o.Lk)("img",{src:P,onClick:t[0]||(t[0]=(...e)=>r.payAmount&&r.payAmount(...e))}),l.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(u,{show:l.isSuccess,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("successMessagePayRemainingAmount")),1)]),_:1},8,["show"]),(0,o.bF)(u,{show:l.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("errorMessagePayRemainingAmount")),1)]),_:1},8,["show"])],512)),[[i.aG,r.show]])}var X={name:"PayRemainigAmount",props:{booking:{default:function(){return{}}}},data(){return{isLoading:!1,isSuccess:!1,isError:!1}},computed:{deposit(){return this.booking.deposit},paid_remained(){return this.booking.paid_remained},show(){return this.deposit>0&&!this.paid_remained},id(){return this.booking.id}},methods:{payAmount(){this.isLoading=!0,this.axios.get("bookings/"+this.id+"/pay-remaining-amount").then(e=>{e.data.success&&(this.isSuccess=!0),e.data.error&&(this.isError=!0),setTimeout(()=>{this.isSuccess=!1,this.isError=!1},3e3)}).finally(()=>{this.isLoading=!1})}}},j=s(1241);const W=(0,j.A)(X,[["render",V],["__scopeId","data-v-476753b0"]]);var H=W,B={name:"BookingItem",props:{booking:{default:function(){return{}}}},data:function(){return{isDelete:!1}},components:{PayRemainingAmount:H},computed:{customer(){return this.booking.customer_first_name+" "+this.booking.customer_last_name},status(){return this.$root.statusesList[this.booking.status].label},statusColor(){return this.$root.statusesList[this.booking.status].color},date(){return this.dateFormat(this.booking.date)},fromTime(){const e="default"===this.timeFormat?"HH:mm":"h:mma";return this.moment(this.booking.time,"HH:mm").format(e)},toTime(){const e="default"===this.timeFormat?"HH:mm":"h:mma";return this.booking.services.length>0?this.moment(this.booking.services[this.booking.services.length-1].end_at,"HH:mm").format(e):this.moment(this.booking.time,"HH:mm").format(e)},totalSum(){return this.booking.amount+" "+this.booking.currency},id(){return this.booking.id},assistants(){return this.booking.services.map(e=>({id:e.assistant_id,name:e.assistant_name})).filter(e=>+e.id)},timeFormat(){return void 0===this.$root.settings.time_format?"default":this.$root.settings.time_format.type??"default"}},methods:{deleteItem(){this.$emit("deleteItem"),this.isDelete=!1},showDetails(){this.$emit("showDetails")}},emits:["deleteItem","showDetails"]};const N=(0,j.A)(B,[["render",$],["__scopeId","data-v-e1c2f722"]]);var O=N,U={name:"UpcomingReservations",props:{shop:{default:function(){return{}}}},data:function(){return{hours:[{label:this.getLabel("label8Hours"),hours:8},{label:this.getLabel("label24Hours"),hours:24},{label:this.getLabel("label3Days"),hours:72},{label:this.getLabel("label1Week"),hours:168}],hourValue:8,bookingsList:[],isLoading:!1,filterAttendant:"",search:"",timeout:null}},mounted(){this.load(),setInterval(()=>this.update(),6e4)},components:{BookingItem:O},watch:{hourValue(e){e&&this.load()},search(e){e?(this.hourValue="",this.loadSearch()):this.hourValue=8},shop(){this.load()}},computed:{attendants(){var e={};return e[0]={id:"",name:this.getLabel("allTitle")},this.bookingsList.forEach(t=>{t.services.forEach(t=>{t.assistant_id>0&&(e[t.assistant_id]={id:t.assistant_id,name:t.assistant_name})})}),Object.values(e).length>1?Object.values(e):[]},filteredBookingsList(){return this.bookingsList.filter(e=>{var t=!1;return e.services.forEach(e=>{this.filterAttendant===e.assistant_id&&(t=!0)}),""===this.filterAttendant||t})}},methods:{deleteItem(e){this.axios.delete("bookings/"+e).then(()=>{this.bookingsList=this.bookingsList.filter(t=>t.id!==e)})},showDetails(e){this.$emit("showItem",e)},load(){this.isLoading=!0,this.bookingsList=[],this.axios.get("bookings/upcoming",{params:{hours:this.hourValue,shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items}).finally(()=>{this.isLoading=!1})},loadSearch(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLoading=!0,this.bookingsList=[],this.axios.get("bookings",{params:{search:this.search,per_page:-1,order_by:"date_time",order:"asc",start_date:this.moment().format("YYYY-MM-DD"),shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items}).finally(()=>{this.isLoading=!1})},1e3)},update(){this.axios.get("bookings/upcoming",{params:{hours:this.hourValue,shop:this.shop?this.shop.id:null}}).then(e=>{this.bookingsList=e.data.items})}},emits:["showItem"]};const q=(0,j.A)(U,[["render",v],["__scopeId","data-v-645af42f"]]);var R=q;const z=e=>((0,o.Qi)("data-v-c52acdae"),e=e(),(0,o.jt)(),e),Q={class:"booking-details-customer-info"},K={class:"date"},G=z(()=>(0,o.Lk)("br",null,null,-1)),J={class:"time"},Z=z(()=>(0,o.Lk)("br",null,null,-1)),ee={class:"customer-firstname"},te=["src"],se={class:"customer-lastname"},ie={class:"customer-email"},oe={class:"customer-phone"},ae={key:0,class:"customer-phone-actions"},ne=["href"],le=["href"],re=["href"],de={class:"customer-note"},ue={class:"booking-details-extra-info"},ce={class:"booking-details-extra-info-header"},he={class:"booking-details-extra-info-header-title"},me=["aria-expanded"],pe=z(()=>(0,o.Lk)("br",null,null,-1)),ge=z(()=>(0,o.Lk)("br",null,null,-1)),fe={class:"booking-details-total-info"},ke={class:"service"},ve=["innerHTML"],be={class:"resource"},_e={class:"attendant"},ye={class:"total"},Le=["innerHTML"],Ce={class:"transaction-id"},Se={class:"discount"},we={class:"deposit"},Fe={class:"due"},De={class:"booking-details-status-info"};function Te(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row"),h=(0,o.g2)("b-collapse"),m=(0,o.g2)("b-button"),p=(0,o.g2)("PayRemainingAmount");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("bookingDetailsTitle")),1),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Q,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"10"}),(0,o.bF)(d,{sm:"2",class:"actions"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:r.close},null,8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",K,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("dateTitle")),1),G,(0,o.bF)(u,{icon:"fa-solid fa-calendar-days"}),(0,o.eW)(" "+(0,n.v_)(r.date),1)])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",J,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("timeTitle")),1),Z,(0,o.bF)(u,{icon:"fa-regular fa-clock"}),(0,o.eW)(" "+(0,n.v_)(r.time),1)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ee,[(0,o.eW)((0,n.v_)(r.customerFirstname)+" ",1),(0,o.Lk)("div",{class:"images",onClick:t[0]||(t[0]=(0,i.D$)((...e)=>r.showCustomerImages&&r.showCustomerImages(...e),["prevent"]))},[r.photos.length>0?((0,o.uX)(),(0,o.CE)("img",{key:0,src:r.photos.length?r.photos[0]["url"]:"",class:"photo"},null,8,te)):((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-images"}))])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",se,(0,n.v_)(r.customerLastname),1)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ie,(0,n.v_)(e.getDisplayEmail(r.customerEmail)),1)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",oe,[(0,o.eW)((0,n.v_)(e.getDisplayPhone(r.customerPhone))+" ",1),r.customerPhone&&!e.shouldHidePhone?((0,o.uX)(),(0,o.CE)("span",ae,[(0,o.Lk)("a",{target:"_blank",href:"tel:"+r.customerPhone,class:"phone"},[(0,o.bF)(u,{icon:"fa-solid fa-phone"})],8,ne),(0,o.Lk)("a",{target:"_blank",href:"sms:"+r.customerPhone,class:"sms"},[(0,o.bF)(u,{icon:"fa-solid fa-message"})],8,le),(0,o.Lk)("a",{target:"_blank",href:"https://wa.me/"+r.customerPhone,class:"whatsapp"},[(0,o.bF)(u,{icon:"fa-brands fa-whatsapp"})],8,re)])):(0,o.Q3)("",!0)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",de,(0,n.v_)(r.customerNote),1)]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ue,[(0,o.Lk)("div",ce,[(0,o.Lk)("div",he,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["booking-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[1]||(t[1]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(u,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,me)])]),(0,o.bF)(h,{id:"collapse-2",class:"booking-details-extra-info-fields",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[2]||(t[2]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(c,{key:e.key,class:"booking-details-extra-info-field-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(e.label)+":",1),pe,(0,o.Lk)("strong",null,(0,n.v_)(e.value),1)]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,{class:"booking-details-extra-info-field-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("customerPersonalNotesLabel"))+":",1),ge,(0,o.Lk)("strong",null,(0,n.v_)(r.customerPersonalNote),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",fe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.services,(e,t)=>((0,o.uX)(),(0,o.Wv)(c,{key:t},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ke,[(0,o.Lk)("strong",null,[(0,o.eW)((0,n.v_)(e.service_name)+" [",1),(0,o.Lk)("span",{innerHTML:e.service_price+s.booking.currency},null,8,ve),(0,o.eW)("]")])])]),_:2},1024),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",be,(0,n.v_)(e.resource_name),1)]),_:2},1024),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",_e,(0,n.v_)(e.assistant_name),1)]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ye,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("strong",null,(0,n.v_)(this.getLabel("totalTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("strong",null,[(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,Le)])]),_:1})]),_:1})])]),_:1}),(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ce,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("transactionIdTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(r.transactionId.join(", ")),1)]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Se,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("discountTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.discount},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",we,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("depositTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.deposit},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"4"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Fe,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("dueTitle")),1)]),_:1}),(0,o.bF)(d,{sm:"6",innerHTML:r.due},null,8,["innerHTML"])]),_:1})])]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",De,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"status"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(r.status),1)]),_:1}),(0,o.bF)(d,{sm:"6",class:"booking-details-actions"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{variant:"primary",onClick:r.edit},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-pen-to-square"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("editButtonLabel")),1)]),_:1},8,["onClick"]),(0,o.bF)(p,{booking:s.booking},null,8,["booking"])]),_:1})]),_:1})])]),_:1})]),_:1})],512)),[[i.aG,e.show]])}var Ie=s(788),Ae=s.n(Ie),Ee=s(9148),Me=s.n(Ee),xe={computed:{axios(){return Ae().create({baseURL:window.slnPWA.api,headers:{"Access-Token":window.slnPWA.token}})},moment(){return Me()},locale(){return window.slnPWA.locale},shouldHideEmail(){return this.$root.settings&&this.$root.settings.hide_customers_email},shouldHidePhone(){return this.$root.settings&&this.$root.settings.hide_customers_phone}},methods:{dateFormat(e,t){var s=this.$root.settings.date_format?this.$root.settings.date_format.js_format:null;if(!s)return e;var i=s.replace("dd","DD").replace("M","MMM").replace("mm","MM").replace("yyyy","YYYY");return Me()(e).format(t||i)},timeFormat(e){return Me()(e,"HH:mm").format(this.getTimeFormat())},getTimeFormat(){var e=this.$root.settings.time_format?this.$root.settings.time_format.js_format:null;if(e){var t=e.indexOf("p")>-1?e.replace("H","hh").replace("p","a").replace("ii","mm"):e.replace("hh","HH").replace("ii","mm");return t}},getQueryParams(){let e=window.location.search;e=e.replace("?","");let t=e.split("&").map(e=>({key:e.split("=")[0],value:e.split("=")[1]})),s={};return t.forEach(e=>{s[e.key]=e.value}),s},getLabel(e){return window.slnPWA.labels[e]},getDisplayEmail(e){return this.shouldHideEmail?"***@***":e},getDisplayPhone(e){return this.shouldHidePhone?"*******":e}}},$e={name:"BookingDetails",mixins:[xe],props:{booking:{default:function(){return{}}}},computed:{date(){return this.dateFormat(this.bookingData.date)},time(){return this.timeFormat(this.bookingData.time)},customerFirstname(){return this.bookingData.customer_first_name},customerLastname(){return this.bookingData.customer_last_name},customerEmail(){return this.getDisplayEmail(this.bookingData.customer_email)},customerPhone(){const e=this.bookingData.customer_phone?this.bookingData.customer_phone_country_code+this.bookingData.customer_phone:"";return this.getDisplayPhone(e)},customerNote(){return this.bookingData.note},customerPersonalNote(){return this.bookingData.customer_personal_note},services(){return this.bookingData.services},totalSum(){return this.bookingData.amount+this.bookingData.currency},transactionId(){return this.bookingData.transaction_id},discount(){return this.bookingData.discounts_details.length>0?this.bookingData.discounts_details.map(e=>e.name+" ("+e.amount_string+")").join(", "):"-"},deposit(){return+this.bookingData.deposit>0?this.bookingData.deposit+this.bookingData.currency:"-"},due(){return+this.bookingData.amount-+this.bookingData.deposit+this.bookingData.currency},status(){return this.$root.statusesList[this.booking.status].label},customFieldsList(){return this.bookingData.custom_fields.filter(e=>-1===["html","file"].indexOf(e.type))},photos(){return this.bookingData.customer_photos}},mounted(){this.toggleShow(),setInterval(()=>this.update(),6e4)},components:{PayRemainingAmount:H},data:function(){return{show:!0,visibleExtraInfo:!1,bookingData:this.booking}},methods:{close(){this.$emit("close")},edit(){this.$emit("edit")},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)},update(){this.axios.get("bookings/"+this.bookingData.id).then(e=>{this.bookingData=e.data.items[0]})},showCustomerImages(){this.$emit("showCustomerImages",{id:this.bookingData.customer_id,photos:this.photos})}},emits:["close","edit","showCustomerImages"]};const Pe=(0,j.A)($e,[["render",Te],["__scopeId","data-v-c52acdae"]]);var Ye=Pe;function Ve(e,t,s,a,l,r){const d=(0,o.g2)("EditBooking");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("editReservationTitle")),1),(0,o.bF)(d,{bookingID:s.booking.id,date:s.booking.date,time:s.booking.time,customerID:s.customer?s.customer.id:s.booking.customer_id,customerFirstname:s.customer?s.customer.first_name:s.booking.customer_first_name,customerLastname:s.customer?s.customer.last_name:s.booking.customer_last_name,customerEmail:s.customer?s.customer.email:s.booking.customer_email,customerPhone:s.customer?s.customer.phone:s.booking.customer_phone,customerAddress:s.customer?s.customer.address:s.booking.customer_address,customerNotes:s.booking.note,customerPersonalNotes:s.customer?s.customer.note:s.booking.customer_personal_note,services:s.booking.services,discounts:s.booking.discounts,status:s.booking.status,isLoading:e.isLoading,isSaved:e.isSaved,isError:e.isError,errorMessage:e.errorMessage,customFields:s.booking.custom_fields,shop:s.booking.shop,onClose:r.close,onChooseCustomer:r.chooseCustomer,onErrorState:r.handleErrorState,onSave:r.save},null,8,["bookingID","date","time","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerNotes","customerPersonalNotes","services","discounts","status","isLoading","isSaved","isError","errorMessage","customFields","shop","onClose","onChooseCustomer","onErrorState","onSave"])],512)),[[i.aG,e.show]])}const Xe=e=>((0,o.Qi)("data-v-491b9962"),e=e(),(0,o.jt)(),e),je={class:"booking-details-customer-info"},We={class:"date"},He={class:"time"},Be=["onClick"],Ne={class:"select-existing-client"},Oe={class:"customer-firstname"},Ue={class:"customer-lastname"},qe={class:"customer-email"},Re={class:"customer-address"},ze={class:"customer-phone"},Qe={class:"customer-notes"},Ke={class:"save-as-new-customer"},Ge={class:"booking-details-extra-info"},Je={class:"booking-details-extra-info-header"},Ze={class:"booking-details-extra-info-header-title"},et=["aria-expanded"],tt={class:"customer-personal-notes"},st={class:"label",for:"customer_personal_notes"},it={class:"booking-details-total-info"},ot={class:"service"},at={key:0,class:"option-item option-item-selected"},nt={class:"name"},lt={key:0},rt={class:"service-name"},dt={class:"info"},ut={class:"price"},ct=["innerHTML"],ht=Xe(()=>(0,o.Lk)("span",null," | ",-1)),mt={class:"option-item"},pt={class:"availability-wrapper"},gt={class:"name"},ft={key:0},kt={class:"service-name"},vt={class:"info"},bt={class:"price"},_t=["innerHTML"],yt=Xe(()=>(0,o.Lk)("span",null," | ",-1)),Lt={class:"vue-select-search"},Ct={class:"resource"},St={key:0,class:"option-item option-item-selected"},wt={class:"name"},Ft={class:"option-item"},Dt={class:"availability-wrapper"},Tt={class:"name"},It={class:"vue-select-search"},At={class:"attendant"},Et={key:0,class:"option-item option-item-selected"},Mt={class:"name"},xt={class:"option-item"},$t={class:"availability-wrapper"},Pt={class:"name"},Yt={key:0},Vt=Xe(()=>(0,o.Lk)("span",null," [",-1)),Xt=["innerHTML"],jt=Xe(()=>(0,o.Lk)("span",null,"]",-1)),Wt={class:"vue-select-search"},Ht={class:"add-service"},Bt={class:"add-service-required"},Nt={key:0,class:"booking-discount-info"},Ot={class:"discount"},Ut={key:0,class:"discount-name"},qt={class:"option-item"},Rt={class:"discount-name"},zt={class:"info"},Qt={class:"vue-select-search"},Kt={class:"add-discount"},Gt={class:"booking-details-status-info"};function Jt(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row"),h=(0,o.g2)("b-input-group-text"),m=(0,o.g2)("Datepicker"),p=(0,o.g2)("b-input-group"),g=(0,o.g2)("b-form-input"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-form-textarea"),v=(0,o.g2)("b-form-checkbox"),b=(0,o.g2)("CustomField"),_=(0,o.g2)("b-collapse"),y=(0,o.g2)("vue-select"),L=(0,o.g2)("b-spinner"),C=(0,o.g2)("b-alert"),S=(0,o.g2)("b-form-select");return(0,o.uX)(),(0,o.CE)("div",{onClick:t[19]||(t[19]=t=>e.showTimeslots=!1)},[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",je,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"10"}),(0,o.bF)(d,{sm:"2",class:"actions"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:r.close},null,8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",We,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("dateTitle")),1),(0,o.bF)(p,null,{prepend:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-calendar-days"})]),_:1})]),default:(0,o.k6)(()=>[(0,o.bF)(m,{format:"yyyy-MM-dd",modelValue:e.elDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elDate=t),"auto-apply":!0,"text-input":!0,"hide-input-icon":!0,clearable:!1,class:(0,n.C4)({required:e.requiredFields.indexOf("date")>-1})},null,8,["modelValue","class"])]),_:1})])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",He,[(0,o.Lk)("span",null,(0,n.v_)(this.getLabel("timeTitle")),1),(0,o.bF)(p,null,{prepend:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-regular fa-clock"})]),_:1})]),default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:e.elTime,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elTime=t),onClick:t[2]||(t[2]=(0,i.D$)(t=>e.showTimeslots=!e.showTimeslots,["stop"])),class:(0,n.C4)(["timeslot-input",{required:e.requiredFields.indexOf("time")>-1}])},null,8,["modelValue","class"]),(0,o.Lk)("div",{class:(0,n.C4)(["timeslots",{hide:!this.showTimeslots}]),onClick:t[3]||(t[3]=(0,i.D$)(()=>{},["stop"]))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.timeslots,e=>((0,o.uX)(),(0,o.CE)("span",{key:e,class:(0,n.C4)(["timeslot",{free:r.freeTimeslots.includes(this.moment(e,this.getTimeFormat()).format("HH:mm"))}]),onClick:t=>r.setTime(e)},(0,n.v_)(e),11,Be))),128))],2)]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ne,[(0,o.bF)(f,{variant:"primary",onClick:r.chooseCustomer},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-users"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("selectExistingClientButtonLabel")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Oe,[(0,o.bF)(g,{placeholder:this.getLabel("customerFirstnamePlaceholder"),modelValue:e.elCustomerFirstname,"onUpdate:modelValue":t[4]||(t[4]=t=>e.elCustomerFirstname=t),class:(0,n.C4)({required:e.requiredFields.indexOf("customer_first_name")>-1})},null,8,["placeholder","modelValue","class"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ue,[(0,o.bF)(g,{placeholder:this.getLabel("customerLastnamePlaceholder"),modelValue:e.elCustomerLastname,"onUpdate:modelValue":t[5]||(t[5]=t=>e.elCustomerLastname=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",qe,[(0,o.bF)(g,{type:this.bookingID&&e.shouldHideEmail?"password":"text",placeholder:e.getLabel("customerEmailPlaceholder"),modelValue:e.elCustomerEmail,"onUpdate:modelValue":t[6]||(t[6]=t=>e.elCustomerEmail=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Re,[(0,o.bF)(g,{placeholder:this.getLabel("customerAddressPlaceholder"),modelValue:e.elCustomerAddress,"onUpdate:modelValue":t[7]||(t[7]=t=>e.elCustomerAddress=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ze,[(0,o.bF)(g,{type:this.bookingID&&e.shouldHidePhone?"password":"tel",placeholder:e.getLabel("customerPhonePlaceholder"),modelValue:e.elCustomerPhone,"onUpdate:modelValue":t[8]||(t[8]=t=>e.elCustomerPhone=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Qe,[(0,o.bF)(k,{modelValue:e.elCustomerNotes,"onUpdate:modelValue":t[9]||(t[9]=t=>e.elCustomerNotes=t),placeholder:this.getLabel("customerNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ke,[(0,o.bF)(v,{modelValue:e.saveAsNewCustomer,"onUpdate:modelValue":t[10]||(t[10]=t=>e.saveAsNewCustomer=t),switch:""},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("saveAsNewCustomerLabel")),1)]),_:1},8,["modelValue"])])]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ge,[(0,o.Lk)("div",Je,[(0,o.Lk)("div",Ze,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["booking-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[11]||(t[11]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(u,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,et)])]),(0,o.bF)(_,{id:"collapse-2",class:"mt-2",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[13]||(t[13]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(b,{key:e.key,field:e,value:r.getCustomFieldValue(e.key,e.default_value),onUpdate:r.updateCustomField},null,8,["field","value","onUpdate"]))),128)),(0,o.bF)(c,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",tt,[(0,o.Lk)("label",st,(0,n.v_)(this.getLabel("customerPersonalNotesLabel")),1),(0,o.bF)(k,{modelValue:e.elCustomerPersonalNotes,"onUpdate:modelValue":t[12]||(t[12]=t=>e.elCustomerPersonalNotes=t),modelModifiers:{lazy:!0},id:"customer_personal_notes",placeholder:this.getLabel("customerPersonalNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",it,[e.isLoadingServicesAssistants?(0,o.Q3)("",!0):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.elServices,(s,a)=>((0,o.uX)(),(0,o.Wv)(c,{key:a,class:"service-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ot,[(0,o.bF)(y,{ref_for:!0,ref:"select-service",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_service_"+a)>-1}]),"close-on-select":"",modelValue:s.service_id,"onUpdate:modelValue":e=>s.service_id=e,options:r.getServicesListBySearch(r.servicesList,e.serviceSearch[a]),"label-by":"[serviceName, price, duration, category]","value-by":"value"},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",at,[(0,o.Lk)("div",nt,[(0,o.Lk)("span",null,(0,n.v_)(e.category),1),e.category?((0,o.uX)(),(0,o.CE)("span",lt," | ")):(0,o.Q3)("",!0),(0,o.Lk)("span",rt,(0,n.v_)(e.serviceName),1)]),(0,o.Lk)("div",dt,[(0,o.Lk)("div",ut,[(0,o.Lk)("span",null,(0,n.v_)(e.price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,ct),ht,(0,o.Lk)("span",null,(0,n.v_)(e.duration),1)])])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectServicesPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",mt,[(0,o.Lk)("div",pt,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",gt,[(0,o.Lk)("span",null,(0,n.v_)(e.category),1),e.category?((0,o.uX)(),(0,o.CE)("span",ft," | ")):(0,o.Q3)("",!0),(0,o.Lk)("span",kt,(0,n.v_)(e.serviceName),1)])]),(0,o.Lk)("div",vt,[(0,o.Lk)("div",bt,[(0,o.Lk)("span",null,(0,n.v_)(e.price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,_t),yt,(0,o.Lk)("span",null,(0,n.v_)(e.duration),1)])])])]),_:2},1032,["modelValue","onUpdate:modelValue","options","class"]),(0,o.Lk)("li",Lt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(g,{modelValue:e.serviceSearch[a],"onUpdate:modelValue":t=>e.serviceSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectServicesSearchPlaceholder"),onMousedown:t[14]||(t[14]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024),r.isShowResource(s)?((0,o.uX)(),(0,o.Wv)(d,{key:0,sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ct,[(0,o.bF)(y,{ref_for:!0,ref:"select-resource",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_assistant_"+a)>-1}]),"close-on-select":"",modelValue:s.resource_id,"onUpdate:modelValue":e=>s.resource_id=e,options:r.getAttendantsOrResourcesListBySearch(r.resourcesList,e.resourceSearch[a]),"label-by":"text","value-by":"value",onFocus:e=>r.loadAvailabilityResources(s.service_id)},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",St,[(0,o.Lk)("div",wt,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1)])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectResourcesPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",Ft,[(0,o.Lk)("div",Dt,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",Tt,(0,n.v_)(e.text),1)])])]),_:2},1032,["modelValue","onUpdate:modelValue","options","class","onFocus"]),(0,o.Lk)("li",It,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(g,{modelValue:e.resourceSearch[a],"onUpdate:modelValue":t=>e.resourceSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectResourcesSearchPlaceholder"),onMousedown:t[15]||(t[15]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024)):(0,o.Q3)("",!0),r.isShowAttendant(s)?((0,o.uX)(),(0,o.Wv)(d,{key:1,sm:""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",At,[(0,o.bF)(y,{ref_for:!0,ref:"select-assistant",class:(0,n.C4)(["service-select",{required:e.requiredFields.indexOf("services_assistant_"+a)>-1}]),"close-on-select":"",modelValue:s.assistant_id,"onUpdate:modelValue":e=>s.assistant_id=e,options:r.getAttendantsOrResourcesListBySearch(r.attendantsList,e.assistantSearch[a]),"label-by":"text","value-by":"value",onFocus:e=>r.loadAvailabilityAttendants(s.service_id)},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("div",Et,[(0,o.Lk)("div",Mt,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1)])])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectAttendantsPlaceholder")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",xt,[(0,o.Lk)("div",$t,[(0,o.Lk)("div",{class:(0,n.C4)(["availability",{available:e.available}])},null,2),(0,o.Lk)("div",Pt,[(0,o.Lk)("span",null,(0,n.v_)(e.text),1),e.variable_price?((0,o.uX)(),(0,o.CE)("span",Yt,[Vt,(0,o.Lk)("span",null,(0,n.v_)(e.variable_price),1),(0,o.Lk)("span",{innerHTML:e.currency},null,8,Xt),jt])):(0,o.Q3)("",!0)])])])]),_:2},1032,["modelValue","onUpdate:modelValue","options","class","onFocus"]),(0,o.Lk)("li",Wt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(g,{modelValue:e.assistantSearch[a],"onUpdate:modelValue":t=>e.assistantSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectAssistantsSearchPlaceholder"),onMousedown:t[16]||(t[16]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024)):(0,o.Q3)("",!0),(0,o.bF)(d,{sm:"1",class:"service-row-delete"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:e=>r.deleteService(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"add-service-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ht,[(0,o.bF)(f,{variant:"primary",onClick:r.addService,disabled:e.isLoadingServicesAssistants},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-plus"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("addServiceButtonLabel")),1)]),_:1},8,["onClick","disabled"]),e.isLoadingServicesAssistants?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary",class:"selects-loader"})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Bt,[(0,o.bF)(C,{show:e.requiredFields.indexOf("services")>-1,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("addServiceMessage")),1)]),_:1},8,["show"])])]),_:1})]),_:1})])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[r.showDiscount?((0,o.uX)(),(0,o.CE)("div",Nt,[e.isLoadingDiscounts?(0,o.Q3)("",!0):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.elDiscounts,(s,a)=>((0,o.uX)(),(0,o.Wv)(c,{key:a,class:"discount-row"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"5"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ot,[(0,o.bF)(y,{ref_for:!0,ref:"select-discount",class:"discount-select","close-on-select":"",modelValue:e.elDiscounts[a],"onUpdate:modelValue":t=>e.elDiscounts[a]=t,options:r.getDiscountsListBySearch(r.discountsList,e.discountSearch[a]),"label-by":"text","value-by":"value"},{label:(0,o.k6)(({selected:e})=>[e?((0,o.uX)(),(0,o.CE)("span",Ut,(0,n.v_)(e.text),1)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,n.v_)(this.getLabel("selectDiscountLabel")),1)],64))]),"dropdown-item":(0,o.k6)(({option:e})=>[(0,o.Lk)("div",qt,[(0,o.Lk)("span",Rt,(0,n.v_)(e.text),1),(0,o.Lk)("div",zt,[(0,o.Lk)("span",null,"expires: "+(0,n.v_)(e.expires),1)])])]),_:2},1032,["modelValue","onUpdate:modelValue","options"]),(0,o.Lk)("li",Qt,[(0,o.bF)(u,{icon:"fa-solid fa-magnifying-glass",class:"vue-select-search-icon"}),(0,o.bF)(g,{modelValue:e.discountSearch[a],"onUpdate:modelValue":t=>e.discountSearch[a]=t,class:"vue-select-search-input",placeholder:this.getLabel("selectDiscountsSearchPlaceholder"),onMousedown:t[17]||(t[17]=(0,i.D$)(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),_:2},1024),(0,o.bF)(d,{sm:"2",class:"discount-row-delete"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-circle-xmark",onClick:e=>r.deleteDiscount(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"add-discount-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Kt,[(0,o.bF)(f,{variant:"primary",onClick:r.addDiscount,disabled:e.isLoadingDiscounts},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-plus"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("addDiscountButtonLabel")),1)]),_:1},8,["onClick","disabled"]),e.isLoadingDiscounts?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary",class:"selects-loader"})):(0,o.Q3)("",!0)])]),_:1})]),_:1})])):(0,o.Q3)("",!0)]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Gt,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"status"},{default:(0,o.k6)(()=>[(0,o.bF)(S,{modelValue:e.elStatus,"onUpdate:modelValue":t[18]||(t[18]=t=>e.elStatus=t),options:r.statusesList},null,8,["modelValue","options"])]),_:1}),(0,o.bF)(d,{sm:"6"},{default:(0,o.k6)(()=>[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"6",class:"save-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",onClick:r.save},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-check"}),(0,o.eW)(" "+(0,n.v_)(this.getLabel("saveButtonLabel")),1)]),_:1},8,["onClick"])]),_:1}),(0,o.bF)(d,{sm:"6",class:"save-button-result-wrapper"},{default:(0,o.k6)(()=>[s.isLoading?((0,o.uX)(),(0,o.Wv)(L,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(C,{show:s.isSaved,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("savedLabel")),1)]),_:1},8,["show"]),(0,o.bF)(C,{show:s.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(s.errorMessage),1)]),_:1},8,["show"]),(0,o.bF)(C,{show:!e.isValid&&e.requiredFields.length>1,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("validationMessage")),1)]),_:1},8,["show"]),(0,o.bF)(C,{show:e.shopError,fade:"",variant:"warning"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("selectShopFirstMessage")),1)]),_:1},8,["show"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})])}s(8743),s(2598),s(9229);const Zt=["for"],es=["for"],ts=["for"];function ss(e,t,s,i,a,l){const r=(0,o.g2)("b-form-input"),d=(0,o.g2)("b-form-textarea"),u=(0,o.g2)("b-form-checkbox"),c=(0,o.g2)("b-form-select"),h=(0,o.g2)("b-col"),m=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(m,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{sm:"12"},{default:(0,o.k6)(()=>["text"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(r,{modelValue:e.elValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elValue=t),modelModifiers:{lazy:!0},id:l.key},null,8,["modelValue","id"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,Zt)],64)):(0,o.Q3)("",!0),"textarea"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.bF)(d,{modelValue:e.elValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elValue=t),modelModifiers:{lazy:!0},id:l.key},null,8,["modelValue","id"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,es)],64)):(0,o.Q3)("",!0),"checkbox"===l.type?((0,o.uX)(),(0,o.Wv)(u,{key:2,modelValue:e.elValue,"onUpdate:modelValue":t[2]||(t[2]=t=>e.elValue=t),id:l.key},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(l.label),1)]),_:1},8,["modelValue","id"])):(0,o.Q3)("",!0),"select"===l.type?((0,o.uX)(),(0,o.CE)(o.FK,{key:3},[(0,o.bF)(c,{modelValue:e.elValue,"onUpdate:modelValue":t[3]||(t[3]=t=>e.elValue=t),id:l.key,options:l.options},null,8,["modelValue","id","options"]),(0,o.Lk)("label",{class:"label",for:l.key},(0,n.v_)(l.label),9,ts)],64)):(0,o.Q3)("",!0)]),_:1})]),_:1})}var is={name:"CustomField",props:{field:{default:function(){return{}}},value:{default:function(){return""}}},mounted(){this.update()},data:function(){let e=this.value;return"checkbox"===this.field.type&&(e=!!e),{elValue:e}},watch:{elValue(){this.update()}},computed:{key(){return this.field.key},type(){return this.field.type},label(){return this.field.label},options(){return this.field.options.map(e=>({value:e.value,text:e.label}))}},methods:{update(){this.$emit("update",this.key,this.elValue)}},emits:["update"]};const os=(0,j.A)(is,[["render",ss],["__scopeId","data-v-19833334"]]);var as=os,ns={name:"EditBooking",props:{bookingID:{default:function(){return""}},date:{default:function(){return""}},time:{default:function(){return""}},customerID:{default:function(){return""}},customerFirstname:{default:function(){return""}},customerLastname:{default:function(){return""}},customerEmail:{default:function(){return""}},customerAddress:{default:function(){return""}},customerPhone:{default:function(){return""}},customerNotes:{default:function(){return""}},customerPersonalNotes:{default:function(){return""}},services:{default:function(){return[]}},discounts:{default:function(){return[]}},status:{default:function(){return""}},isLoading:{default:function(){return!1}},isSaved:{default:function(){return!1}},isError:{default:function(){return!1}},errorMessage:{default:function(){return""}},customFields:{default:function(){return[]}},shop:{default:function(){return{}}}},mixins:[xe],mounted(){this.loadDiscounts(),this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.loadCustomFields(),this.isLoadingServicesAssistants=!0,Promise.all([this.loadServices(),this.loadAttendants(),this.loadResources(),this.loadServicesCategory()]).then(()=>{this.isLoadingServicesAssistants=!1,this.elServices.forEach((e,t)=>{this.addServicesSelectSearchInput(t),this.addAssistantsSelectSearchInput(t),this.addResourcesSelectSearchInput(t)})})},data:function(){const e=this.customerEmail||"",t=this.customerPhone||"";return{shopError:!1,elDate:this.date,elTime:this.timeFormat(this.time),elCustomerFirstname:this.customerFirstname,elCustomerLastname:this.customerLastname,elCustomerEmail:this.bookingID&&this.shouldHideEmail?"***@***":e,elCustomerPhone:this.bookingID&&this.shouldHidePhone?"*******":t,originalCustomerEmail:e,originalCustomerPhone:t,elCustomerAddress:this.customerAddress,elCustomerNotes:this.customerNotes,elCustomerPersonalNotes:this.customerPersonalNotes,elServices:[...this.services].map(e=>({service_id:e.service_id,assistant_id:e.assistant_id,resource_id:e.resource_id})),bookings:[],elDiscounts:[...this.discounts],elStatus:this.status,visibleDiscountInfo:!1,elDiscountsList:[],elServicesList:[],elServicesNameList:[],elAttendantsList:[],elResourcesList:[],showTimeslots:!1,availabilityIntervals:{},saveAsNewCustomer:!1,availabilityServices:[],serviceSearch:[],discountSearch:[],isValid:!0,requiredFields:[],visibleExtraInfo:!1,customFieldsList:[],elCustomFields:this.customFields,isLoadingServicesAssistants:!1,isLoadingDiscounts:!1,assistantSearch:[],resourceSearch:[],availabilityAttendants:[],availabilityResources:[],vueTelInputOptions:{placeholder:this.getLabel("customerPhonePlaceholder")},specificValidationMessage:this.getLabel("validationMessage")}},watch:{elDate(){this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.loadDiscounts(),this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})},elTime(){this.loadAvailabilityServices(),this.loadDiscounts(),this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})},timeslots(e){e.length&&!this.elTime&&(this.elTime=this.moment(e[0],this.getTimeFormat()).format("HH:mm"))},bookingServices(){this.loadDiscounts()},shop(e,t){e?.id!==t?.id&&(this.loadAvailabilityIntervals(),this.loadAvailabilityServices(),this.isLoadingServicesAssistants=!0,Promise.all([this.loadServices(),this.loadAttendants(),this.loadResources(),this.loadServicesCategory()]).then(()=>{this.isLoadingServicesAssistants=!1,this.clearServices(),this.elServices.forEach((e,t)=>{this.addServicesSelectSearchInput(t),this.addAssistantsSelectSearchInput(t),this.addResourcesSelectSearchInput(t)}),this.loadDiscounts(),this.requiredFields=[],this.isValid=!0,this.shopError=!1}).catch(()=>{this.isLoadingServicesAssistants=!1}))},elServices:{deep:!0,handler(){this.isError&&this.$emit("error-state",{isError:!1,errorMessage:""})}}},computed:{statusesList(){var e=[];for(var t in this.$root.statusesList)e.push({value:t,text:this.$root.statusesList[t].label});return e},discountsList(){var e=[];return this.elDiscountsList.forEach(t=>{e.push({value:t.id,text:t.name,expires:t.valid_to})}),e},servicesList(){var e=[];return this.elServicesList.forEach(t=>{let s=[];t.categories.forEach(e=>{let t=this.elServicesNameList.find(t=>t.id===e);t&&s.push(t.name)});let i=!1,o=this.availabilityServices.find(e=>e.id===t.id);o&&(i=o.available);let a=t.price;this.shop&&t.shops&&t.shops.forEach(e=>{e.id===this.shop.id&&(a=e.price)}),e.push({value:t.id,price:a,duration:t.duration,currency:t.currency,serviceName:t.name,category:s.join(", "),empty_assistants:t.empty_assistants,empty_resources:t.empty_resources,available:i})}),e},attendantsList(){var e=[];return this.elAttendantsList.forEach(t=>{let s=!1,i=!1,o=this.availabilityAttendants.find(e=>e.id===t.id);o&&(s=o.available,i=o.variable_price),e.push({value:t.id,text:t.name,available:s,variable_price:i,currency:t.currency})}),e},resourcesList(){var e=[];return this.elResourcesList.forEach(t=>{let s=!1,i=this.availabilityResources.find(e=>e.id===t.id);i&&(s=1===i.status),e.push({value:t.id,text:t.name,available:s})}),e},timeslots(){var e=this.availabilityIntervals.workTimes?Object.values(this.availabilityIntervals.workTimes):[];return e.map(e=>this.timeFormat(e))},freeTimeslots(){return this.availabilityIntervals.times?Object.values(this.availabilityIntervals.times):[]},showAttendant(){return"undefined"===typeof this.$root.settings.attendant_enabled||this.$root.settings.attendant_enabled},showResource(){return"undefined"===typeof this.$root.settings.resources_enabled||this.$root.settings.resources_enabled},showDiscount(){return"undefined"===typeof this.$root.settings.discounts_enabled||this.$root.settings.discounts_enabled},bookingServices(){return JSON.parse(JSON.stringify(this.elServices)).map(e=>(e.assistant_id?e.assistant_id:e.assistant_id=0,e.resource_id?e.resource_id:e.resource_id=0,e))}},methods:{sprintf(e,...t){return e.replace(/%s/g,e=>t.shift()||e)},close(){this.$emit("close")},chooseCustomer(){this.$emit("chooseCustomer")},convertDurationToMinutes(e){const[t,s]=e.split(":").map(Number);return 60*t+s},isOverlapping(e,t,s,i){return e.isBefore(i)&&t.isAfter(s)},async validateAssistantAvailability(e){try{const t=await this.getExistingBookings(e.date);for(const s of e.services){if(!s.assistant_id)continue;const i=this.servicesList.find(e=>e.value===s.service_id);if(!i)continue;const o=this.convertDurationToMinutes(i.duration),a=this.moment(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm"),n=this.moment(a).add(o,"minutes"),l=t.filter(e=>e.services.some(e=>e.assistant_id===s.assistant_id));for(const e of l)for(const t of e.services){if(t.assistant_id!==s.assistant_id)continue;const i=this.servicesList.find(e=>e.value===t.service_id);if(!i)continue;const o=this.convertDurationToMinutes(i.duration),l=this.moment(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm"),r=this.moment(l).add(o,"minutes");if(this.isOverlapping(a,n,l,r)){const e=this.attendantsList.find(e=>e.value===s.assistant_id),t=e?e.text:this.getLabel("assistantBusyTitle");throw new Error(`${t} `+this.sprintf(this.getLabel("assistantBusyMessage"),l.format("HH:mm"),r.format("HH:mm")))}}}return!0}catch(t){return this.$emit("error-state",{isError:!0,errorMessage:t.message}),t}},async getExistingBookings(e){try{const t=await this.axios.get("bookings",{params:{start_date:this.moment(e).format("YYYY-MM-DD"),end_date:this.moment(e).format("YYYY-MM-DD"),per_page:-1,shop:this.shop?.id||null}});return Array.isArray(t.data.items)?t.data.items.filter(e=>e.id!==this.bookingID):[]}catch(t){return console.error("Error getting existing bookings:",t),[]}},clearServices(){this.elServices=[],this.serviceSearch=[],this.assistantSearch=[],this.resourceSearch=[]},async save(){if(this.isValid=this.validate(),!this.isValid)return this.requiredFields.includes("shop")&&this.$root.settings.shops_enabled?void this.$emit("error",{message:this.getLabel("selectShopFirstMessage"),type:"shop"}):void 0;const e=this.bookingID&&this.shouldHideEmail&&"***@***"===this.elCustomerEmail?this.originalCustomerEmail:this.elCustomerEmail,t=this.bookingID&&this.shouldHidePhone&&"*******"===this.elCustomerPhone?this.originalCustomerPhone:this.elCustomerPhone,s={date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),status:this.elStatus,customer_id:this.customerID||0,customer_first_name:this.elCustomerFirstname,customer_last_name:this.elCustomerLastname,customer_email:e,customer_phone:t,customer_address:this.elCustomerAddress,services:this.bookingServices,discounts:this.elDiscounts,note:this.elCustomerNotes,customer_personal_note:this.elCustomerPersonalNotes,save_as_new_customer:this.saveAsNewCustomer,custom_fields:this.elCustomFields};this.shop&&(s.shop={id:this.shop.id});const i=await this.validateAssistantAvailability(s);i instanceof Error||(this.$emit("error-state",{isError:!1,errorMessage:""}),this.$emit("save",s))},loadDiscounts(){this.isLoadingDiscounts=!0,this.axios.get("discounts",{params:{return_active:!0,date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),customer_email:this.elCustomerEmail,services:this.bookingServices,shop:this.shop?this.shop.id:null}}).then(e=>{this.elDiscountsList=e.data.items,this.isLoadingDiscounts=!1,this.discountSearch=[],this.elDiscounts=this.elDiscounts.filter(e=>{const t=this.discountsList.map(e=>e.value);return t.includes(e)}),this.elDiscounts.forEach((e,t)=>{this.addDiscountsSelectSearchInput(t)})})},loadServices(){return this.axios.get("services",{params:{per_page:-1,shop:this.shop?this.shop.id:null}}).then(e=>{this.elServicesList=e.data.items})},loadServicesCategory(){return this.axios.get("services/categories").then(e=>{this.elServicesNameList=e.data.items})},loadAttendants(){return this.axios.get("assistants",{params:{shop:this.shop?this.shop.id:null}}).then(e=>{this.elAttendantsList=e.data.items})},loadResources(){return this.axios.get("resources",{params:{shop:this.shop?this.shop.id:null}}).then(e=>{this.elResourcesList=e.data.items}).catch(()=>{})},loadAvailabilityIntervals(){this.axios.post("availability/intervals",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityIntervals=e.data.intervals})},loadAvailabilityServices(){this.axios.post("availability/booking/services",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,is_all_services:!0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityServices=e.data.services})},loadAvailabilityAttendants(e){this.axios.post("availability/booking/assistants",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,selected_service_id:e||0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityAttendants=e.data.assistants})},loadAvailabilityResources(e){this.axios.post("availability/booking/resources",{date:this.moment(this.elDate).format("YYYY-MM-DD"),time:this.moment(this.elTime,this.getTimeFormat()).format("HH:mm"),booking_id:this.bookingID?this.bookingID:0,selected_service_id:e||0,services:this.bookingServices.filter(e=>e.service_id),shop:this.shop?this.shop.id:0}).then(e=>{this.availabilityResources=e.data.resources})},loadCustomFields(){this.axios.get("custom-fields/booking").then(e=>{this.customFieldsList=e.data.items.filter(e=>-1===["html","file"].indexOf(e.type))})},addDiscount(){this.elDiscounts.push(null),this.addDiscountsSelectSearchInput(this.elDiscounts.length-1)},deleteDiscount(e){this.elDiscounts.splice(e,1),this.discountSearch.splice(e,1)},addService(){this.elServices.push({service_id:null,assistant_id:null,resource_id:null}),this.addServicesSelectSearchInput(this.elServices.length-1),this.addAssistantsSelectSearchInput(this.elServices.length-1),this.addResourcesSelectSearchInput(this.elServices.length-1)},deleteService(e){this.elServices.splice(e,1),this.serviceSearch.splice(e,1)},setTime(e){this.elTime=this.moment(e,this.getTimeFormat()).format("HH:mm"),this.showTimeslots=!1,this.loadAvailabilityServices(),this.loadDiscounts()},getServicesListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test([e.category,e.serviceName,e.price,e.duration].join(""))):e},getDiscountsListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test(e.text)):e},validate(){return this.requiredFields=[],this.shopError=!1,this.$root.settings.shops_enabled&&(this.shop&&this.shop.id||(this.requiredFields.push("shop"),this.shopError=!0)),this.elDate||this.requiredFields.push("date"),this.elTime.trim()||this.requiredFields.push("time"),this.elCustomerFirstname.trim()||this.requiredFields.push("customer_first_name"),this.bookingServices.length||this.requiredFields.push("services"),this.bookingServices.forEach((e,t)=>{e.service_id||this.requiredFields.push("services_service_"+t),this.isShowAttendant(e)&&!e.assistant_id&&this.requiredFields.push("services_assistant_"+t)}),1===this.requiredFields.length&&this.requiredFields.includes("shop")?this.specificValidationMessage=this.getLabel("selectShopFirstMessage"):this.specificValidationMessage=this.getLabel("validationMessage"),0===this.requiredFields.length},isShowAttendant(e){let t=this.servicesList.find(t=>t.value===e.service_id);return t?this.showAttendant&&(!e.service_id||t&&!t.empty_assistants):this.showAttendant},isShowResource(e){let t=this.servicesList.find(t=>t.value===e.service_id);return t?this.showResource&&(!e.service_id||t&&!t.empty_resources):this.showResource},updateCustomField(e,t){let s=this.elCustomFields.find(t=>t.key===e);s?s.value=t:this.elCustomFields.push({key:e,value:t})},getCustomFieldValue(e,t){let s=this.elCustomFields.find(t=>t.key===e);return s?s.value:t},addServicesSelectSearchInput(e){this.serviceSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".service .vue-dropdown")[e].prepend(window.document.querySelectorAll(".service .vue-select-search")[e]);let t=this.$refs["select-service"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".service .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.serviceSearch[e]=""})},0)},addAssistantsSelectSearchInput(e){this.assistantSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".attendant .vue-dropdown")[e].prepend(window.document.querySelectorAll(".attendant .vue-select-search")[e]);let t=this.$refs["select-assistant"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".attendant .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.assistantSearch[e]=""})},0)},addResourcesSelectSearchInput(e){this.resourceSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".resource .vue-dropdown")[e].prepend(window.document.querySelectorAll(".resource .vue-select-search")[e]);let t=this.$refs["select-resource"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".resource .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.resourceSearch[e]=""})},0)},addDiscountsSelectSearchInput(e){this.discountSearch.push(""),setTimeout(()=>{window.document.querySelectorAll(".discount .vue-dropdown")[e].prepend(window.document.querySelectorAll(".discount .vue-select-search")[e]);let t=this.$refs["select-discount"][e],s=t.blur;t.blur=()=>{};let i=t.focus,o=window.document.querySelectorAll(".discount .vue-select-search-input")[e];t.focus=()=>{i(),setTimeout(()=>{o.focus()},0)},o.addEventListener("blur",()=>{s(),this.discountSearch[e]=""})},0)},getAttendantsOrResourcesListBySearch(e,t){return t?e.filter(e=>new RegExp(t,"ig").test([e.text].join(""))):e}},emits:["close","chooseCustomer","save","error-state"],components:{CustomField:as}};const ls=(0,j.A)(ns,[["render",Jt],["__scopeId","data-v-491b9962"]]);var rs=ls,ds={name:"EditBookingItem",props:{booking:{default:function(){return{}}},customer:{default:function(){return{}}}},components:{EditBooking:rs},mounted(){this.toggleShow()},data:function(){return{isLoading:!1,isSaved:!1,isError:!1,errorMessage:"",show:!0,bookings:[]}},methods:{handleErrorState({isError:e,errorMessage:t}){this.isError=e,this.errorMessage=t},close(e){this.isError=!1,this.$emit("close",e)},chooseCustomer(){this.isError=!1,this.$emit("chooseCustomer")},save(e){this.isLoading=!0,this.axios.put("bookings/"+this.booking.id,e).then(e=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3),this.isLoading=!1,this.axios.get("bookings/"+e.data.id).then(e=>{this.close(e.data.items[0])})},e=>{this.isError=!0,this.errorMessage=e.response.data.message,this.isLoading=!1})},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)}},emits:["close","chooseCustomer"]};const us=(0,j.A)(ds,[["render",Ve]]);var cs=us;const hs={class:"title"},ms={class:"search"},ps={class:"filters"},gs={class:"customers-list"},fs={key:2,class:"no-result"};function ks(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-form-input"),u=(0,o.g2)("b-button"),c=(0,o.g2)("b-col"),h=(0,o.g2)("b-row"),m=(0,o.g2)("b-spinner"),p=(0,o.g2)("CustomerItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",hs,(0,n.v_)(this.getLabel("customersAddressBookTitle")),1),(0,o.Lk)("div",ms,[(0,o.bF)(r,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(d,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=t=>e.search=t),class:"search-input"},null,8,["modelValue"]),e.search?((0,o.uX)(),(0,o.Wv)(r,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:t[1]||(t[1]=t=>e.search="")})):(0,o.Q3)("",!0)]),(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(c,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ps,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filters,t=>((0,o.uX)(),(0,o.Wv)(u,{variant:"outline-primary",key:t.value,onClick:s=>e.searchFilter=t.value,pressed:e.searchFilter===t.value},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(t.label),1)]),_:2},1032,["onClick","pressed"]))),128))])]),_:1})]),_:1}),(0,o.Lk)("div",gs,[e.isLoading?((0,o.uX)(),(0,o.Wv)(m,{key:0,variant:"primary"})):e.customersList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(e.customersList,e=>((0,o.uX)(),(0,o.Wv)(p,{key:e.id,customer:e,chooseCustomerAvailable:s.chooseCustomerAvailable,onChoose:t=>l.choose(e),onShowImages:l.showImages,onEdit:l.edit},null,8,["customer","chooseCustomerAvailable","onChoose","onShowImages","onEdit"]))),128)):((0,o.uX)(),(0,o.CE)("span",fs,(0,n.v_)(this.getLabel("customersAddressBookNoResultLabel")),1))]),s.chooseCustomerAvailable?((0,o.uX)(),(0,o.Wv)(u,{key:0,variant:"primary",class:"go-back",onClick:l.closeChooseCustomer},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("goBackButtonLabel")),1)]),_:1},8,["onClick"])):(0,o.Q3)("",!0)])}const vs={class:"customer"},bs={class:"customer-firstname"},_s={class:"customer-lastname"},ys={class:"customer-email"},Ls={key:0,class:"customer-phone"},Cs={class:"total-order-sum"},Ss=["innerHTML"],ws={class:"total-order-count"},Fs={class:"wrapper"},Ds={key:0,class:"button-choose"},Ts=["src"],Is={class:"customer-phone-wrapper"},As={key:0},Es=["href"],Ms=["href"],xs=["href"];function $s(e,t,s,a,l,r){const d=(0,o.g2)("b-col"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",vs,[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"8",class:"customer-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:"customer-first-last-name-wrapper",onClick:t[0]||(t[0]=(...e)=>r.edit&&r.edit(...e))},[(0,o.Lk)("span",bs,(0,n.v_)(r.customerFirstname),1),(0,o.Lk)("span",_s,(0,n.v_)(r.customerLastname),1)]),(0,o.Lk)("div",ys,(0,n.v_)(e.getDisplayEmail(r.customerEmail)),1),r.customerPhone?((0,o.uX)(),(0,o.CE)("div",Ls,(0,n.v_)(e.getDisplayPhone(r.customerPhone)),1)):(0,o.Q3)("",!0)]),_:1}),(0,o.bF)(d,{sm:"4",class:"total-order-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("span",Cs,[(0,o.bF)(u,{icon:"fa-solid fa-chart-simple"}),(0,o.Lk)("span",{innerHTML:r.totalSum},null,8,Ss)]),(0,o.Lk)("span",ws,[(0,o.bF)(u,{icon:"fa-solid fa-medal"}),(0,o.eW)(" "+(0,n.v_)(r.customerScore),1)])]),_:1})]),_:1}),(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"total-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Fs,[s.chooseCustomerAvailable?((0,o.uX)(),(0,o.CE)("div",Ds,[(0,o.bF)(u,{icon:"fa-solid fa-circle-plus",onClick:(0,i.D$)(r.choose,["prevent"])},null,8,["onClick"])])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"images",onClick:t[1]||(t[1]=(0,i.D$)((...e)=>r.showImages&&r.showImages(...e),["prevent"]))},[r.photos.length>0?((0,o.uX)(),(0,o.CE)("img",{key:0,src:r.photos.length?r.photos[0]["url"]:"",class:"photo"},null,8,Ts)):((0,o.uX)(),(0,o.Wv)(u,{key:1,icon:"fa-solid fa-images"}))])]),(0,o.Lk)("div",Is,[r.customerPhone&&!e.shouldHidePhone?((0,o.uX)(),(0,o.CE)("span",As,[(0,o.Lk)("a",{target:"_blank",href:"tel:"+r.customerPhone,class:"phone"},[(0,o.bF)(u,{icon:"fa-solid fa-phone"})],8,Es),(0,o.Lk)("a",{target:"_blank",href:"sms:"+r.customerPhone,class:"sms"},[(0,o.bF)(u,{icon:"fa-solid fa-message"})],8,Ms),(0,o.Lk)("a",{target:"_blank",href:"https://wa.me/"+r.customerPhone,class:"whatsapp"},[(0,o.bF)(u,{icon:"fa-brands fa-whatsapp"})],8,xs)])):(0,o.Q3)("",!0)])]),_:1})]),_:1})])]),_:1})]),_:1})}var Ps={name:"CustomerItem",mixins:[xe],props:{customer:{default:function(){return{}}},chooseCustomerAvailable:{default:function(){return!1}}},computed:{customerFirstname(){return this.customer.first_name},customerLastname(){return this.customer.last_name},customerEmail(){return this.getDisplayEmail(this.customer.email)},customerPhone(){const e=this.customer.phone?this.customer.phone_country_code+this.customer.phone:"";return this.getDisplayPhone(e)},customerScore(){return this.customer.score},totalSum(){return this.$root.settings.currency_symbol+this.customer.total_amount_reservations},totalCount(){return this.customer.bookings.length>0?this.customer.bookings.length:"-"},photos(){return this.customer.photos}},methods:{choose(){this.$emit("choose")},showImages(){this.$emit("showImages",this.customer)},edit(){this.$emit("edit",this.customer)}},emits:["choose","showImages","edit"]};const Ys=(0,j.A)(Ps,[["render",$s],["__scopeId","data-v-4d97c33e"]]);var Vs=Ys,Xs={name:"CustomersAddressBook",props:{chooseCustomerAvailable:{default:function(){return!1}},shop:{default:function(){return{}}},customer:{default:function(){return{}}}},mounted(){this.load()},watch:{searchFilter(e){e&&this.load()},search(e){e?(this.searchFilter="",this.loadSearch()):this.searchFilter="a|b"},shop(){this.load()},customer(){this.customer&&this.customersList.forEach((e,t)=>{this.customer.id===e.id&&(this.customersList[t]=this.customer)})}},data:function(){return{filters:[{label:"a - b",value:"a|b"},{label:"c - d",value:"c|d"},{label:"e - f",value:"e|f"},{label:"g - h",value:"g|h"},{label:"i - j",value:"i|j"},{label:"k - l",value:"k|l"},{label:"m - n",value:"m|n"},{label:"o - p",value:"o|p"},{label:"q - r",value:"q|r"},{label:"s - t",value:"s|t"},{label:"u - v",value:"u|v"},{label:"w - x",value:"w|x"},{label:"y - z",value:"y|z"}],searchFilter:"a|b",customersList:[],isLoading:!1,search:"",timeout:null}},methods:{closeChooseCustomer(){this.$emit("closeChooseCustomer")},choose(e){this.$emit("choose",e)},load(){this.isLoading=!0,this.customersList=[],this.axios.get("customers",{params:{search:this.searchFilter,search_type:"start_with",search_field:"first_name",order_by:"first_name_last_name",shop:this.shop?this.shop.id:null}}).then(e=>{this.customersList=e.data.items}).finally(()=>{this.isLoading=!1})},loadSearch(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLoading=!0,this.customersList=[],this.axios.get("customers",{params:{search:this.search,order_by:"first_name_last_name",shop:this.shop?this.shop.id:null}}).then(e=>{this.customersList=e.data.items}).finally(()=>{this.isLoading=!1})},1e3)},showImages(e){this.$emit("showImages",e)},edit(e){this.$emit("edit",e)}},components:{CustomerItem:Vs},emits:["closeChooseCustomer","choose","showImages","edit"]};const js=(0,j.A)(Xs,[["render",ks],["__scopeId","data-v-a5f519f6"]]);var Ws=js;const Hs={class:"images"},Bs={class:"photo-wrapper"},Ns=["src"],Os=["onClick"],Us=["onClick"],qs={key:2,class:"date"},Rs={class:"take-photo-label"},zs={class:"select-photo-label"};function Qs(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("slide"),h=(0,o.g2)("navigation"),m=(0,o.g2)("pagination"),p=(0,o.g2)("carousel"),g=(0,o.g2)("b-col"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(g,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Hs,[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(g,{sm:"12",class:"list"},{default:(0,o.k6)(()=>[l.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:0,variant:"primary"})):(0,o.Q3)("",!0),(0,o.bF)(p,{ref:"carousel",modelValue:l.photoIndex,wrapAround:!0,transition:0},{addons:(0,o.k6)(({slidesCount:e})=>[e>1?((0,o.uX)(),(0,o.Wv)(h,{key:0})):(0,o.Q3)("",!0),e>1?((0,o.uX)(),(0,o.Wv)(m,{key:1})):(0,o.Q3)("",!0)]),default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.photos,(t,s)=>((0,o.uX)(),(0,o.Wv)(c,{key:s},{default:(0,o.k6)(()=>[(0,o.Lk)("span",Bs,[(0,o.Lk)("img",{src:t.url,class:"photo"},null,8,Ns),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",{key:0,class:"photo-icon-wrapper fa-trash-wrapper",onClick:(0,i.D$)(e=>r.remove(t),["prevent","stop"])},[(0,o.bF)(u,{icon:"fa-solid fa-trash"})],8,Os)):(0,o.Q3)("",!0),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",{key:1,class:"photo-icon-wrapper fa-circle-check-wrapper",onClick:(0,i.D$)(e=>r.setAsDefault(t),["prevent","stop"])},[(0,o.bF)(u,{icon:"fa-regular fa-circle-check",class:(0,n.C4)({default:t.default})},null,8,["class"])],8,Us)):(0,o.Q3)("",!0),t.attachment_id?((0,o.uX)(),(0,o.CE)("span",qs,(0,n.v_)(e.dateFormat(1e3*t.created,"DD.MM.YYYY")),1)):(0,o.Q3)("",!0)])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),(0,o.bF)(g,{sm:"12",class:"buttons"},{default:(0,o.k6)(()=>[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(g,{sm:"6",class:"take-photo",onClick:t[1]||(t[1]=e=>this.$refs.takePhoto.click())},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",size:"lg"},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-camera"})]),_:1}),(0,o.Lk)("div",Rs,(0,n.v_)(this.getLabel("takePhotoButtonLabel")),1),(0,o.bo)((0,o.Lk)("input",{type:"file",accept:"image/*",capture:"camera",ref:"takePhoto",onChange:t[0]||(t[0]=(...e)=>r.uploadTakePhoto&&r.uploadTakePhoto(...e))},null,544),[[i.aG,!1]])]),_:1}),(0,o.bF)(g,{sm:"6",class:"select-photo"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",size:"lg",onClick:t[2]||(t[2]=e=>this.$refs.downloadImages.click())},{default:(0,o.k6)(()=>[(0,o.bF)(u,{icon:"fa-solid fa-cloud-arrow-up"})]),_:1}),(0,o.Lk)("div",zs,(0,n.v_)(this.getLabel("selectPhotoButtonLabel")),1),(0,o.bo)((0,o.Lk)("input",{type:"file",accept:"image/*",ref:"downloadImages",onChange:t[3]||(t[3]=(...e)=>r.uploadFromPhone&&r.uploadFromPhone(...e))},null,544),[[i.aG,!1]])]),_:1})]),_:1})]),_:1})]),_:1}),(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(g,{sm:"12",class:"back"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"outline-primary",onClick:r.close,size:"lg"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("backImagesButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})])]),_:1})]),_:1})}var Ks={name:"ImagesList",props:{customer:{default:function(){return{}}}},data(){let e=0;return this.customer.photos.forEach((t,s)=>{+t.default&&(e=s)}),{baseUrl:"/{SLN_PWA_DIST_PATH}/",customerData:this.customer,photoIndex:e,isLoading:!1}},computed:{photos(){return this.customerData.photos.length?this.customerData.photos:[{url:this.baseUrl+"img/placeholder-image.png"}]},id(){return this.customerData.id}},methods:{close(){this.$emit("close",this.customerData)},uploadTakePhoto(){let e=this.$refs.takePhoto.files[0];this.upload(e),this.$refs.takePhoto.value=""},uploadFromPhone(){let e=this.$refs.downloadImages.files[0];this.upload(e),this.$refs.downloadImages.value=""},upload(e,t){let s=new FormData;s.append("file",e,t),this.isLoading=!0,this.axios.post("customers/"+this.id+"/photos",s,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.customerData=e.data.items[0]}).finally(()=>{this.isLoading=!1})},remove(e){this.isLoading=!0,this.axios.delete("customers/"+this.id+"/photos/"+e.attachment_id).then(e=>{this.customerData=e.data.items[0]}).finally(()=>{this.isLoading=!1})},setAsDefault(e){this.isLoading=!0,this.axios.put("customers/"+this.id+"/photos/"+e.attachment_id,{photo:Object.assign({},e,{default:1})}).then(e=>{this.customerData=e.data.items[0],this.$refs.carousel.slideTo(0)}).finally(()=>{this.isLoading=!1})}},emits:["close"]};const Gs=(0,j.A)(Ks,[["render",Qs],["__scopeId","data-v-271d799f"]]);var Js=Gs,Zs={name:"UpcomingReservationsTab",props:{shop:{default:function(){return{}}}},components:{UpcomingReservations:R,BookingDetails:Ye,EditBookingItem:cs,CustomersAddressBook:Ws,ImagesList:Js},data:function(){return{showItem:!1,editItem:!1,item:null,isChooseCustomer:!1,customer:null,isShowCustomerImages:!1,showImagesCustomer:null}},methods:{setShowItem(e){this.showItem=!0,this.item=e},closeShowItem(){this.showItem=!1},setEditItem(){this.editItem=!0},closeEditItem(e){this.editItem=!1,this.customer=null,e&&this.setShowItem(e)},chooseCustomer(){this.isChooseCustomer=!0},closeChooseCustomer(){this.isChooseCustomer=!1},choose(e){this.customer=e,this.closeChooseCustomer()},showCustomerImages(e){this.isShowCustomerImages=!0,this.showImagesCustomer=e,this.$emit("hideTabsHeader",!0)},closeShowCustomerImages(e){this.item.customer_photos=e.photos,this.isShowCustomerImages=!1,this.$emit("hideTabsHeader",!1)}},emits:["hideTabsHeader"]};const ei=(0,j.A)(Zs,[["render",c]]);var ti=ei;function si(e,t,s,i,a,n){const l=(0,o.g2)("b-spinner"),r=(0,o.g2)("ImagesList"),d=(0,o.g2)("CustomersAddressBook"),u=(0,o.g2)("AddBookingItem"),c=(0,o.g2)("EditBookingItem"),h=(0,o.g2)("CustomerDetails"),m=(0,o.g2)("BookingDetails"),p=(0,o.g2)("ReservationsCalendar");return(0,o.uX)(),(0,o.CE)("div",null,[e.isLoading?((0,o.uX)(),(0,o.Wv)(l,{key:0,variant:"primary"})):e.isShowCustomerImages?((0,o.uX)(),(0,o.Wv)(r,{key:1,customer:e.showImagesCustomer,onClose:n.closeShowCustomerImages},null,8,["customer","onClose"])):e.isChooseCustomer?((0,o.uX)(),(0,o.Wv)(d,{key:2,onCloseChooseCustomer:n.closeChooseCustomer,chooseCustomerAvailable:!0,onChoose:n.choose,shop:e.addItem?s.shop:e.item.shop},null,8,["onCloseChooseCustomer","onChoose","shop"])):e.addItem?((0,o.uX)(),(0,o.Wv)(u,{key:3,onClose:n.close,date:e.date,time:e.time,customer:e.customer,onChooseCustomer:n.chooseCustomer,shop:s.shop},null,8,["onClose","date","time","customer","onChooseCustomer","shop"])):e.editItem?((0,o.uX)(),(0,o.Wv)(c,{key:4,booking:e.item,customer:e.customer,onClose:n.closeEditItem,onChooseCustomer:n.chooseCustomer},null,8,["booking","customer","onClose","onChooseCustomer"])):e.showCustomerProfile?((0,o.uX)(),(0,o.Wv)(h,{key:5,customerID:e.selectedCustomer.id,customerFirstname:e.selectedCustomer.first_name,customerLastname:e.selectedCustomer.last_name,customerEmail:e.selectedCustomer.email,customerPhone:e.selectedCustomer.phone,customerAddress:e.selectedCustomer.address,customerPersonalNotes:e.selectedCustomer.note,onClose:n.closeCustomerProfile},null,8,["customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes","onClose"])):e.showItem?((0,o.uX)(),(0,o.Wv)(m,{key:6,booking:e.item,onClose:n.closeShowItem,onEdit:n.setEditItem,onShowCustomerImages:n.showCustomerImages},null,8,["booking","onClose","onEdit","onShowCustomerImages"])):((0,o.uX)(),(0,o.Wv)(p,{key:7,modelValue:e.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedDate=t),onShowItem:n.setShowItem,onAdd:n.add,onViewCustomerProfile:n.openCustomerProfile,shop:s.shop},null,8,["modelValue","onShowItem","onAdd","onViewCustomerProfile","shop"]))])}const ii={class:"reservations-calendar"},oi={class:"title"},ai={key:1,class:"slots-inner"},ni={key:2};function li(e,t,s,i,a,l){const r=(0,o.g2)("SearchInput"),d=(0,o.g2)("BookingCalendar"),u=(0,o.g2)("SlotsHeadline"),c=(0,o.g2)("b-spinner"),h=(0,o.g2)("TimeAxis"),m=(0,o.g2)("AttendantsList"),p=(0,o.g2)("AttendantTimeSlots"),g=(0,o.g2)("BookingCard"),f=(0,o.g2)("SlotActions"),k=(0,o.g2)("TimeSlots");return(0,o.uX)(),(0,o.CE)("div",ii,[(0,o.Lk)("h5",oi,(0,n.v_)(this.getLabel("reservationsCalendarTitle")),1),(0,o.bF)(r,{modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=e=>a.search=e),onSearch:l.handleSearch},null,8,["modelValue","onSearch"]),(0,o.bF)(d,{modelValue:l.date,"onUpdate:modelValue":t[1]||(t[1]=e=>l.date=e),"availability-stats":a.availabilityStats,"is-loading":a.isLoadingTimeslots||!a.attendantsLoaded,onMonthYearUpdate:l.handleMonthYear},null,8,["modelValue","availability-stats","is-loading","onMonthYearUpdate"]),(0,o.bF)(u,{date:l.date,settings:e.$root.settings,attendants:a.attendants,"is-attendant-view":a.isAttendantView,"onUpdate:isAttendantView":t[2]||(t[2]=e=>a.isAttendantView=e)},null,8,["date","settings","attendants","is-attendant-view"]),(0,o.Lk)("div",{class:(0,n.C4)(["slots",{"slots--assistants":a.isAttendantView}]),ref:"slotsContainer"},[a.isLoading?((0,o.uX)(),(0,o.Wv)(c,{key:0,variant:"primary"})):l.isReadyToRender?((0,o.uX)(),(0,o.CE)("div",ai,[(0,o.bF)(h,{timeslots:a.timeslots,"slot-height":a.slotHeight,"time-format-new":a.timeFormatNew},null,8,["timeslots","slot-height","time-format-new"]),(0,o.Lk)("div",(0,o.v6)({class:"slots-content",ref:"dragScrollContainer"},(0,o.Tb)(l.dragHandlers,!0)),[a.isAttendantView?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[a.attendantsLoaded?((0,o.uX)(),(0,o.Wv)(m,{key:0,attendants:l.sortedAttendants,"column-widths":l.columnWidths,"column-gap":a.attendantColumnGap,"is-hidden":!l.shouldShowAttendants},null,8,["attendants","column-widths","column-gap","is-hidden"])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"bookings-canvas",style:(0,n.Tr)(l.canvasStyle)},[l.sortedAttendants.length>0&&a.timeslots.length>0?((0,o.uX)(),(0,o.Wv)(p,{key:0,"sorted-attendants":l.sortedAttendants,timeslots:a.timeslots,"column-widths":l.columnWidths,"slot-height":a.slotHeight,"selected-slots":a.selectedTimeSlots,"processed-bookings":l.processedBookings,"availability-intervals":a.availabilityIntervals,lockedTimeslots:a.lockedTimeslots,"onUpdate:lockedTimeslots":t[3]||(t[3]=e=>a.lockedTimeslots=e),onLock:l.handleAttendantLock,onUnlock:l.handleAttendantUnlock,onSlotProcessing:l.setSlotProcessing,date:l.date,shop:s.shop,onAdd:l.addBookingForAttendant},null,8,["sorted-attendants","timeslots","column-widths","slot-height","selected-slots","processed-bookings","availability-intervals","lockedTimeslots","onLock","onUnlock","onSlotProcessing","date","shop","onAdd"])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.processedBookings,e=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e.id+(e._serviceTime?.start||"")},[e._assistantId?((0,o.uX)(),(0,o.Wv)(g,{key:0,booking:e,style:(0,n.Tr)(l.getBookingStyle(e)),class:(0,n.C4)({"booking-card--default-duration":e._isDefaultDuration}),onDeleteItem:l.deleteItem,onShowDetails:l.showDetails,onViewCustomerProfile:l.viewCustomerProfile},null,8,["booking","style","class","onDeleteItem","onShowDetails","onViewCustomerProfile"])):(0,o.Q3)("",!0)],64))),128))],4)],64)):((0,o.uX)(),(0,o.CE)("div",{key:1,class:"bookings-canvas",style:(0,n.Tr)(l.canvasStyle)},[(0,o.bF)(k,{timeslots:a.timeslots,"slot-style":l.getTimeSlotLineStyle,"is-locked":l.isSlotLocked,"is-system-locked":l.isSystemLocked,"is-manual-locked":l.isManualLocked,"is-processing":(e,t)=>a.slotProcessing[`${e}-${t}`],"active-index":a.activeSlotIndex,onToggle:l.toggleSlotActions},{actions:(0,o.k6)(({timeSlot:e,slotIndex:t})=>[(0,o.bF)(f,{"time-slot":e,index:t,timeslots:a.timeslots,"is-locked":l.isSlotLocked,"is-available":l.isAvailable,"is-system-locked":l.isSystemLocked,"is-schedule-locked":l.isSlotLocked,"is-manual-locked":l.isManualLocked,"is-disabled":a.slotProcessing[`${e}-${a.timeslots[t+1]}`],"has-overlapping":l.hasOverlappingBookings,date:l.date,shop:s.shop,onAdd:l.addBooking,onLock:l.handleSlotLock,onUnlock:l.handleSlotUnlock,onUpdateProcessing:l.updateSlotProcessing},null,8,["time-slot","index","timeslots","is-locked","is-available","is-system-locked","is-schedule-locked","is-manual-locked","is-disabled","has-overlapping","date","shop","onAdd","onLock","onUnlock","onUpdateProcessing"])]),_:1},8,["timeslots","slot-style","is-locked","is-system-locked","is-manual-locked","is-processing","active-index","onToggle"]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.bookingsList,e=>((0,o.uX)(),(0,o.Wv)(g,{key:e.id,booking:e,style:(0,n.Tr)(l.getBookingStyle(e)),onDeleteItem:l.deleteItem,onShowDetails:l.showDetails,onViewCustomerProfile:l.viewCustomerProfile},null,8,["booking","style","onDeleteItem","onShowDetails","onViewCustomerProfile"]))),128))],4))],16),a.showCurrentTimeLine?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"current-time-line",style:(0,n.Tr)({top:a.currentTimeLinePosition+"px"})},null,4)):(0,o.Q3)("",!0)])):((0,o.uX)(),(0,o.CE)("span",ni,(0,n.v_)(this.getLabel("noResultTimeslotsLabel")),1))],2)])}s(5337),s(9471);const ri={class:"time-axis"};function di(e,t,s,i,a,l){return(0,o.uX)(),(0,o.CE)("div",ri,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.formattedTimeslots,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:"axis-"+t,class:"time-axis-item",style:(0,n.Tr)({height:s.slotHeight+"px"})},(0,n.v_)(e),5))),128))])}var ui={name:"TimeAxis",props:{timeslots:{type:Array,required:!0},slotHeight:{type:Number,required:!0},timeFormatNew:{type:String,required:!1}},computed:{formattedTimeslots(){return this.timeslots.map(e=>this.formatTime(e,this.timeFormatNew))}},methods:{formatTime(e){return this.timeFormat(e)}}};const ci=(0,j.A)(ui,[["render",di],["__scopeId","data-v-1d703707"]]);var hi=ci;const mi={class:"attendant-header"},pi={class:"attendant-avatar"},gi=["src","alt"],fi=["title"];function ki(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",{class:(0,n.C4)(["attendants-list",{"attendants-list--hidden":s.isHidden}])},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.attendants,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"attendant-column",style:(0,n.Tr)({width:s.columnWidths[e.id]+"px",marginRight:(t===s.attendants.length-1?0:s.columnGap)+"px"})},[(0,o.Lk)("div",mi,[(0,o.Lk)("div",pi,[e.image_url?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.image_url,alt:e.name},null,8,gi)):((0,o.uX)(),(0,o.Wv)(r,{key:1,icon:"fa-solid fa-user-alt",class:"default-avatar-icon"}))]),(0,o.Lk)("div",{class:"attendant-name",title:e.name},(0,n.v_)(e.name),9,fi)])],4))),128))],2)}var vi={name:"AttendantsList",props:{attendants:{type:Array,required:!0},columnWidths:{type:Object,required:!0},columnGap:{type:Number,required:!0},isHidden:{type:Boolean,default:!1}}};const bi=(0,j.A)(vi,[["render",ki],["__scopeId","data-v-a81b7f8a"]]);var _i=bi;const yi=["onClick"],Li={class:"time-slot-actions"};function Ci(e,t,s,i,a,l){return(0,o.uX)(),(0,o.CE)("div",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(t,i)=>((0,o.uX)(),(0,o.CE)("div",{key:"line-"+i,class:(0,n.C4)(["time-slot-line",{active:s.activeIndex===i,locked:s.isLocked(s.timeslots[i],s.timeslots[i+1]),processing:s.isProcessing(s.timeslots[i],s.timeslots[i+1])}]),style:(0,n.Tr)(s.slotStyle(i)),onClick:t=>e.$emit("toggle",i)},[(0,o.Lk)("div",Li,[(0,o.RG)(e.$slots,"actions",(0,n._B)((0,o.Ng)({timeSlot:t,slotIndex:i})),void 0,!0)])],14,yi))),128))])}var Si={name:"TimeSlots",props:{timeslots:{type:Array,required:!0},slotStyle:{type:Function,required:!0},isLocked:{type:Function,required:!0},isProcessing:{type:Function,required:!0},activeIndex:{type:Number,default:-1}},emits:["toggle"]};const wi=(0,j.A)(Si,[["render",Ci],["__scopeId","data-v-35d361e4"]]);var Fi=wi;const Di={class:"slot-actions"};function Ti(e,t,s,i,a,n){const l=(0,o.g2)("BookingAdd"),r=(0,o.g2)("BookingBlockSlot");return(0,o.uX)(),(0,o.CE)("div",Di,[s.isLocked(s.timeSlot,n.getNextSlot())?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(l,{key:0,timeslot:s.timeSlot,"is-available":s.isAvailable(s.timeSlot),onAdd:t[0]||(t[0]=t=>e.$emit("add",s.timeSlot))},null,8,["timeslot","is-available"])),!s.hasOverlapping(s.index)||s.isLocked(s.timeSlot,n.getNextSlot())?((0,o.uX)(),(0,o.Wv)(r,{key:1,"is-lock":s.isLocked(s.timeSlot,n.getNextSlot()),"is-system-locked":s.isSystemLocked(s.timeSlot),"is-manual-locked":s.isManualLocked(s.timeSlot,n.getNextSlot()),"is-disabled":s.isDisabled,start:s.timeSlot,shop:s.shop,end:n.getNextSlot(),date:n.getFormattedDate(),"assistant-id":s.assistantId,onLockStart:n.handleLockStart,onLock:t[1]||(t[1]=t=>e.$emit("lock",t)),onLockEnd:n.handleLockEnd,onUnlockStart:n.handleUnlockStart,onUnlock:t[2]||(t[2]=t=>e.$emit("unlock",t)),onUnlockEnd:n.handleUnlockEnd},null,8,["is-lock","is-system-locked","is-manual-locked","is-disabled","start","shop","end","date","assistant-id","onLockStart","onLockEnd","onUnlockStart","onUnlockEnd"])):(0,o.Q3)("",!0)])}const Ii={class:"booking-add"};function Ai(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("span",Ii,[(0,o.bF)(r,{icon:"fa-solid fa-circle-plus",class:(0,n.C4)({available:s.isAvailable}),onClick:l.add},null,8,["class","onClick"])])}var Ei={name:"BookingAdd",props:{timeslot:{default:function(){return"09:00"}},isAvailable:{default:function(){return!0}}},computed:{timeFormat(){return this.$root.settings&&this.$root.settings.time_format?this.$root.settings.time_format.type:"default"}},methods:{add(){this.$emit("add")}},emits:["add"]};const Mi=(0,j.A)(Ei,[["render",Ai],["__scopeId","data-v-62479282"]]);var xi=Mi;const $i={class:"block-slot"};function Pi(e,t,s,i,a,l){const r=(0,o.g2)("b-spinner"),d=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",$i,[a.isLoading?((0,o.uX)(),(0,o.Wv)(r,{key:0,variant:"primary",size:"sm"})):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[s.isLock?s.isManualLocked?((0,o.uX)(),(0,o.Wv)(d,{key:1,icon:"fa-solid fa-lock",onClick:l.unlock,class:(0,n.C4)(["icon",{disabled:s.isDisabled}])},null,8,["onClick","class"])):s.isSystemLocked?((0,o.uX)(),(0,o.Wv)(d,{key:2,icon:"fa-solid fa-lock",class:"icon system-locked"})):(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(d,{key:0,icon:"fa-solid fa-unlock",onClick:l.lock,class:(0,n.C4)(["icon",{disabled:s.isDisabled}])},null,8,["onClick","class"]))],64))])}var Yi={name:"BookingBlockSlot",props:{isLock:{type:Boolean,default:!1},start:{type:String,default:"08:00"},end:{type:String,default:"08:30"},date:{type:String,required:!0,validator:function(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}},shop:{type:Number,required:!0},isSystemLocked:{type:Boolean,default:!1},isManualLocked:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},assistantId:{type:Number,default:null}},data(){return{isLoading:!1}},computed:{holidayRule(){const e={from_date:this.date,to_date:this.date,from_time:this.normalizeTime(this.start),to_time:this.normalizeTime(this.end),daily:!0};return null!=this.assistantId&&(e.assistant_id=this.assistantId),e}},methods:{lock(){this.isLoading||this.isDisabled||(this.isLoading=!0,this.$emit("lock-start",this.holidayRule),this.$emit("lock",this.holidayRule),setTimeout(()=>{this.$emit("lock-end",this.holidayRule),this.isLoading=!1},300))},unlock(){this.isLoading||this.isDisabled||(this.isLoading=!0,this.$emit("unlock-start",this.holidayRule),this.$emit("unlock",this.holidayRule),setTimeout(()=>{this.$emit("unlock-end",this.holidayRule),this.isLoading=!1},300))},normalizeTime(e){return this.moment(e,this.getTimeFormat()).format("HH:mm")}},emits:["lock","unlock","lock-start","unlock-start","lock-end","unlock-end"]};const Vi=(0,j.A)(Yi,[["render",Pi],["__scopeId","data-v-2f1f8a82"]]);var Xi=Vi,ji={name:"SlotActions",components:{BookingAdd:xi,BookingBlockSlot:Xi},props:{shop:{default:()=>({})},index:{type:Number,required:!0},timeSlot:{type:String,required:!0},timeslots:{type:Array,required:!0},isLocked:{type:Function,required:!0},isAvailable:{type:Function,required:!0},hasOverlapping:{type:Function,required:!0},date:{type:Date,required:!0},assistantId:{type:Number,default:null},isSystemLocked:{type:Function,required:!0},isManualLocked:{type:Function,required:!0},isDisabled:{type:Boolean,default:!1}},methods:{getNextSlot(){return this.timeslots[this.index+1]||null},getFormattedDate(){return this.dateFormat(this.date,"YYYY-MM-DD")},handleLockStart(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!0})},handleLockEnd(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!1})},handleUnlockStart(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!0}),this.$emit("unlock-start")},handleUnlockEnd(){this.$emit("update-processing",{slot:`${this.timeSlot}-${this.getNextSlot()}`,status:!1}),this.$emit("unlock-end")}},emits:["add","lock","unlock","lock-start","lock-end","unlock-start","unlock-end","update-processing"]};const Wi=(0,j.A)(ji,[["render",Ti],["__scopeId","data-v-5b07e2cf"]]);var Hi=Wi;const Bi={class:"slots-headline"},Ni={class:"selected-date"},Oi={key:0,class:"attendant-toggle"};function Ui(e,t,s,i,a,l){const r=(0,o.g2)("b-form-checkbox");return(0,o.uX)(),(0,o.CE)("div",Bi,[(0,o.Lk)("div",Ni,(0,n.v_)(l.formattedDate),1),s.settings?.attendant_enabled&&s.attendants.length>0?((0,o.uX)(),(0,o.CE)("div",Oi,[(0,o.eW)((0,n.v_)(this.getLabel("attendantViewLabel"))+" ",1),(0,o.bF)(r,{modelValue:l.isAttendantViewLocal,"onUpdate:modelValue":t[0]||(t[0]=e=>l.isAttendantViewLocal=e),switch:"",size:"lg"},null,8,["modelValue"])])):(0,o.Q3)("",!0)])}var qi={name:"SlotsHeadline",props:{date:{type:Date,required:!0},settings:{type:Object,default:()=>({})},attendants:{type:Array,default:()=>[]},isAttendantView:{type:Boolean,default:!1}},emits:["update:isAttendantView"],computed:{formattedDate(){return this.moment(this.date).format("dddd DD YYYY")},isAttendantViewLocal:{get(){return this.isAttendantView},set(e){this.$emit("update:isAttendantView",e)}}},methods:{getLabel(e){return this.$parent.getLabel?.(e)||e}}};const Ri=(0,j.A)(qi,[["render",Ui],["__scopeId","data-v-4eebeb9c"]]);var zi=Ri;const Qi={class:"search"};function Ki(e,t,s,i,a,n){const l=(0,o.g2)("font-awesome-icon"),r=(0,o.g2)("b-form-input");return(0,o.uX)(),(0,o.CE)("div",Qi,[(0,o.bF)(l,{icon:"fa-solid fa-magnifying-glass",class:"search-icon"}),(0,o.bF)(r,{modelValue:a.searchValue,"onUpdate:modelValue":t[0]||(t[0]=e=>a.searchValue=e),class:"search-input",onInput:n.handleInput},null,8,["modelValue","onInput"]),a.searchValue?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"fa-solid fa-circle-xmark",class:"clear",onClick:n.clearSearch},null,8,["onClick"])):(0,o.Q3)("",!0)])}function Gi(e,t=300){let s=null;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>{e(...i)},t)}}var Ji={name:"SearchInput",props:{modelValue:{type:String,default:""},debounceTime:{type:Number,default:600}},data(){return{searchValue:this.modelValue}},watch:{modelValue(e){this.searchValue=e}},created(){this.debouncedEmit=Gi(e=>{this.$emit("update:modelValue",e),this.$emit("search",e)},this.debounceTime)},methods:{handleInput(e){this.debouncedEmit(e)},clearSearch(){this.searchValue="",this.$emit("update:modelValue",""),this.$emit("search","")}}};const Zi=(0,j.A)(Ji,[["render",Ki],["__scopeId","data-v-5ef7fdca"]]);var eo=Zi;const to={class:"calendar"},so={key:0,class:"day day-with-bookings"},io={key:1,class:"day day-full-booked"},oo={key:2,class:"day day-available-book"},ao={key:3,class:"day day-holiday"},no={key:4,class:"day day-disable-book"},lo={key:0,class:"spinner-wrapper"};function ro(e,t,s,i,a,l){const r=(0,o.g2)("Datepicker"),d=(0,o.g2)("b-spinner");return(0,o.uX)(),(0,o.CE)("div",to,[(0,o.bF)(r,{modelValue:l.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedDate=e),inline:"",autoApply:"",noSwipe:"",enableTimePicker:!1,monthChangeOnScroll:!1,onUpdateMonthYear:l.handleMonthYear},{day:(0,o.k6)(({day:e,date:t})=>[l.isDayWithBookings(t)?((0,o.uX)(),(0,o.CE)("div",so,(0,n.v_)(e),1)):l.isDayFullBooked(t)?((0,o.uX)(),(0,o.CE)("div",io,(0,n.v_)(e),1)):l.isAvailableBookings(t)?((0,o.uX)(),(0,o.CE)("div",oo,(0,n.v_)(e),1)):l.isHoliday(t)?((0,o.uX)(),(0,o.CE)("div",ao,(0,n.v_)(e),1)):((0,o.uX)(),(0,o.CE)("div",no,(0,n.v_)(e),1))]),_:1},8,["modelValue","onUpdateMonthYear"]),s.isLoading?((0,o.uX)(),(0,o.CE)("div",lo)):(0,o.Q3)("",!0),s.isLoading?((0,o.uX)(),(0,o.Wv)(d,{key:1,variant:"primary"})):(0,o.Q3)("",!0)])}var uo={name:"BookingCalendar",props:{modelValue:{type:Date,required:!0},availabilityStats:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["update:modelValue","month-year-update"],computed:{selectedDate:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>{const e=document.querySelector(".dp__calendar"),t=document.querySelector(".spinner-wrapper"),s=document.querySelector(".calendar .spinner-border");e&&t&&s&&(e.appendChild(t),e.appendChild(s))})},methods:{handleMonthYear({year:e,month:t}){this.$emit("month-year-update",{year:e,month:t})},isDayWithBookings(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.data?.bookings>0)},isAvailableBookings(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.available&&!t.full_booked)},isDayFullBooked(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&t.full_booked)},isHoliday(e){return this.availabilityStats.some(t=>t.date===this.dateFormat(e,"YYYY-MM-DD")&&"holiday_rules"===t.error?.type)}}};const co=(0,j.A)(uo,[["render",ro],["__scopeId","data-v-bb3c067c"]]);var ho=co;const mo={class:"booking-wrapper"},po={class:"booking"},go={class:"customer-info"},fo={class:"customer-info-header"},ko={class:"booking-id"},vo={class:"services-list"},bo={class:"service-name"},_o={class:"assistant-name"},yo={class:"booking-actions-bottom"},Lo={class:"booking-status"},Co={class:"status-label"};function So(e,t,s,a,l,r){const d=(0,o.g2)("CustomerActionsMenu");return(0,o.uX)(),(0,o.CE)("div",mo,[(0,o.Lk)("div",po,[(0,o.Lk)("div",go,[(0,o.Lk)("div",fo,[(0,o.Lk)("span",{class:"customer-name",onClick:t[0]||(t[0]=(...e)=>r.showDetails&&r.showDetails(...e))},(0,n.v_)(r.customer),1),(0,o.Lk)("span",ko,(0,n.v_)(r.id),1)])]),(0,o.Lk)("div",vo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.booking.services,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"service-item",key:t},[(0,o.Lk)("span",bo,(0,n.v_)(e.service_name),1),(0,o.Lk)("span",_o,(0,n.v_)(e.assistant_name),1)]))),128))]),(0,o.Lk)("div",yo,[(0,o.Lk)("button",{class:"booking-actions-menu-dots",onClick:t[1]||(t[1]=(0,i.D$)((...e)=>r.toggleActionsMenu&&r.toggleActionsMenu(...e),["stop"]))},"  ")]),(0,o.Lk)("div",Lo,[(0,o.Lk)("span",Co,(0,n.v_)(r.statusLabel),1)])]),(0,o.bF)(d,{booking:s.booking,show:l.showActionsMenu,onClose:t[2]||(t[2]=e=>l.showActionsMenu=!1),onEdit:r.onEdit,onDelete:r.onDelete,onViewProfile:r.onViewProfile},null,8,["booking","show","onEdit","onDelete","onViewProfile"])])}const wo=e=>((0,o.Qi)("data-v-cfcf264a"),e=e(),(0,o.jt)(),e),Fo={key:0,class:"modal-root"},Do={class:"modal-container"},To={class:"modal-content"},Io=wo(()=>(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,o.Lk)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})])],-1)),Ao={class:"modal-text"},Eo=wo(()=>(0,o.Lk)("div",{class:"modal-divider"},null,-1)),Mo=wo(()=>(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[(0,o.Lk)("path",{fill:"#fff",d:"M135.2 17.7C140.6 6.8 151.7 0 163.8 0L284.2 0c12.1 0 23.2 6.8 28.6 17.7L320 32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 96C14.3 96 0 81.7 0 64S14.3 32 32 32l96 0 7.2-14.3zM32 128l384 0 0 320c0 35.3-28.7 64-64 64L96 512c-35.3 0-64-28.7-64-64l0-320zm96 64c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16z"})])],-1)),xo={class:"modal-text"},$o=wo(()=>(0,o.Lk)("div",{class:"modal-divider"},null,-1)),Po=wo(()=>(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[(0,o.Lk)("path",{fill:"#fff",d:"M497.4 361.8l-112-48a24 24 0 0 0 -28 6.9l-49.6 60.6A370.7 370.7 0 0 1 130.6 204.1l60.6-49.6a23.9 23.9 0 0 0 6.9-28l-48-112A24.2 24.2 0 0 0 122.6 .6l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.3 24.3 0 0 0 -14-27.6z"})])],-1)),Yo={class:"modal-text"},Vo={key:1,class:"modal-divider"},Xo=wo(()=>(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"31.5",height:"31.5",viewBox:"52.15 351.25 31.5 31.5"},[(0,o.Lk)("path",{d:"M78.932 355.827a15.492 15.492 0 0 0-11.04-4.577c-8.605 0-15.609 7.003-15.609 15.61 0 2.749.718 5.435 2.082 7.804l-2.215 8.086 8.276-2.173a15.562 15.562 0 0 0 7.46 1.899h.007c8.6 0 15.757-7.003 15.757-15.61 0-4.17-1.772-8.086-4.718-11.039Zm-11.04 24.02c-2.334 0-4.619-.627-6.609-1.808l-.47-.281-4.908 1.287 1.307-4.789-.309-.492a12.931 12.931 0 0 1-1.983-6.905c0-7.15 5.822-12.972 12.98-12.972 3.466 0 6.722 1.35 9.169 3.804 2.447 2.454 3.951 5.709 3.944 9.175 0 7.158-5.97 12.98-13.12 12.98Zm7.116-9.718c-.386-.197-2.306-1.14-2.664-1.266-.359-.133-.62-.197-.88.197s-1.005 1.266-1.237 1.533c-.225.26-.457.295-.844.098-2.292-1.146-3.796-2.046-5.308-4.64-.4-.69.4-.64 1.146-2.13.127-.26.063-.486-.035-.683-.099-.197-.88-2.116-1.203-2.897-.316-.759-.64-.654-.878-.668-.225-.014-.486-.014-.746-.014s-.682.099-1.04.486c-.359.393-1.364 1.335-1.364 3.255s1.399 3.776 1.589 4.036c.197.26 2.749 4.198 6.665 5.892 2.475 1.069 3.446 1.16 4.683.977.752-.112 2.306-.942 2.63-1.856.323-.914.323-1.694.225-1.856-.092-.176-.352-.274-.739-.464Z",fill:"#fff","fill-rule":"evenodd"})])],-1)),jo={class:"modal-text"},Wo={key:3,class:"modal-divider"},Ho=wo(()=>(0,o.Lk)("div",{class:"modal-icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user"},[(0,o.Lk)("path",{stroke:"#fff",d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,o.Lk)("circle",{stroke:"#fff",cx:"12",cy:"7",r:"4"})])],-1)),Bo={class:"modal-text"},No=wo(()=>(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},[(0,o.Lk)("line",{stroke:"#fff",x1:"18",y1:"6",x2:"6",y2:"18"}),(0,o.Lk)("line",{stroke:"#fff",x1:"6",y1:"6",x2:"18",y2:"18"})],-1)),Oo=[No];function Uo(e,t,s,i,a,l){return(0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[s.show?((0,o.uX)(),(0,o.CE)("div",Fo,[(0,o.Lk)("div",{class:"modal-backdrop",onClick:t[0]||(t[0]=(...e)=>l.close&&l.close(...e))}),(0,o.Lk)("div",Do,[(0,o.Lk)("div",To,[(0,o.Lk)("div",{class:"modal-item",onClick:t[1]||(t[1]=(...e)=>l.editBooking&&l.editBooking(...e))},[Io,(0,o.Lk)("div",Ao,(0,n.v_)(this.getLabel("bookingActionEdit")),1)]),Eo,(0,o.Lk)("div",{class:"modal-item",onClick:t[2]||(t[2]=(...e)=>l.deleteBooking&&l.deleteBooking(...e))},[Mo,(0,o.Lk)("div",xo,(0,n.v_)(this.getLabel("bookingActionDelete")),1)]),$o,l.hasPhone?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-item",onClick:t[3]||(t[3]=(...e)=>l.callCustomer&&l.callCustomer(...e))},[Po,(0,o.Lk)("div",Yo,(0,n.v_)(this.getLabel("bookingActionCallCustomer")),1)])):(0,o.Q3)("",!0),l.hasPhone?((0,o.uX)(),(0,o.CE)("div",Vo)):(0,o.Q3)("",!0),l.hasPhone?((0,o.uX)(),(0,o.CE)("div",{key:2,class:"modal-item",onClick:t[4]||(t[4]=(...e)=>l.whatsappCustomer&&l.whatsappCustomer(...e))},[Xo,(0,o.Lk)("div",jo,(0,n.v_)(this.getLabel("bookingActionWhatsappCustomer")),1)])):(0,o.Q3)("",!0),l.hasCustomer?((0,o.uX)(),(0,o.CE)("div",Wo)):(0,o.Q3)("",!0),l.hasCustomer?((0,o.uX)(),(0,o.CE)("div",{key:4,class:"modal-item",onClick:t[5]||(t[5]=(...e)=>l.openCustomerProfile&&l.openCustomerProfile(...e))},[Ho,(0,o.Lk)("div",Bo,(0,n.v_)(this.getLabel("bookingActionOpenProfile")),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:"modal-close",onClick:t[6]||(t[6]=(...e)=>l.close&&l.close(...e))},Oo)])])):(0,o.Q3)("",!0)])}var qo={name:"CustomerActionsMenu",props:{booking:{type:Object,required:!0},show:{type:Boolean,default:!1}},data(){return{originalOverflow:""}},computed:{customerPhone(){return this.booking?.customer_phone_country_code?this.booking.customer_phone_country_code+this.booking.customer_phone:this.booking?.customer_phone||""},hasPhone(){return!!this.customerPhone},hasCustomer(){return!!this.booking?.customer_id}},watch:{show(e){e?(this.originalOverflow=document.body.style.overflow,document.body.style.overflow="hidden"):document.body.style.overflow=this.originalOverflow}},methods:{close(){this.$emit("close")},editBooking(){this.$emit("edit",this.booking),this.close()},deleteBooking(){this.$emit("delete",this.booking.id),this.close()},callCustomer(){this.customerPhone&&window.open(`tel:${this.customerPhone}`,"_blank"),this.close()},whatsappCustomer(){if(this.customerPhone){const e=this.customerPhone.replace(/\D/g,"");window.open(`https://wa.me/${e}`,"_blank")}this.close()},openCustomerProfile(){this.hasCustomer&&this.$emit("view-profile",{id:this.booking.customer_id,first_name:this.booking.customer_first_name,last_name:this.booking.customer_last_name,email:this.booking.customer_email,phone:this.customerPhone,address:this.booking.customer_address,note:this.booking.customer_personal_note}),this.close()}},beforeUnmount(){this.show&&(document.body.style.overflow=this.originalOverflow)},emits:["close","edit","delete","view-profile"]};const Ro=(0,j.A)(qo,[["render",Uo],["__scopeId","data-v-cfcf264a"]]);var zo=Ro,Qo={name:"BookingCard",components:{CustomerActionsMenu:zo},props:{booking:{default:function(){return{}}}},data(){return{isDelete:!1,showActionsMenu:!1}},computed:{customer(){return`${this.booking.customer_first_name} ${this.booking.customer_last_name}`},id(){return this.booking.id},assistants(){return(this.booking.services||[]).map(e=>({id:e.assistant_id,name:e.assistant_name})).filter(e=>+e.id)},statusLabel(){const e=this.booking.status;return this.$root.statusesList&&this.$root.statusesList[e]?this.$root.statusesList[e].label:e}},methods:{toggleActionsMenu(){this.showActionsMenu=!this.showActionsMenu},onEdit(){this.$emit("showDetails",this.booking),this.$emit("edit",this.booking)},onDelete(){this.$emit("deleteItem",this.booking.id)},onViewProfile(e){this.$emit("viewCustomerProfile",e)},showDetails(){this.$emit("showDetails",this.booking)},getLabel(e){return this.$root.labels?this.$root.labels[e]:e}},emits:["deleteItem","showDetails","edit","viewCustomerProfile"]};const Ko=(0,j.A)(Qo,[["render",So],["__scopeId","data-v-56e90298"]]);var Go=Ko;const Jo={class:"attendant-time-slots"},Zo={class:"time-slot-lines"},ea=["data-id"],ta=["onClick"],sa={key:0,class:"slot-processing-spinner"},ia={key:0,class:"slot-actions slot-actions--locked"},oa=["onClick"],aa={key:1,class:"slot-actions"},na=["onClick"],la=["onClick"];function ra(e,t,s,a,l,r){const d=(0,o.g2)("b-spinner"),u=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",Jo,[(0,o.Lk)("div",Zo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"time-slot-line",style:(0,n.Tr)(r.getTimeSlotLineStyle(t+1))},null,4))),128))]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.sortedAttendants,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"attendant-column",style:(0,n.Tr)(r.getAttendantColumnStyle(e))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeslots,(t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:`${e.id}-${t}`,class:"time-slot","data-id":`${e.id}-${t}`,style:(0,n.Tr)(r.getTimeSlotStyle(s))},[(0,o.Lk)("div",{class:(0,n.C4)(["time-slot-inner",{"time-slot-inner--locked":r.isSlotLockedForAttendant(t,r.getNextTimeslot(s),e.id),"time-slot-inner--selected":r.isSelectedSlot(t,e.id),"time-slot-inner--active":l.activeSlot===`${e.id}-${t}`,"time-slot-inner--processing":r.isSlotProcessing(t,r.getNextTimeslot(s),e.id)}]),onClick:i=>r.handleSlotClick(t,e,s)},[r.isSlotProcessing(t,r.getNextTimeslot(s),e.id)?((0,o.uX)(),(0,o.CE)("div",sa,[(0,o.bF)(d,{variant:"warning",small:"",label:"Processing..."})])):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[r.isSlotLockedForAttendant(t,r.getNextTimeslot(s),e.id)?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[r.isSlotCenterOfLock(t,e.id)&&r.isSlotManuallyLockable(t,e.id)?((0,o.uX)(),(0,o.CE)("div",ia,[(0,o.Lk)("button",{onClick:(0,i.D$)(i=>r.unlockSlot(t,e,s),["stop"]),class:"unlock-button"},[(0,o.bF)(u,{icon:"fa-solid fa-lock"})],8,oa)])):(0,o.Q3)("",!0)],64)):((0,o.uX)(),(0,o.CE)("div",aa,[(0,o.Lk)("button",{onClick:(0,i.D$)(s=>r.addBooking(t,e),["stop"]),class:"add-button"},[(0,o.bF)(u,{icon:"fa-solid fa-circle-plus"})],8,na),(0,o.Lk)("button",{onClick:(0,i.D$)(i=>r.lockSlot(t,e,s),["stop"]),class:"lock-button"},[(0,o.bF)(u,{icon:"fa-solid fa-unlock"})],8,la)]))],64))],10,ta)],12,ea))),128))],4))),128))])}s(178);var da={name:"AttendantTimeSlots",data(){return{processingSlots:new Set,activeSlot:null,timeCache:new Map}},props:{date:{type:Date,required:!0,validator:function(e){return e instanceof Date&&!isNaN(e)}},shop:{default:function(){return{}}},sortedAttendants:{type:Array,required:!0},timeslots:{type:Array,required:!0},columnWidths:{type:Object,required:!0},slotHeight:{type:Number,default:110},selectedSlots:{type:Array,default:()=>[]},lockedTimeslots:{type:Array,default:()=>[]},processedBookings:{type:Array,default:()=>[]},availabilityIntervals:{type:Object,default:()=>({})}},watch:{attendantsLoaded(e){e&&this.loadLockedTimeslots()},lockedTimeslots:{immediate:!0}},methods:{getFormattedDate(e=this.date){return this.dateFormat(e,"YYYY-MM-DD")},getTimeInMinutes(e){if(!e)return 0;if(this.timeCache.has(e))return this.timeCache.get(e);const t=this.normalizeTime(e),s=this.timeToMinutes(t);return this.timeCache.set(e,s),s},isInHolidayPeriod(e,t,s,i){return!(!e||!e.length)&&e.some(e=>{const o=this.moment(e.from_date,"YYYY-MM-DD").startOf("day"),a=this.moment(e.to_date,"YYYY-MM-DD").startOf("day"),n=this.moment(t,"YYYY-MM-DD").startOf("day");return n.isBetween(o,a,"day","[]")&&this.doTimeslotsOverlap(s,i,e.from_time,e.to_time)})},isTimeInShifts(e,t){return e.some(e=>{if(!e.from||!e.to||e.disabled)return!1;const s=this.getTimeInMinutes(e.from),i=this.getTimeInMinutes(e.to);return t>=s&&t<i})},isTimeInFromToFormat(e,t,s){const i=e[0]&&t[0]&&this.getTimeInMinutes(e[0])<=s&&this.getTimeInMinutes(t[0])>s,o=e[1]&&t[1]&&this.getTimeInMinutes(e[1])<=s&&this.getTimeInMinutes(t[1])>s;return i||o},isTimeInAvailability(e,t,s){return!(!e.days||1!==e.days[s])&&(e.shifts&&e.shifts.length>0?this.isTimeInShifts(e.shifts,t):Array.isArray(e.from)&&Array.isArray(e.to)?this.isTimeInFromToFormat(e.from,e.to,t):!!e.always)},isBlockedByHolidayRule(e,t,s,i){if(null!==t&&e.assistant_id!==t||null===t&&null!==e.assistant_id)return!1;const o=this.moment(e.from_date,"YYYY-MM-DD"),a=this.moment(e.to_date,"YYYY-MM-DD"),n=s.isBetween(o,a,"day","[]");if(!n)return!1;const l=this.getTimeInMinutes(e.from_time),r=this.getTimeInMinutes(e.to_time);return s.isSame(o,"day")&&s.isSame(a,"day")?i>=l&&i<r:s.isSame(o,"day")?i>=l:!s.isSame(a,"day")||i<r},hasWorkingDay(e,t){return e.some(e=>e.days&&1===e.days[t])},async updateLockedTimeslots(e=this.date){const t=this.getFormattedDate(e);try{const e=await this.axios.get("holiday-rules",{params:{assistants_mode:!0,date:t}});if(e.data?.assistants_rules){const t=e.data.assistants_rules,s=Object.entries(t).flatMap(([e,t])=>t.map(t=>({...t,assistant_id:Number(e)||null,is_manual:!1!==t.is_manual})));this.$emit("update:lockedTimeslots",s),this.sortedAttendants.forEach(e=>{const t=s.filter(t=>t.assistant_id===e.id);if(e.holidays=t.map(e=>({from_date:e.from_date,to_date:e.to_date,from_time:e.from_time,to_time:e.to_time,is_manual:!1!==e.is_manual})),this.shop?.id){const s=e.shops?.find(e=>e.id===this.shop.id);s&&(s.holidays=t.map(e=>({from_date:e.from_date,to_date:e.to_date,from_time:e.from_time,to_time:e.to_time})))}})}return e}catch(s){throw console.error("Error updating locked timeslots:",s),s}},isSlotManuallyLockable(e,t){const s=this.getFormattedDate(),i=this.getTimeInMinutes(e),o=this.lockedTimeslots.find(e=>{const o=e.assistant_id===t&&e.from_date===s&&i>=this.getTimeInMinutes(e.from_time)&&i<this.getTimeInMinutes(e.to_time);return o});return!!o?.is_manual},async lockSlot(e,t,s){const i=this.getNextTimeslot(s),o=this.getSlotKey(e,i,t.id);if(!this.processingSlots.has(o)){this.processingSlots.add(o);try{const s=this.getFormattedDate(),o=this.normalizeTime(e);let a;a=i?this.normalizeTime(i):this.moment(o,"HH:mm").add(30,"minutes").format("HH:mm");const n={assistants_mode:!0,assistant_id:t.id||null,date:s,from_date:s,to_date:s,from_time:o,to_time:a,daily:!0,shop:this.shop?.id||null};await this.axios.post("holiday-rules",n),await this.updateLockedTimeslots(),this.$emit("lock",n)}catch(a){console.error("Slot lock error:",a)}finally{this.processingSlots.delete(o)}}},async unlockSlot(e,t,s){const i=this.getNextTimeslot(s),o=this.getSlotKey(e,i,t.id);if(!this.processingSlots.has(o)){this.processingSlots.add(o);try{const s=this.getFormattedDate(),i=this.getTimeInMinutes(e),a=this.lockedTimeslots.find(e=>{const o=e.assistant_id===t.id,a=e.from_date===s,n=this.getTimeInMinutes(e.from_time),l=this.getTimeInMinutes(e.to_time);return o&&a&&i>=n&&i<l});if(!a)return void this.processingSlots.delete(o);const n={assistants_mode:!0,assistant_id:t.id,from_date:s,to_date:s,from_time:this.normalizeTime(a.from_time),to_time:this.normalizeTime(a.to_time),daily:!0,shop:this.shop?.id||0};await this.axios.delete("holiday-rules",{data:n}),await this.updateLockedTimeslots(),this.$emit("unlock",n)}catch(a){console.error("Slot unlock error:",a)}finally{this.processingSlots.delete(o)}}},handleSlotClick(e,t,s){const i=this.isSlotLockedForAttendant(e,this.getNextTimeslot(s),t.id),o=this.lockedTimeslots.some(s=>s.assistant_id===t.id&&s.from_date===this.getFormattedDate()&&this.getTimeInMinutes(e)>=this.getTimeInMinutes(s.from_time)&&this.getTimeInMinutes(e)<this.getTimeInMinutes(s.to_time));if(i&&!o)return;const a=`${t.id}-${e}`;if(this.activeSlot){const e=document.querySelector(`.time-slot[data-id="${this.activeSlot}"]`);e&&e.classList.remove("time-slot--active")}this.activeSlot=this.activeSlot===a?null:a,this.$nextTick(()=>{if(this.activeSlot){const e=document.querySelector(`.time-slot[data-id="${a}"]`);e&&e.classList.add("time-slot--active")}})},getAttendantColumnStyle(e){const t=this.columnWidths[e.id]||245,s=this.getAssistantColumnLeft(this.sortedAttendants.findIndex(t=>t.id===e.id));return{position:"absolute",width:`${t}px`,left:`${s}px`,height:"100%",background:"rgba(171, 180, 187, .33)",borderRadius:"8px",zIndex:10}},getTimeSlotStyle(e){return{position:"absolute",top:e*this.slotHeight+"px",left:0,right:0,height:`${this.slotHeight}px`}},getAssistantColumnLeft(e){return this.sortedAttendants.slice(0,e).reduce((e,t)=>{const s=this.columnWidths[t.id]||245;return e+s+8},0)},doTimeslotsOverlap(e,t,s,i){const o=this.getTimeInMinutes(e),a=t?this.getTimeInMinutes(t):o+30,n=this.getTimeInMinutes(s),l=this.getTimeInMinutes(i);return o<l&&a>n},isSlotCenterOfLock(e,t){const s=this.getFormattedDate(),i=this.lockedTimeslots.filter(e=>{const i=e.assistant_id===t||null===e.assistant_id,o=e.from_date===s;return i&&o});if(0===i.length||i.every(e=>null===e.assistant_id))return!1;const o=this.getTimeInMinutes(e),a=i.find(e=>{const t=this.getTimeInMinutes(e.from_time),s=this.getTimeInMinutes(e.to_time);return o>=t&&o<s});if(!a?.is_manual)return!1;const n=this.getTimeInMinutes(a.from_time),l=this.getTimeInMinutes(a.to_time),r=this.timeslots.filter(e=>{const t=this.getTimeInMinutes(e);return t>=n&&t<l}),d=Math.floor(r.length/2),u=r[d];return this.normalizeTime(e)===this.normalizeTime(u)},timeToMinutes(e){if(!e)return 0;if("h:iip"===this.$root.settings.time_format.js_format){const t=this.moment(e,"h:mm A"),[s,i]=[t.hours(),t.minutes()];return 60*s+i}const[t,s]=e.split(":").map(Number);return 60*t+s},isSelectedSlot(e,t){return this.selectedSlots.some(s=>s.timeslot===e&&s.attendantId===t)},addBooking(e,t){this.$emit("add",{timeslot:e,attendantId:t.id})},isSlotProcessing(e,t,s){return this.processingSlots.has(this.getSlotKey(e,t,s))},getNextTimeslot(e){return e+1<this.timeslots.length?this.timeslots[e+1]:null},getSlotKey(e,t,s){return`${s}-${e}-${t}`},isTimeSlotAllowedByRule(e,t,s){if(e.select_specific_dates&&e.specific_dates){const i=e.specific_dates.split(","),o=this.getFormattedDate(s);return!!i.includes(o)&&(Array.isArray(e.from)&&Array.isArray(e.to)&&e.from.length>0&&e.to.length>0?Object.keys(e.from).some(s=>{if(s>0&&e.disable_second_shift)return!1;const i=this.getTimeInMinutes(e.from[s]),o=this.getTimeInMinutes(e.to[s]);return t>=i&&t<o}):!!e.always)}if(!e.always&&(e.from_date||e.to_date)){const t=e.from_date?this.moment(e.from_date,"YYYY-MM-DD"):null,i=e.to_date?this.moment(e.to_date,"YYYY-MM-DD"):null;if(t&&s.isBefore(t,"day"))return!1;if(i&&s.isAfter(i,"day"))return!1}return e.shifts&&e.shifts.length?this.isTimeInShifts(e.shifts,t):Array.isArray(e.from)&&Array.isArray(e.to)?!(!e.days||1!==e.days[s.isoWeekday()])&&Object.keys(e.from).some(s=>{if(s>0&&e.disable_second_shift)return!1;const i=this.getTimeInMinutes(e.from[s]),o=this.getTimeInMinutes(e.to[s]);return t>=i&&t<o}):!(!e.always||!e.days||1!==e.days[s.isoWeekday()])},isSlotLockedForAttendant(e,t,s){try{if(!e)return!0;const t=this.getFormattedDate(),i=this.moment(t,"YYYY-MM-DD"),o=i.day()+1,a=this.sortedAttendants.find(e=>e.id===s);if(!a)return!0;const n=this.getTimeInMinutes(e),l=this.$root.settings?.available_days||{};if("1"!==l[o])return!0;const r=this.lockedTimeslots.find(e=>e.assistant_id===s&&this.isBlockedByHolidayRule(e,s,i,n));if(r)return!0;const d=this.$root.settings?.holidays?.some(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),s=this.moment(e.to_date,"YYYY-MM-DD");if(!i.isBetween(t,s,"day","[]"))return!1;if(i.isSame(t,"day")&&i.isSame(s,"day")){const t=this.getTimeInMinutes(e.from_time),s=this.getTimeInMinutes(e.to_time);return n>=t&&n<s}return i.isSame(t,"day")?n>=this.getTimeInMinutes(e.from_time):!i.isSame(s,"day")||n<this.getTimeInMinutes(e.to_time)});if(d)return!0;if(a.availabilities?.length){const e=a.availabilities.some(e=>this.isTimeSlotAllowedByRule(e,n,i));return!e}const u=this.$root.settings?.availabilities||[];if(!u.length)return!0;{const e=u.filter(e=>"1"===e.days?.[o]);if(0===e.length)return!0;const t=e.some(e=>e.shifts?.length?this.isTimeInShifts(e.shifts,n):Array.isArray(e.from)&&Array.isArray(e.to)?this.isTimeInFromToFormat(e.from,e.to,n):!!e.always);if(!t)return!0}const c=this.availabilityIntervals?.workTimes||{},h=this.availabilityIntervals?.times||{},m=Object.keys(c).length?c:h;if(Object.keys(m).length){const e=Object.values(m).some(e=>this.getTimeInMinutes(e)===n);if(!e)return!0}return!1}catch(i){return console.error("Error in isSlotLockedForAttendant:",i),!0}},getAssistantShopData(e,t,s){if(!e||!e.shops||!t)return null;const i=e.shops.find(e=>e.id===t);return i?.[s]||null},normalizeTime(e){if(!e)return e;if("h:iip"===this.$root.settings?.time_format?.js_format){const t=this.moment(e,"h:mm A");return t.format("HH:mm")}const t=this.getTimeFormat();return this.moment(e,t).format("HH:mm")},getTimeSlotLineStyle(e){const t=e*this.slotHeight;return{position:"absolute",left:0,right:0,top:`${t}px`,height:"1px",backgroundColor:"#ddd",zIndex:1}}},emits:["add","update:lockedTimeslots","slot-processing","lock","unlock"]};const ua=(0,j.A)(da,[["render",ra],["__scopeId","data-v-6694ce0e"]]);var ca=ua,ha={name:"ReservationsCalendar",mixins:[xe],components:{TimeAxis:hi,AttendantsList:_i,TimeSlots:Fi,SlotActions:Hi,SlotsHeadline:zi,SearchInput:eo,BookingCalendar:ho,BookingCard:Go,AttendantTimeSlots:ca},props:{modelValue:{type:Date,default:()=>new Date},shop:{default:function(){return{}}}},data(){return{timeslots:[],lockedTimeslots:[],availabilityStats:[],bookingsList:[],availabilityIntervals:{},search:"",activeSlotIndex:-1,currentTimeLinePosition:0,showCurrentTimeLine:!0,isLoadingTimeslots:!1,isLoadingCalendar:!1,isLoading:!1,loadingQueue:[],slotHeight:110,cardWidth:245,gap:0,isDragging:!1,wasRecentlyDragging:!1,possibleDrag:!1,startX:0,startY:0,scrollLeft:0,intervalId:null,isAttendantView:"true"===localStorage.getItem("isAttendantView")||!1,attendantColumnWidth:245,attendantColumnGap:8,attendants:[],attendantsLoaded:!1,timeFormatNew:"simple",slotProcessingStates:new Map,slotProcessing:{},selectedTimeSlots:[]}},computed:{dragHandlers(){return{mousedown:this.onMouseDown,mousemove:this.onMouseMove,mouseup:this.onMouseUp,mouseleave:this.onMouseLeave,touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd}},date:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},canvasWidth(){return this.$refs.dragScrollContainer?.clientWidth??500},canvasHeight(){return this.timeslots.length*this.slotHeight},canvasStyle(){if(this.isAttendantView){const e=this.sortedAttendants.reduce((e,t,s)=>{const i=this.columnWidths?.[t.id]??this.attendantColumnWidth,o=s<this.sortedAttendants.length-1?this.attendantColumnGap:0;return e+i+o},0);return{height:`${this.canvasHeight}px`,width:`${e}px`,minWidth:`${e}px`}}const e=Math.max(this.bookingsList.length*(this.cardWidth+this.gap),this.canvasWidth);return{height:`${this.canvasHeight}px`,width:`${e}px`,minWidth:"calc(100% + 245px)"}},processedBookings(){return this.isAttendantView?this.bookingsList.flatMap(e=>{if(!e.services||0===e.services.length)return[{...e,_serviceTime:{start:e.time,end:this.calculateEndTime(e.time,this.getDefaultDuration(e))},_assistantId:0,_isDefaultDuration:!0}];const t=e.services.reduce((e,t)=>{const s=t.assistant_id||0;return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.entries(t).map(([t,s])=>{const i=[...s].sort((t,s)=>{const i=this.getMinutes(t.start_at||e.time),o=this.getMinutes(s.start_at||e.time);return i-o}),o=i[0],a=i[i.length-1];return{...e,services:i,_serviceTime:{start:o.start_at||e.time,end:a.end_at||this.calculateEndTime(a.start_at||e.time,this.getDefaultDuration(e))},_assistantId:parseInt(t),_isDefaultDuration:!a.end_at}})}):[...this.bookingsList]},sortedAttendants(){if(!Array.isArray(this.attendants)||0===this.attendants.length)return[];const e=new Map;return this.bookingsList.forEach(t=>{t.services&&t.services.forEach(s=>{s.assistant_id&&(e.has(s.assistant_id)||e.set(s.assistant_id,[]),e.get(s.assistant_id).push(t))})}),[...this.attendants].sort((t,s)=>{const i=e.has(t.id),o=e.has(s.id);return i&&!o?-1:!i&&o?1:i&&o?e.get(s.id).length-e.get(t.id).length:t.name.localeCompare(s.name)})},shouldShowAttendants(){return this.isAttendantView&&this.attendants&&this.attendants.length>0},columnWidths(){if(!this.isAttendantView)return{};const e={};return this.sortedAttendants.forEach(t=>{const s=new Map,i=this.processedBookings.filter(e=>e._assistantId===t.id);i.forEach(e=>{if(!e._serviceTime)return;const t=this.getMinutes(e._serviceTime.start),i=this.getMinutes(e._serviceTime.end)-t,o=this.getDisplayDuration(e,i),a=t+o;for(let n=t;n<a;n++){const e=s.get(n)||0;s.set(n,e+1)}});const o=s.size>0?Math.max(...s.values()):1;e[t.id]=this.cardWidth*o+this.attendantColumnGap*(o-1)}),e},isReadyToRender(){if(this.bookingsList.length>0&&this.timeslots.length>0&&this.availabilityIntervals.length>0&&this.bookingsList.forEach(e=>{let t=e.time;!this.timeslots.includes(t)&&t<this.timeslots[0]&&this.timeslots.unshift(t)}),this.isAttendantView){if(!this.attendantsLoaded)return!1;if(0===this.attendants.length)return!1;if(!this.availabilityIntervals||0===Object.keys(this.availabilityIntervals).length)return!1}return!this.isLoadingTimeslots&&this.attendantsLoaded&&this.timeslots.length>0},validatedHolidayRule(){return e=>!(!e||"object"!==typeof e)&&(!(!e.from_date||!e.to_date)&&(!(!e.from_time||!e.to_time)&&(this.moment(e.from_date,"YYYY-MM-DD").isValid()&&this.moment(e.to_date,"YYYY-MM-DD").isValid()&&/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e.from_time)&&/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e.to_time))))}},watch:{shop:{handler(e,t){e?.id!==t?.id&&(this.activeSlotIndex=-1,this.loadAllData())},deep:!0},bookingsList(){this.arrangeBookings(),this.$nextTick(()=>{this.$forceUpdate()})},attendantsLoaded(e){e&&this.$nextTick(()=>{this.$forceUpdate()})},"$root.settings":{handler(e){e?.attendant_enabled?this.loadAttendants():(this.attendantsLoaded=!0,this.isAttendantView=!1),this.timeFormatNew="H:iip"===e?.time_format.js_format?"am":"simple",this.dateFormat=e?.date_format||"YYYY-MM-DD"},deep:!0},isAttendantView(e){localStorage.setItem("isAttendantView",e),this.loadAllData()},date(e,t){e.getTime()!==t?.getTime()&&this.loadAllData()}},mounted(){this.loadAllData(),setTimeout(()=>{const e=window.document.querySelectorAll(".dp__calendar");if(e[0]){const t=window.document.querySelectorAll(".spinner-wrapper")[0],s=window.document.querySelectorAll(".calendar .spinner-border")[0];t&&e[0].appendChild(t),s&&e[0].appendChild(s)}},0),setInterval(()=>this.update(),6e4),this.intervalId=setInterval(()=>{this.updateCurrentTimeLinePosition()},6e4),this.$nextTick(()=>{this.updateCurrentTimeLinePosition();const e=this.$refs.dragScrollContainer;e&&e.addEventListener("touchmove",this.onTouchMove,{passive:!1})}),this.$refs.slotsContainer&&this.$refs.slotsContainer.addEventListener("click",e=>{e.target===this.$refs.slotsContainer&&this.handleOutsideClick()})},beforeUnmount(){this.intervalId&&clearInterval(this.intervalId);const e=this.$refs.dragScrollContainer;e&&e.removeEventListener("touchmove",this.onTouchMove),this.$refs.slotsContainer&&this.$refs.slotsContainer.removeEventListener("click",this.handleOutsideClick)},methods:{loadAllData(){this.cancelPendingLoads(),this.isLoading=!0;const e=()=>this.shop?.id?this.axios.get("app/settings",{params:{shop:this.shop.id}}).then(e=>(e.data?.settings&&(this.$root.settings=e.data.settings),e)):this.axios.get("app/settings").then(e=>(e.data?.settings&&(this.$root.settings=e.data.settings),e));e().then(()=>this.loadTimeslots()).then(()=>{const e=[this.loadLockedTimeslots(),this.loadBookingsList(),this.loadAvailabilityIntervals()],t=this.date,s=t.getFullYear(),i=t.getMonth(),o=new Date(s,i,1),a=new Date(s,i+1,0);return e.push(this.loadAvailabilityStats(o,a)),this.isAttendantView&&this.$root.settings?.attendant_enabled&&!this.attendantsLoaded&&e.push(this.loadAttendants()),this.loadingQueue=e,Promise.all(e)}).then(()=>{this.$nextTick(()=>{this.arrangeBookings(),this.$forceUpdate()})}).catch(e=>{console.error("Error loading calendar data:",e)}).finally(()=>{this.isLoading=!1})},cancelPendingLoads(){this.loadingQueue=[]},async loadTimeslots(){return this.isLoadingTimeslots=!0,this.axios.get("calendar/intervals",{params:{shop:this.shop?.id||null}}).then(e=>(this.timeslots=e.data.items||[],this.updateCurrentTimeLinePosition(),e)).catch(e=>{throw console.error("Error loading timeslots:",e),e}).finally(()=>{this.isLoadingTimeslots=!1})},async loadLockedTimeslots(){try{const e=await this.axios.get("holiday-rules",{params:{assistants_mode:"false",date:this.moment(this.date).format("YYYY-MM-DD")}});let t=[];if("OK"===e.data?.status&&(t=e.data.items||[]),this.isAttendantView){const e=await this.axios.get("holiday-rules",{params:{assistants_mode:"true",date:this.moment(this.date).format("YYYY-MM-DD")}});if("OK"===e.data?.status){const s=e.data.assistants_rules||{},i=Object.entries(s).flatMap(([e,t])=>t.map(t=>({...t,assistant_id:Number(e)||null}))),o=t.map(e=>({...e,assistant_id:null}));this.lockedTimeslots=[...o,...i]}}else this.lockedTimeslots=t;return this.$nextTick(()=>{this.$forceUpdate()}),{data:{status:"OK"}}}catch(e){throw console.error("Error loading locked timeslots:",e.response?.data||e.message),e}},async loadBookingsList(){return this.axios.get("bookings",{params:{start_date:this.moment(this.date).format("YYYY-MM-DD"),end_date:this.moment(this.date).format("YYYY-MM-DD"),per_page:-1,statuses:["sln-b-pendingpayment","sln-b-pending","sln-b-paid","sln-b-paylater","sln-b-confirmed"],shop:this.shop?.id||null}}).then(e=>{const t=e.data.items||[],s=new Map(t.map(e=>[e.id,e]));return this.bookingsList=[],this.bookingsList=this.bookingsList.map(e=>s.has(e.id)?{...e,...s.get(e.id)}:e),t.forEach(e=>{this.bookingsList.some(t=>t.id===e.id)||this.bookingsList.push(e)}),e}).catch(e=>{throw console.error("Error loading bookings list:",e),e})},updateSlotProcessing({slot:e,status:t}){this.slotProcessing={...this.slotProcessing,[e]:t}},handleAttendantLock(e){console.log("Lock payload:",e)},handleAttendantUnlock(e){console.log("Unlock payload:",e)},async loadAvailabilityStats(e,t){this.isLoadingCalendar=!0;try{const s=await this.axios.get("availability/stats",{params:{from_date:this.moment(e).format("YYYY-MM-DD"),to_date:this.moment(t).format("YYYY-MM-DD"),shop:this.shop?.id||null}});return this.availabilityStats=s.data.stats,s}catch(s){throw console.error("Error loading availability stats:",s),s}finally{this.isLoadingCalendar=!1}},async loadAvailabilityIntervals(){const e=this.timeslots.length>0?this.timeslots[0]:"09:00";try{const t=await this.axios.post("availability/intervals",{date:this.moment(this.date).format("YYYY-MM-DD"),time:e,shop:this.shop?.id||0});return this.availabilityIntervals=t.data.intervals,t}catch(t){throw console.error("Error loading availability intervals:",t),t}},async loadAttendants(){try{const e=await this.axios.get("assistants",{params:{shop:this.shop?.id||null,per_page:-1}});return this.attendants=e.data.items,this.attendantsLoaded=!0,e}catch(e){throw console.error("Error loading attendants:",e),this.attendantsLoaded=!0,e}},update(){return this.loadBookingsList()},addBookingForAttendant({timeslot:e,attendantId:t}){const s=this.modelValue;this.$emit("add",s,e,t)},handleSearch(e){this.activeSlotIndex=-1,e?this.loadFilteredBookings(e):this.loadBookingsList()},async loadFilteredBookings(e){this.isLoadingTimeslots=!0,this.bookingsList=[];const t=this.isAttendantView;try{const s=await this.axios.get("bookings",{params:{start_date:this.moment(this.date).format("YYYY-MM-DD"),end_date:this.moment(this.date).format("YYYY-MM-DD"),search:e,per_page:-1,statuses:["sln-b-pendingpayment","sln-b-pending","sln-b-paid","sln-b-paylater","sln-b-confirmed"],shop:this.shop?.id||null}});this.bookingsList=s.data.items,this.arrangeBookings(),this.isAttendantView=t}finally{this.isLoadingTimeslots=!1}},handleSlotLock(e){this.lockedTimeslots.push(e),this.axios.post("holiday-rules",this.normalizeRule(e)).catch(()=>{this.lockedTimeslots=this.lockedTimeslots.filter(t=>!this.isSameRule(t,e))})},async handleSlotUnlock(e){const t=`${e.from_time}-${e.to_time}`;this.updateSlotProcessing({slot:t,status:!0}),this.lockedTimeslots=this.lockedTimeslots.filter(t=>!this.isSameRule(t,e)),this.updateLocalAvailability(e,!0);try{await this.axios.delete("holiday-rules",{data:this.normalizeRule(e)})}catch(s){this.lockedTimeslots.push(e),console.error("Unlock failed:",s)}finally{this.updateSlotProcessing({slot:t,status:!1}),this.$nextTick(()=>this.$forceUpdate())}},updateLocalAvailability(e,t){if(!this.availabilityIntervals)return;const{times:s={},workTimes:i={}}=this.availabilityIntervals,o=this.calcSlotStep(),a=this.timeToMinutes(e.from_time),n=this.timeToMinutes(e.to_time);if(t){const e={...s},t={...i};for(let s=a;s<n;s+=o){const i=`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`;e[s]=i,t[s]=i}this.availabilityIntervals={...this.availabilityIntervals,times:e,workTimes:t}}},isSameRule(e,t){const s=this.normalizeTime(e.from_time),i=this.normalizeTime(e.to_time),o=this.normalizeTime(t.from_time),a=this.normalizeTime(t.to_time);return e.from_date===t.from_date&&e.to_date===t.to_date&&s===o&&i===a&&(e.assistant_id??null)===(t.assistant_id??null)},normalizeRule(e){return{from_date:e.from_date,to_date:e.to_date,from_time:this.moment(e.from_time,"HH:mm").format("HH:mm"),to_time:this.moment(e.to_time,"HH:mm").format("HH:mm"),daily:!0,assistant_id:e.assistant_id??null}},handleMonthYear({year:e,month:t}){const s=new Date(e,t,1),i=new Date(e,t+1,0);this.loadAvailabilityStats(s,i)},isSlotLocked(e){try{if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!1;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if(!1===this.$root.settings?.available_days?.[o])return!0;const a=this.$root.settings.holidays?.find(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(a)return!0;const n=this.lockedTimeslots.find(e=>null==e.assistant_id&&(e.from_date===t&&e.to_date===t&&i>=this.timeToMinutes(this.normalizeTime(e.from_time))&&i<this.timeToMinutes(this.normalizeTime(e.to_time))));if(n)return!0;const l=this.lockedTimeslots.find(e=>{const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(l)return!0;const r=this.$root.settings.availabilities||[];if(r.length){const e=r.filter(e=>"1"===e.days?.[o]);if(0===e.length)return!0;const t=e.some(e=>e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s}));if(!t)return!0}const d=this.availabilityIntervals.workTimes||{},u=this.availabilityIntervals.times||{},c=Object.keys(d).length?d:u;return!Object.values(c).some(e=>i===this.timeToMinutes(e))}catch{return!0}},isAvailable(e){if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!0;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if(!1===this.$root.settings?.available_days?.[o])return!1;const a=this.$root.settings.holidays?.find(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!s.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?i>=this.timeToMinutes(e.from_time)&&i<this.timeToMinutes(e.to_time):s.isSame(t,"day")?i>=this.timeToMinutes(e.from_time):!s.isSame(o,"day")||i<this.timeToMinutes(e.to_time))});if(a)return!1;const n=this.lockedTimeslots.find(e=>null==e.assistant_id&&(e.from_date===t&&e.to_date===t&&i>=this.timeToMinutes(this.normalizeTime(e.from_time))&&i<this.timeToMinutes(this.normalizeTime(e.to_time))));if(n)return!1;const l=this.lockedTimeslots.find(e=>!(t<e.from_date||t>e.to_date)&&(t===e.from_date?i>=this.timeToMinutes(e.from_time):t!==e.to_date||i<this.timeToMinutes(e.to_time)));if(l)return!1;const r=this.availabilityStats.find(e=>e.date===t&&"holiday_rules"===e.error?.type);if(r)return!1;const d=this.$root.settings.availabilities||[];if(d.length){const e=d.find(e=>e.days?.[o]);if(!e)return!1;const t=e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s});if(!t)return!1}const u=this.availabilityIntervals.workTimes||{},c=this.availabilityIntervals.times||{},h=Object.keys(u).length?u:c;return Object.values(h).some(e=>i===this.timeToMinutes(e))},isSystemLocked(e){try{if(!this.availabilityIntervals||!Object.keys(this.availabilityIntervals).length)return!1;const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.moment(t,"YYYY-MM-DD"),i=this.timeToMinutes(e),o=s.day()+1;if("1"!==this.$root.settings?.available_days?.[o])return!0;const a=this.$root.settings.availabilities||[];if(a.length){const e=a.find(e=>"1"===e.days?.[o]);if(!e)return!0;const t=e.shifts?.some(e=>{if(e.disabled)return!1;const t=this.timeToMinutes(e.from),s=this.timeToMinutes(e.to);return i>=t&&i<s});if(!t)return!0}return!1}catch(t){return console.error("error isSlotLocked:",t),!0}},isManualLocked(e){const t=this.moment(this.date).format("YYYY-MM-DD"),s=this.timeToMinutes(this.normalizeTime(e)),i=this.moment(t,"YYYY-MM-DD"),o=this.lockedTimeslots.some(e=>{if(null!=e.assistant_id)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");if(!i.isBetween(t,o,"day","[]"))return!1;const a=this.timeToMinutes(this.normalizeTime(e.from_time)),n=this.timeToMinutes(this.normalizeTime(e.to_time));return t.isSame(o,"day")?s>=a&&s<n:i.isSame(t,"day")?s>=a:!i.isSame(o,"day")||s<n}),a=this.$root.settings.holidays?.some(e=>{if(!e.from_date||!e.to_date)return!1;const t=this.moment(e.from_date,"YYYY-MM-DD"),o=this.moment(e.to_date,"YYYY-MM-DD");return!!i.isBetween(t,o,"day","[]")&&(t.isSame(o,"day")?s>=this.timeToMinutes(e.from_time)&&s<this.timeToMinutes(e.to_time):i.isSame(t,"day")?s>=this.timeToMinutes(e.from_time):!i.isSame(o,"day")||s<this.timeToMinutes(e.to_time))})||!1;return o||a},normalizeTime(e){if(!e)return e;if("h:iip"===this.$root.settings?.time_format?.js_format){const t=this.moment(e,"h:mm A");return t.format("HH:mm")}const t=this.getTimeFormat();return this.moment(e,t).format("HH:mm")},timeToMinutes(e){if(!e)return 0;const[t,s]=e.split(":").map(Number);return 60*t+s},setSlotProcessing(e,t){t?this.slotProcessingStates.set(e,!0):this.slotProcessingStates.delete(e)},toggleSlotActions(e){this.isDragging||this.wasRecentlyDragging||(this.activeSlotIndex=this.activeSlotIndex===e?-1:e)},addBooking(e){const t=this.modelValue,s=e||this.timeslots[0];this.$emit("add",t,s)},deleteItem(e){this.axios.delete("bookings/"+e).then(()=>{this.bookingsList=this.bookingsList.filter(t=>t.id!==e)})},showDetails(e){this.$emit("showItem",e)},updateCurrentTimeLinePosition(){if(!this.timeslots||!this.timeslots.length)return void(this.showCurrentTimeLine=!1);const e=this.timeslots[0],t=this.timeslots[this.timeslots.length-1],s=this.moment(),i=this.moment(e,"HH:mm").set({year:s.year(),month:s.month(),date:s.date()});let o=this.moment(t,"HH:mm").set({year:s.year(),month:s.month(),date:s.date()});if(o.isBefore(i)&&o.add(1,"day"),s.isBefore(i))return this.currentTimeLinePosition=0,void(this.showCurrentTimeLine=!0);if(s.isAfter(o))return this.currentTimeLinePosition=this.timeslots.length*this.slotHeight-2,void(this.showCurrentTimeLine=!0);const a=this.calcSlotStep(),n=s.diff(i,"minutes"),l=n/a*this.slotHeight;this.currentTimeLinePosition=Math.max(0,Math.min(l,this.timeslots.length*this.slotHeight)),this.showCurrentTimeLine=!0},arrangeBookings(){if(!Array.isArray(this.bookingsList))return;this.columns=[];const e=[...this.bookingsList].sort((e,t)=>{const s=this.getBookingStart(e),i=this.getBookingStart(t);return s-i});e.forEach(e=>{e&&(e._column=this.findFreeColumn(e))}),null!==document.querySelector(".dp__active_date.dp__today")?null!==document.querySelector(".current-time-line")&&(document.querySelector(".current-time-line").style.display="block",document.querySelector(".current-time-line").scrollIntoView({behavior:"smooth",block:"center"})):null!==document.querySelector(".current-time-line")&&(document.querySelector(".current-time-line").style.display="none")},findFreeColumn(e){for(let t=0;t<this.columns.length;t++)if(!this.doesOverlapColumn(e,this.columns[t]))return this.columns[t].push(e),t;return this.columns.push([e]),this.columns.length-1},doesOverlapColumn(e,t){const s=this.getBookingStart(e),i=this.getBookingEnd(e);return t.some(e=>{const t=this.getBookingStart(e),o=this.getBookingEnd(e);return s<o&&i>t})},hasOverlappingBookings(e){const t=this.getMinutes(this.timeslots[e]),s=e+1<this.timeslots.length?this.getMinutes(this.timeslots[e+1]):t+this.calcSlotStep();return this.bookingsList.some(e=>{const i=this.getBookingStart(e),o=this.getBookingEnd(e);return i<s&&o>t})},calcSlotStep(){if(!this.timeslots||this.timeslots.length<2)return 30;const e=this.getMinutes(this.timeslots[0]),t=this.getMinutes(this.timeslots[1]);return t-e},getBookingStart(e){return e&&e.time?this.getMinutes(e.time):0},getBookingEnd(e){if(!e)return 0;let t=e.time;if(e.services?.length){const s=e.services[e.services.length-1];t=s.end_at||e.time}const s=this.getMinutes(e.time),i=this.getMinutes(t),o=i-s,a=this.getDisplayDuration(e,o);return s+a},getBookingStyle(e){const t=this.timeslots[0],s=this.getMinutes(t);let i,o,a;if(this.isAttendantView){i=this.getMinutes(e._serviceTime.start);const t=this.getMinutes(e._serviceTime.end)-i;a=this.getDisplayDuration(e,t),o=i+a}else if(i=this.getMinutes(e.time),e.services?.length){const t=e.services[e.services.length-1],s=t.end_at||e.time,n=this.getMinutes(s)-i;a=this.getDisplayDuration(e,n),o=i+a}else a=this.getDefaultDuration(e),o=i+a;const n=this.slotHeight/this.calcSlotStep(),l=(i-s)*n,r=Math.max((o-i)*n,this.slotHeight);let d=0;if(this.isAttendantView){const t=this.sortedAttendants.findIndex(t=>t.id===e._assistantId);t>=0&&(d=this.getAssistantColumnLeft(t),d+=this.getBookingPosition(e))}else{const t=e._column||0;d=t*this.cardWidth}return{position:"absolute",top:`${l}px`,left:`${d}px`,width:`${this.cardWidth}px`,height:`${r}px`}},getTimeSlotLineStyle(e){const t=e*this.slotHeight;return{position:"absolute",left:"0",right:"0",top:`${t}px`,height:`${this.slotHeight}px`,display:"flex",alignItems:"center",borderTop:e>0?"1px solid #ddd":"none",backgroundColor:"#EDF0F5",boxSizing:"border-box"}},getAssistantColumnLeft(e){return this.sortedAttendants.slice(0,e).reduce((e,t)=>{const s=this.columnWidths[t.id]||this.attendantColumnWidth;return e+s+this.attendantColumnGap},0)},getBookingPosition(e){const t=e._assistantId,s=this.getMinutes(e._serviceTime.start),i=this.getMinutes(e._serviceTime.end)-s,o=this.getDisplayDuration(e,i),a=s+o,n=this.processedBookings.filter(i=>{if(i._assistantId!==t||i.id===e.id)return!1;const o=this.getMinutes(i._serviceTime.start),n=this.getMinutes(i._serviceTime.end)-o,l=this.getDisplayDuration(i,n),r=o+l;return s<r&&a>o}).sort((e,t)=>{const s=this.getMinutes(e._serviceTime.start),i=this.getMinutes(t._serviceTime.start);return s===i?e.id-t.id:s-i});if(0===n.length)return e._position=0,0;const l=new Set(n.map(e=>e._position||0));let r=0;while(l.has(r))r++;return e._position=r,r*this.cardWidth},getMinutes(e){const[t,s]=e.split(":").map(Number);return 60*t+s},getDefaultDuration(e){return e.services?.length?this.getDisplayDuration(e,30):30},getDisplayDuration(e,t){return t},calculateEndTime(e,t){const[s,i]=e.split(":").map(Number),o=60*s+i+t,a=Math.floor(o/60),n=o%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},onMouseDown(e){this.$refs.dragScrollContainer&&(this.possibleDrag=!0,this.isDragging=!1,this.wasRecentlyDragging=!1,this.startX=e.pageX-this.$refs.dragScrollContainer.offsetLeft,this.scrollLeft=this.$refs.dragScrollContainer.scrollLeft,document.body.style.userSelect="none")},onMouseMove(e){if(!this.possibleDrag)return;const t=e.pageX-this.$refs.dragScrollContainer.offsetLeft,s=Math.abs(t-this.startX);s>5&&(this.isDragging=!0,this.activeSlotIndex=-1),this.isDragging&&(e.preventDefault(),this.$refs.dragScrollContainer.scrollLeft=this.scrollLeft-(t-this.startX))},onMouseUp(){this.possibleDrag=!1,this.isDragging&&(this.isDragging=!1,this.wasRecentlyDragging=!0,setTimeout(()=>{this.wasRecentlyDragging=!1},200)),document.body.style.userSelect=""},onMouseLeave(){this.possibleDrag&&this.onMouseUp()},onTouchStart(e){this.$refs.dragScrollContainer&&(this.isDragging=!1,this.possibleDrag=!0,this.startX=e.touches[0].clientX-this.$refs.dragScrollContainer.offsetLeft,this.startY=e.touches[0].clientY,this.scrollLeft=this.$refs.dragScrollContainer.scrollLeft)},onTouchMove(e){if(!this.possibleDrag)return;const t=e.touches[0].clientX-this.$refs.dragScrollContainer.offsetLeft,s=e.touches[0].clientY,i=Math.abs(t-this.startX),o=Math.abs(s-this.startY);i>5&&i>o&&(this.isDragging=!0,this.activeSlotIndex=-1,e.cancelable&&e.preventDefault(),this.$refs.dragScrollContainer.scrollLeft=this.scrollLeft-(t-this.startX))},onTouchEnd(){this.possibleDrag=!1,this.isDragging&&(this.isDragging=!1,this.wasRecentlyDragging=!0,setTimeout(()=>{this.wasRecentlyDragging=!1},200))},handleOutsideClick(){this.isDragging||this.wasRecentlyDragging||(this.activeSlotIndex=-1)},viewCustomerProfile(e){this.$emit("viewCustomerProfile",e)}},emits:["update:modelValue","update:lockedTimeslots","add","showItem","viewCustomerProfile","lock","unlock","lock-start","lock-end","unlock-start"]};const ma=(0,j.A)(ha,[["render",li],["__scopeId","data-v-12e4b39a"]]);var pa=ma;function ga(e,t,s,a,l,r){const d=(0,o.g2)("EditBooking");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",null,(0,n.v_)(this.getLabel("addReservationTitle")),1),(0,o.bF)(d,{date:s.date,time:s.time,customerID:s.customer?s.customer.id:"",customerFirstname:s.customer?s.customer.first_name:"",customerLastname:s.customer?s.customer.last_name:"",customerEmail:s.customer?s.customer.email:"",customerPhone:s.customer?s.customer.phone:"",customerAddress:s.customer?s.customer.address:"",customerPersonalNotes:s.customer?s.customer.note:"",status:"sln-b-confirmed",shop:s.shop,isLoading:e.isLoading,isSaved:e.isSaved,isError:e.isError,errorMessage:e.errorMessage,onClose:r.close,onChooseCustomer:r.chooseCustomer,onErrorState:r.handleErrorState,onSave:r.save},null,8,["date","time","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes","shop","isLoading","isSaved","isError","errorMessage","onClose","onChooseCustomer","onErrorState","onSave"])],512)),[[i.aG,e.show]])}var fa={name:"AddBookingItem",props:{date:{default:function(){return""}},time:{default:function(){return""}},customer:{default:function(){return{}}},shop:{default:function(){return{}}}},mounted(){this.toggleShow()},components:{EditBooking:rs},data:function(){return{isLoading:!1,isSaved:!1,isError:!1,errorMessage:"",show:!0,bookings:[]}},methods:{handleErrorState({isError:e,errorMessage:t}){this.isError=e,this.errorMessage=t},close(e){this.isError=!1,this.$emit("close",e)},chooseCustomer(){this.isError=!1,this.$emit("chooseCustomer")},save(e){this.isLoading=!0,this.axios.post("bookings",e).then(e=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3),this.isLoading=!1,this.axios.get("bookings/"+e.data.id).then(e=>{this.close(e.data.items[0])})},e=>{this.isError=!0,this.errorMessage=e.response.data.message,this.isLoading=!1})},toggleShow(){this.show=!1,setTimeout(()=>{this.show=!0},0)}},emits:["close","chooseCustomer"]};const ka=(0,j.A)(fa,[["render",ga]]);var va=ka;const ba={class:"customer-details-info"},_a={class:"customer-firstname"},ya={class:"customer-lastname"},La={class:"customer-email"},Ca={class:"customer-address"},Sa={class:"customer-phone"},wa={class:"customer-details-extra-info"},Fa={class:"customer-details-extra-info-header"},Da={class:"customer-details-extra-info-header-title"},Ta=["aria-expanded"],Ia={class:"customer-personal-notes"},Aa={class:"label",for:"customer_personal_notes"};function Ea(e,t,s,i,a,l){const r=(0,o.g2)("b-form-input"),d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row"),c=(0,o.g2)("font-awesome-icon"),h=(0,o.g2)("CustomField"),m=(0,o.g2)("b-form-textarea"),p=(0,o.g2)("b-collapse"),g=(0,o.g2)("b-spinner"),f=(0,o.g2)("b-button"),k=(0,o.g2)("b-alert");return(0,o.uX)(),(0,o.Wv)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ba,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",_a,[(0,o.bF)(r,{placeholder:this.getLabel("customerFirstnamePlaceholder"),modelValue:e.elCustomerFirstname,"onUpdate:modelValue":t[0]||(t[0]=t=>e.elCustomerFirstname=t),class:(0,n.C4)({required:e.requiredFields.indexOf("customer_first_name")>-1})},null,8,["placeholder","modelValue","class"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ya,[(0,o.bF)(r,{placeholder:this.getLabel("customerLastnamePlaceholder"),modelValue:e.elCustomerLastname,"onUpdate:modelValue":t[1]||(t[1]=t=>e.elCustomerLastname=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",La,[(0,o.bF)(r,{type:e.shouldHideEmail?"password":"text",placeholder:this.getLabel("customerEmailPlaceholder"),modelValue:e.elCustomerEmail,"onUpdate:modelValue":t[2]||(t[2]=t=>e.elCustomerEmail=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ca,[(0,o.bF)(r,{placeholder:this.getLabel("customerAddressPlaceholder"),modelValue:e.elCustomerAddress,"onUpdate:modelValue":t[3]||(t[3]=t=>e.elCustomerAddress=t)},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Sa,[(0,o.bF)(r,{type:e.shouldHidePhone?"password":"tel",placeholder:this.getLabel("customerPhonePlaceholder"),modelValue:e.elCustomerPhone,"onUpdate:modelValue":t[4]||(t[4]=t=>e.elCustomerPhone=t)},null,8,["type","placeholder","modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",wa,[(0,o.Lk)("div",Fa,[(0,o.Lk)("div",Da,(0,n.v_)(this.getLabel("extraInfoLabel")),1),(0,o.Lk)("div",null,[(0,o.Lk)("span",{class:(0,n.C4)(["customer-details-extra-info-header-btn",e.visibleExtraInfo?null:"collapsed"]),"aria-expanded":e.visibleExtraInfo?"true":"false","aria-controls":"collapse-2",onClick:t[5]||(t[5]=t=>e.visibleExtraInfo=!e.visibleExtraInfo)},[e.visibleExtraInfo?((0,o.uX)(),(0,o.Wv)(c,{key:1,icon:"fa-solid fa-circle-chevron-up"})):((0,o.uX)(),(0,o.Wv)(c,{key:0,icon:"fa-solid fa-circle-chevron-down"}))],10,Ta)])]),(0,o.bF)(p,{id:"collapse-2",class:"mt-2",modelValue:e.visibleExtraInfo,"onUpdate:modelValue":t[7]||(t[7]=t=>e.visibleExtraInfo=t)},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.customFieldsList,e=>((0,o.uX)(),(0,o.Wv)(h,{key:e.key,field:e,value:l.getCustomFieldValue(e.key,e.default_value),onUpdate:l.updateCustomField},null,8,["field","value","onUpdate"]))),128)),(0,o.bF)(u,{class:"field"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Ia,[(0,o.Lk)("label",Aa,(0,n.v_)(this.getLabel("customerPersonalNotesLabel")),1),(0,o.bF)(m,{modelValue:e.elCustomerPersonalNotes,"onUpdate:modelValue":t[6]||(t[6]=t=>e.elCustomerPersonalNotes=t),modelModifiers:{lazy:!0},id:"customer_personal_notes",placeholder:this.getLabel("customerPersonalNotesPlaceholder"),rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"save-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"primary",onClick:l.save,class:"save-button"},{default:(0,o.k6)(()=>[e.isLoading?((0,o.uX)(),(0,o.Wv)(g,{key:0,small:"",variant:"primary"})):(0,o.Q3)("",!0),(0,o.eW)(" "+(0,n.v_)(this.getLabel("customerDetailsUpdateButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"go-back-button-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{variant:"outline-primary",onClick:l.close,class:"go-back-button"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("customerDetailsGoBackButtonLabel")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"save-button-result-wrapper"},{default:(0,o.k6)(()=>[(0,o.bF)(k,{show:e.isSaved,fade:"",variant:"success"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("savedLabel")),1)]),_:1},8,["show"]),(0,o.bF)(k,{show:e.isError,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(e.errorMessage),1)]),_:1},8,["show"]),(0,o.bF)(k,{show:!e.isValid,fade:"",variant:"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("validationMessage")),1)]),_:1},8,["show"])]),_:1})]),_:1})])]),_:1})}var Ma={name:"CustomerDetails",components:{CustomField:as},mixins:[xe],props:{customerID:{default:function(){return""}},customerFirstname:{default:function(){return""}},customerLastname:{default:function(){return""}},customerEmail:{default:function(){return""}},customerAddress:{default:function(){return""}},customerPhone:{default:function(){return""}},customerPersonalNotes:{default:function(){return""}}},mounted(){this.loadCustomFields()},data:function(){return{elCustomerFirstname:this.customerFirstname,elCustomerLastname:this.customerLastname,elCustomerAddress:this.customerAddress,originalEmail:this.customerEmail,originalPhone:this.customerPhone,elCustomerEmail:this.shouldHideEmail?"***@***":this.customerEmail,elCustomerPhone:this.shouldHidePhone?"*******":this.customerPhone,elCustomerPersonalNotes:this.customerPersonalNotes,isValid:!0,requiredFields:[],visibleExtraInfo:!1,customFieldsList:[],elCustomFields:[],vueTelInputOptions:{placeholder:this.getLabel("customerPhonePlaceholder")},isLoading:!1,isSaved:!1,isError:!1,errorMessage:""}},methods:{close(){this.$emit("close")},save(){if(this.isValid=this.validate(),this.isValid){var e={id:this.customerID?this.customerID:0,first_name:this.elCustomerFirstname,last_name:this.elCustomerLastname,email:this.originalEmail,phone:this.originalPhone,address:this.elCustomerAddress,note:this.elCustomerPersonalNotes,custom_fields:this.customFieldsList};this.isLoading=!0,this.axios.put("customers/"+e.id,e).then(()=>{this.isSaved=!0,setTimeout(()=>{this.isSaved=!1},3e3)},e=>{this.isError=!0,this.errorMessage=e.response.data.message,setTimeout(()=>{this.isError=!1,this.errorMessage=""},3e3)}).finally(()=>{this.isLoading=!1})}},validate(){return this.requiredFields=[],this.elCustomerFirstname.trim()||this.requiredFields.push("customer_first_name"),0===this.requiredFields.length},updateCustomField(e,t){let s=this.customFieldsList.find(t=>t.key===e);s?s.value=t:this.customFieldsList.push({key:e,value:t})},getCustomFieldValue(e,t){let s=this.customFieldsList.find(t=>t.key===e);return s?s.value:t},loadCustomFields(){this.axios.get("custom-fields/booking",{params:{user_profile:1,customer_id:this.customerID}}).then(e=>{this.customFieldsList=e.data.items.filter(e=>-1===["html","file"].indexOf(e.type))})}},emits:["close","save"]};const xa=(0,j.A)(Ma,[["render",Ea],["__scopeId","data-v-708a7652"]]);var $a=xa,Pa={name:"ReservationsCalendarTab",props:{shop:{default:function(){return{}}}},components:{ReservationsCalendar:pa,AddBookingItem:va,CustomersAddressBook:Ws,BookingDetails:Ye,EditBookingItem:cs,ImagesList:Js,CustomerDetails:$a},mounted(){let e=this.getQueryParams();"undefined"!==typeof e["booking_id"]&&(this.isLoading=!0,this.axios.get("bookings/"+e["booking_id"]).then(e=>{this.isLoading=!1,this.setShowItem(e.data.items[0])}))},data:function(){return{addItem:!1,showItem:!1,isChooseCustomer:!1,item:null,editItem:!1,customer:null,date:"",time:"",isLoading:!1,isShowCustomerImages:!1,showImagesCustomer:null,selectedDate:new Date,showCustomerProfile:!1,selectedCustomer:null}},methods:{add(e,t){this.addItem=!0,this.date=e,this.time=t},setShowItem(e){this.showItem=!0,this.item=e},close(e){this.addItem=!1,this.customer=null,e&&this.setShowItem(e)},chooseCustomer(){this.isChooseCustomer=!0},closeChooseCustomer(){this.isChooseCustomer=!1},closeShowItem(){this.showItem=!1},setEditItem(){this.editItem=!0},closeEditItem(e){this.editItem=!1,this.customer=null,e&&this.setShowItem(e)},choose(e){this.customer=e,this.closeChooseCustomer()},showCustomerImages(e){this.isShowCustomerImages=!0,this.showImagesCustomer=e,this.$emit("hideTabsHeader",!0)},closeShowCustomerImages(e){this.item.customer_photos=e.photos,this.isShowCustomerImages=!1,this.$emit("hideTabsHeader",!1)},openCustomerProfile(e){this.selectedCustomer=e,this.showItem=!1,this.showCustomerProfile=!0},closeCustomerProfile(){this.showCustomerProfile=!1,this.selectedCustomer=null,this.item&&(this.showItem=!0)}},emits:["hideTabsHeader"]};const Ya=(0,j.A)(Pa,[["render",si]]);var Va=Ya;function Xa(e,t,s,i,a,n){const l=(0,o.g2)("ImagesList"),r=(0,o.g2)("CustomerDetails"),d=(0,o.g2)("CustomersAddressBook");return(0,o.uX)(),(0,o.CE)("div",null,[e.isShowImages?((0,o.uX)(),(0,o.Wv)(l,{key:0,customer:e.customer,onClose:n.closeShowImages},null,8,["customer","onClose"])):e.editCustomer?((0,o.uX)(),(0,o.Wv)(r,{key:1,onClose:n.closeCustomerDetails,customerID:e.customer.id,customerFirstname:e.customer.first_name,customerLastname:e.customer.last_name,customerEmail:e.customer.email,customerPhone:e.customer.phone,customerAddress:e.customer.address,customerPersonalNotes:e.customer.note},null,8,["onClose","customerID","customerFirstname","customerLastname","customerEmail","customerPhone","customerAddress","customerPersonalNotes"])):((0,o.uX)(),(0,o.Wv)(d,{key:2,shop:s.shop,onShowImages:n.showImages,onEdit:n.edit,customer:e.customerData,ref:"customersAddressBook"},null,8,["shop","onShowImages","onEdit","customer"]))])}var ja={name:"CustomersAddressBookTab",props:{shop:{default:function(){return{}}}},components:{CustomerDetails:$a,CustomersAddressBook:Ws,ImagesList:Js},data:function(){return{isShowImages:!1,customer:null,customerData:null,editCustomer:!1}},methods:{showImages(e){this.isShowImages=!0,this.customer=e,this.$emit("hideTabsHeader",!0)},closeShowImages(e){this.isShowImages=!1,this.customerData=e,this.$emit("hideTabsHeader",!1)},edit(e){this.customer=e,this.editCustomer=!0},closeCustomerDetails(){this.editCustomer=!1,this.$refs.customersAddressBook&&this.$refs.customersAddressBook.load()}},emits:["hideTabsHeader"]};const Wa=(0,j.A)(ja,[["render",Xa]]);var Ha=Wa;const Ba=e=>((0,o.Qi)("data-v-45c03c7c"),e=e(),(0,o.jt)(),e),Na={key:1,class:"user-profile"},Oa={class:"user-profile-top"},Ua={class:"user-profile-name"},qa={class:"user-profile-email"},Ra={class:"user-profile-role"},za={key:2},Qa=Ba(()=>(0,o.Lk)("p",null,"Failed to load user information. Please try again.",-1)),Ka=[Qa];function Ga(e,t,s,i,a,l){const r=(0,o.g2)("b-spinner"),d=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.CE)("div",null,[a.isLoading?((0,o.uX)(),(0,o.Wv)(r,{key:0,variant:"primary"})):a.user?((0,o.uX)(),(0,o.CE)("div",Na,[(0,o.Lk)("div",Oa,[(0,o.Lk)("h2",Ua,(0,n.v_)(a.user.name),1),(0,o.Lk)("p",qa,(0,n.v_)(a.user.email),1),(0,o.Lk)("p",Ra,(0,n.v_)(a.user.role),1)]),(0,o.bF)(d,{class:"btn-logout",variant:"primary",onClick:l.logOut},{default:(0,o.k6)(()=>[(0,o.eW)("Log-out")]),_:1},8,["onClick"])])):((0,o.uX)(),(0,o.CE)("div",za,Ka))])}var Ja={name:"UserProfileTab",data(){return{isLoading:!0,user:null}},methods:{loadUserProfile(){this.isLoading=!0,this.axios.get("/users/current").then(e=>{this.user=e.data}).catch(e=>{console.error("Error loading user profile:",e),this.user=null}).finally(()=>{this.isLoading=!1})},logOut(){this.axios.post("/users/logout").then(()=>{this.user=null,window.location.href="/"}).catch(e=>{console.error("Logout failed:",e)})}},mounted(){this.loadUserProfile()}};const Za=(0,j.A)(Ja,[["render",Ga],["__scopeId","data-v-45c03c7c"]]);var en=Za;const tn={key:0};function sn(e,t,s,i,a,n){const l=(0,o.g2)("ShopsList");return s.isShopsEnabled?((0,o.uX)(),(0,o.CE)("div",tn,[(0,o.bF)(l,{isShopsEnabled:s.isShopsEnabled,onApplyShop:n.applyShop},null,8,["isShopsEnabled","onApplyShop"])])):(0,o.Q3)("",!0)}const on={class:"title"},an={class:"shops-list"},nn={key:2,class:"no-result"};function ln(e,t,s,i,a,l){const r=(0,o.g2)("b-spinner"),d=(0,o.g2)("ShopItem");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("h5",on,(0,n.v_)(this.getLabel("shopsTitle")),1),(0,o.Lk)("div",an,[e.isLoading?((0,o.uX)(),(0,o.Wv)(r,{key:0,variant:"primary"})):e.shopsList.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(e.shopsList,e=>((0,o.uX)(),(0,o.Wv)(d,{key:e.id,shop:e,onApplyShop:l.applyShop},null,8,["shop","onApplyShop"]))),128)):((0,o.uX)(),(0,o.CE)("span",nn,(0,n.v_)(this.getLabel("shopsNoResultLabel")),1))])])}const rn={class:"shop"},dn={class:"shop-name"},un={class:"shop-address"},cn={class:"shop-email"},hn={class:"shop-actions"},mn={class:"shop-phone"},pn={class:"shop-actions-wrapper"},gn={class:"details-link"};function fn(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-col"),u=(0,o.g2)("b-row");return(0,o.uX)(),(0,o.Wv)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"shop-wrapper"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",rn,[(0,o.bF)(u,null,{default:(0,o.k6)(()=>[(0,o.bF)(d,{sm:"12",class:"shop-info"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",dn,(0,n.v_)(l.name),1),(0,o.Lk)("div",un,(0,n.v_)(l.address),1),(0,o.Lk)("div",cn,(0,n.v_)(l.email),1),(0,o.Lk)("div",hn,[(0,o.Lk)("div",mn,(0,n.v_)(l.phone),1),(0,o.Lk)("div",pn,[(0,o.Lk)("span",gn,[(0,o.bF)(r,{icon:"fa-solid fa-chevron-right",onClick:l.applyShop},null,8,["onClick"])])])])]),_:1})]),_:1})])]),_:1})]),_:1})}var kn={name:"ShopItem",props:{shop:{default:function(){return{}}}},computed:{name(){return this.shop.name},address(){return this.shop.address},email(){return this.shop.email},phone(){return this.shop.phone}},methods:{applyShop(){this.$emit("applyShop",this.shop)}},emits:["applyShop"]};const vn=(0,j.A)(kn,[["render",fn],["__scopeId","data-v-36220f6c"]]);var bn=vn,_n={name:"ShopsList",props:{isShopsEnabled:{type:Boolean,required:!0}},data:function(){return{shopsList:[],isLoading:!1}},mounted(){this.isShopsEnabled&&this.load()},components:{ShopItem:bn},methods:{load(){this.isShopsEnabled&&(this.isLoading=!0,this.shopsList=[],this.axios.get("shops").then(e=>{this.shopsList=e.data.items}).finally(()=>{this.isLoading=!1}))},applyShop(e){this.$emit("applyShop",e)}},emits:["applyShop"]};const yn=(0,j.A)(_n,[["render",ln],["__scopeId","data-v-236a4de0"]]);var Ln=yn,Cn={name:"ShopsTab",props:{isShopsEnabled:{type:Boolean,required:!0}},components:{ShopsList:Ln},methods:{applyShop(e){this.$emit("applyShop",e)}},emits:["applyShop"]};const Sn=(0,j.A)(Cn,[["render",sn]]);var wn=Sn;const Fn={class:"shop-title-wrapper"},Dn={class:"shop-selector"},Tn={class:"selector-label"},In={class:"selector-dropdown"},An={key:0},En={key:1},Mn={key:0,class:"dropdown-content"},xn={key:0,class:"loading-spinner"},$n={key:1,class:"no-shops"},Pn={key:2,class:"shops-list"},Yn=["onClick"],Vn={class:"shop-info"},Xn={class:"shop-name"},jn={class:"shop-address"};function Wn(e,t,s,i,a,l){const r=(0,o.g2)("font-awesome-icon"),d=(0,o.g2)("b-spinner"),u=(0,o.gN)("click-outside");return(0,o.uX)(),(0,o.CE)("div",Fn,[(0,o.Lk)("div",Dn,[(0,o.Lk)("div",Tn,(0,n.v_)(this.getLabel("shopTitleLabel"))+":",1),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",In,[(0,o.Lk)("div",{class:"selected-value",onClick:t[0]||(t[0]=(...e)=>l.toggleDropdown&&l.toggleDropdown(...e))},[l.selectedShopName?((0,o.uX)(),(0,o.CE)("span",An,(0,n.v_)(l.selectedShopName),1)):((0,o.uX)(),(0,o.CE)("span",En,(0,n.v_)(this.getLabel("selectShopPlaceholder")),1)),(0,o.bF)(r,{icon:"fa-solid fa-chevron-right",class:(0,n.C4)(["dropdown-icon",{"dropdown-icon--open":a.isDropdownOpen}])},null,8,["class"])]),a.isDropdownOpen?((0,o.uX)(),(0,o.CE)("div",Mn,[a.isLoading?((0,o.uX)(),(0,o.CE)("div",xn,[(0,o.bF)(d,{variant:"primary"})])):0===a.shopsList.length?((0,o.uX)(),(0,o.CE)("div",$n,(0,n.v_)(this.getLabel("shopsNoResultLabel")),1)):((0,o.uX)(),(0,o.CE)("div",Pn,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.shopsList,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"shop-item",onClick:t=>l.selectShop(e)},[(0,o.Lk)("div",Vn,[(0,o.Lk)("div",Xn,(0,n.v_)(e.name),1),(0,o.Lk)("div",jn,(0,n.v_)(e.address),1)])],8,Yn))),128))]))])):(0,o.Q3)("",!0)])),[[u,l.closeDropdown]])])])}var Hn={name:"ShopTitle",props:{shop:{default:function(){return{}}}},data(){return{isDropdownOpen:!1,shopsList:[],isLoading:!1}},computed:{name(){return this.shop&&this.shop.id?this.shop.name:""},selectedShopName(){return this.shop&&this.shop.id?this.shop.name:""}},methods:{toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.isDropdownOpen&&this.loadShops()},closeDropdown(){this.isDropdownOpen=!1},loadShops(){this.isLoading=!0,this.shopsList=[],this.axios.get("shops").then(e=>{this.shopsList=e.data.items}).finally(()=>{this.isLoading=!1})},selectShop(e){this.$emit("applyShop",e),this.closeDropdown()}},emits:["applyShop"],directives:{"click-outside":{mounted(e,t){e.clickOutsideEvent=function(s){e===s.target||e.contains(s.target)||t.value(s)},document.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.removeEventListener("click",e.clickOutsideEvent)}}}};const Bn=(0,j.A)(Hn,[["render",Wn],["__scopeId","data-v-169ad628"]]);var Nn=Bn,On={name:"TabsList",props:{isShopsEnabled:{default:function(){return!1}}},components:{UpcomingReservationsTab:ti,ReservationsCalendarTab:Va,CustomersAddressBookTab:Ha,UserProfileTab:en,ShopsTab:wn,ShopTitle:Nn},mounted(){window.addEventListener("hashchange",()=>{this.hash=window.location.hash});let e=this.getQueryParams();"undefined"!==typeof e["tab"]&&(this.hash="#"+e["tab"])},data:function(){return{hash:window.location.hash?window.location.hash:this.isShopsEnabled?"#shops":"#upcoming-reservations",shop:null,isHideTabsHeader:!1,isShopSelected:!1}},watch:{shop(e){this.isShopSelected=!!e&&!!e.id}},methods:{click(e){window.location.href=e,null!==document.querySelector(".dp__active_date.dp__today")?(document.querySelector(".current-time-line").style.display="block",document.querySelector(".current-time-line").scrollIntoView({behavior:"smooth",block:"center"})):document.querySelector(".current-time-line").style.display="none"},isActiveTab(e){return this.hash===e?"":void 0},applyShop(e){this.shop=e,this.$emit("applyShop",e)},applyShopAndSwitch(e){this.shop=e,this.$refs["upcoming-reservations-tab-link"].click(),this.$emit("applyShop",e)},hideTabsHeader(e){this.isHideTabsHeader=e}},emits:["applyShop"]};const Un=(0,j.A)(On,[["render",u],["__scopeId","data-v-2c96b20a"]]);var qn=Un,Rn=s.p+"img/logo.png";const zn=e=>((0,o.Qi)("data-v-bb2ebf3c"),e=e(),(0,o.jt)(),e),Qn=zn(()=>(0,o.Lk)("span",{class:"logo"},[(0,o.Lk)("img",{src:Rn})],-1)),Kn={class:"text"};function Gn(e,t,s,i,a,l){const r=(0,o.g2)("b-alert"),d=(0,o.g2)("b-button");return(0,o.uX)(),(0,o.CE)("div",null,[e.showIOS?((0,o.uX)(),(0,o.Wv)(r,{key:0,show:"",dismissible:"",variant:"secondary",class:"add-to-home-screen"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAIOSText")),1)]),_:1})):((0,o.uX)(),(0,o.Wv)(r,{key:1,show:e.shown,dismissible:"",variant:"secondary",class:"add-to-home-screen"},{default:(0,o.k6)(()=>[Qn,(0,o.Lk)("span",Kn,(0,n.v_)(this.getLabel("installPWAPromptText")),1),(0,o.bF)(d,{onClick:l.installPWA,class:"btn-install"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAPromptInstallBtnLabel")),1)]),_:1},8,["onClick"]),(0,o.bF)(d,{onClick:l.dismissPrompt},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(this.getLabel("installPWAPromptNoInstallBtnLabel")),1)]),_:1},8,["onClick"])]),_:1},8,["show"]))])}var Jn={data:()=>({shown:!1,showIOS:!1}),beforeMount(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.installEvent=e,this.shown=!0});const e=()=>{const e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},t=()=>"standalone"in window.navigator&&window.navigator.standalone;e()&&!t()&&(this.showIOS=!0)},methods:{dismissPrompt(){this.shown=!1},installPWA(){this.installEvent.prompt(),this.installEvent.userChoice.then(e=>{this.dismissPrompt(),e.outcome})}}};const Zn=(0,j.A)(Jn,[["render",Gn],["__scopeId","data-v-bb2ebf3c"]]);var el=Zn,tl={name:"App",mounted(){this.loadSettings()},computed:{isShopsEnabled(){return window.slnPWA.is_shops}},data:function(){return{settings:{},statusesList:{"sln-b-pendingpayment":{label:this.getLabel("pendingPaymentStatusLabel"),color:"#ffc107"},"sln-b-pending":{label:this.getLabel("pendingStatusLabel"),color:"#ffc107"},"sln-b-paid":{label:this.getLabel("paidStatusLabel"),color:"#28a745"},"sln-b-paylater":{label:this.getLabel("payLaterStatusLabel"),color:"#17a2b8"},"sln-b-error":{label:this.getLabel("errorStatusLabel"),color:"#dc3545"},"sln-b-confirmed":{label:this.getLabel("confirmedStatusLabel"),color:"#28a745"},"sln-b-canceled":{label:this.getLabel("canceledStatusLabel"),color:"#dc3545"}},shop:null}},watch:{shop(){this.loadSettings()}},methods:{loadSettings(){this.axios.get("app/settings",{params:{shop:this.shop?this.shop.id:null}}).then(e=>{this.settings=e.data.settings,this.$root.settings={...this.$root.settings,...this.settings}})},applyShop(e){this.shop=e}},components:{TabsList:qn,PWAPrompt:el},beforeCreate(){this.$OneSignal&&(this.$OneSignal.showSlidedownPrompt(),this.$OneSignal.on("subscriptionChange",e=>{e&&this.$OneSignal.getUserId(e=>{e&&this.axios.put("users",{onesignal_player_id:e})})}))}};const sl=(0,j.A)(tl,[["render",a]]);var il=sl,ol=s(4458);(0,ol.k)("/{SLN_PWA_DIST_PATH}/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var al=s(782),nl=(0,al.y$)({state:{},getters:{},mutations:{},actions:{},modules:{}}),ll=s(5015),rl=s(8950),dl=s(292),ul=s(2353),cl=s(92),hl=s(4996),ml=s(3674),pl=s(46),gl=s(5556),fl=s(3225),kl=s(22);rl.Yv.add(ul.ITF,ul.l6G,cl.vlp,ul.$UM,cl.a$,ul.XkK,ul.yLS,ul.bnw,ul.LFz,ul.e68,ul.gdJ,ul.e9J,ul.QLR,ul.dzk,ul.ivC,ul.s67,ul.B9e,ul.KKb,ul.DW4,ul.KKr,ul.TOj,ul.q_k,hl.EYA,ul.H37,ul.yvG,ul.rwq,ul.rk5,cl.QRE);var vl=(0,i.Ef)(il).use(nl).use(ll.Ay).use(kl.A).component("font-awesome-icon",dl.gc).component("Datepicker",ml.A).component("vue-select",gl.A).component("Carousel",fl.FN).component("Slide",fl.q7).component("Pagination",fl.dK).component("Navigation",fl.Vx).mixin(xe),bl=window.slnPWA.onesignal_app_id;bl&&vl.use(pl.A,{appId:bl,serviceWorkerParam:{scope:"/{SLN_PWA_DIST_PATH}/"},serviceWorkerPath:"{SLN_PWA_DIST_PATH}/OneSignalSDKWorker.js"}),vl.mount("#app")},5358:function(e,t,s){var i={"./af":2190,"./af.js":2190,"./ar":7218,"./ar-dz":5785,"./ar-dz.js":5785,"./ar-kw":9417,"./ar-kw.js":9417,"./ar-ly":6904,"./ar-ly.js":6904,"./ar-ma":8617,"./ar-ma.js":8617,"./ar-sa":2699,"./ar-sa.js":2699,"./ar-tn":6789,"./ar-tn.js":6789,"./ar.js":7218,"./az":3050,"./az.js":3050,"./be":8316,"./be.js":8316,"./bg":310,"./bg.js":310,"./bm":8884,"./bm.js":8884,"./bn":3469,"./bn-bd":6672,"./bn-bd.js":6672,"./bn.js":3469,"./bo":9118,"./bo.js":9118,"./br":3113,"./br.js":3113,"./bs":3626,"./bs.js":3626,"./ca":921,"./ca.js":921,"./cs":7799,"./cs.js":7799,"./cv":2828,"./cv.js":2828,"./cy":3521,"./cy.js":3521,"./da":6962,"./da.js":6962,"./de":3294,"./de-at":6158,"./de-at.js":6158,"./de-ch":5960,"./de-ch.js":5960,"./de.js":3294,"./dv":7963,"./dv.js":7963,"./el":3432,"./el.js":3432,"./en-au":998,"./en-au.js":998,"./en-ca":5931,"./en-ca.js":5931,"./en-gb":5930,"./en-gb.js":5930,"./en-ie":8081,"./en-ie.js":8081,"./en-il":1594,"./en-il.js":1594,"./en-in":3904,"./en-in.js":3904,"./en-nz":1507,"./en-nz.js":1507,"./en-sg":9409,"./en-sg.js":9409,"./eo":2177,"./eo.js":2177,"./es":4805,"./es-do":9155,"./es-do.js":9155,"./es-mx":9791,"./es-mx.js":9791,"./es-us":6098,"./es-us.js":6098,"./es.js":4805,"./et":6240,"./et.js":6240,"./eu":391,"./eu.js":391,"./fa":612,"./fa.js":612,"./fi":4220,"./fi.js":4220,"./fil":5570,"./fil.js":5570,"./fo":5466,"./fo.js":5466,"./fr":4461,"./fr-ca":6306,"./fr-ca.js":6306,"./fr-ch":7081,"./fr-ch.js":7081,"./fr.js":4461,"./fy":3484,"./fy.js":3484,"./ga":6957,"./ga.js":6957,"./gd":2978,"./gd.js":2978,"./gl":9866,"./gl.js":9866,"./gom-deva":5011,"./gom-deva.js":5011,"./gom-latn":4724,"./gom-latn.js":4724,"./gu":1601,"./gu.js":1601,"./he":9802,"./he.js":9802,"./hi":9358,"./hi.js":9358,"./hr":3907,"./hr.js":3907,"./hu":218,"./hu.js":218,"./hy-am":533,"./hy-am.js":533,"./id":2844,"./id.js":2844,"./is":7353,"./is.js":7353,"./it":6364,"./it-ch":774,"./it-ch.js":774,"./it.js":6364,"./ja":6008,"./ja.js":6008,"./jv":8221,"./jv.js":8221,"./ka":2417,"./ka.js":2417,"./kk":4452,"./kk.js":4452,"./km":6149,"./km.js":6149,"./kn":4572,"./kn.js":4572,"./ko":659,"./ko.js":659,"./ku":6285,"./ku.js":6285,"./ky":1609,"./ky.js":1609,"./lb":119,"./lb.js":119,"./lo":1748,"./lo.js":1748,"./lt":1973,"./lt.js":1973,"./lv":1347,"./lv.js":1347,"./me":3023,"./me.js":3023,"./mi":5747,"./mi.js":5747,"./mk":4341,"./mk.js":4341,"./ml":3840,"./ml.js":3840,"./mn":2058,"./mn.js":2058,"./mr":9182,"./mr.js":9182,"./ms":5197,"./ms-my":9136,"./ms-my.js":9136,"./ms.js":5197,"./mt":6408,"./mt.js":6408,"./my":1683,"./my.js":1683,"./nb":3141,"./nb.js":3141,"./ne":9344,"./ne.js":9344,"./nl":4703,"./nl-be":4641,"./nl-be.js":4641,"./nl.js":4703,"./nn":9873,"./nn.js":9873,"./oc-lnc":1217,"./oc-lnc.js":1217,"./pa-in":4612,"./pa-in.js":4612,"./pl":4457,"./pl.js":4457,"./pt":1089,"./pt-br":9146,"./pt-br.js":9146,"./pt.js":1089,"./ro":5950,"./ro.js":5950,"./ru":7292,"./ru.js":7292,"./sd":6774,"./sd.js":6774,"./se":7493,"./se.js":7493,"./si":3761,"./si.js":3761,"./sk":9711,"./sk.js":9711,"./sl":8558,"./sl.js":8558,"./sq":8633,"./sq.js":8633,"./sr":688,"./sr-cyrl":7903,"./sr-cyrl.js":7903,"./sr.js":688,"./ss":1991,"./ss.js":1991,"./sv":7020,"./sv.js":7020,"./sw":5891,"./sw.js":5891,"./ta":5714,"./ta.js":5714,"./te":206,"./te.js":206,"./tet":4768,"./tet.js":4768,"./tg":8276,"./tg.js":8276,"./th":7977,"./th.js":7977,"./tk":6928,"./tk.js":6928,"./tl-ph":8046,"./tl-ph.js":8046,"./tlh":1361,"./tlh.js":1361,"./tr":4367,"./tr.js":4367,"./tzl":627,"./tzl.js":627,"./tzm":2636,"./tzm-latn":8148,"./tzm-latn.js":8148,"./tzm.js":2636,"./ug-cn":1204,"./ug-cn.js":1204,"./uk":461,"./uk.js":461,"./ur":1366,"./ur.js":1366,"./uz":3454,"./uz-latn":8374,"./uz-latn.js":8374,"./uz.js":3454,"./vi":8572,"./vi.js":8572,"./x-pseudo":464,"./x-pseudo.js":464,"./yo":3709,"./yo.js":3709,"./zh-cn":5873,"./zh-cn.js":5873,"./zh-hk":7549,"./zh-hk.js":7549,"./zh-mo":2240,"./zh-mo.js":2240,"./zh-tw":405,"./zh-tw.js":405};function o(e){var t=a(e);return s(t)}function a(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=5358}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=e,function(){var e=[];s.O=function(t,i,o,a){if(!i){var n=1/0;for(u=0;u<e.length;u++){i=e[u][0],o=e[u][1],a=e[u][2];for(var l=!0,r=0;r<i.length;r++)(!1&a||n>=a)&&Object.keys(s.O).every(function(e){return s.O[e](i[r])})?i.splice(r--,1):(l=!1,a<n&&(n=a));if(l){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[i,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){s.p="/{SLN_PWA_DIST_PATH}/"}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,a,n=i[0],l=i[1],r=i[2],d=0;if(n.some(function(t){return 0!==e[t]})){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(r)var u=r(s)}for(t&&t(i);d<n.length;d++)a=n[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},i=self["webpackChunksalon_booking_plugin_pwa"]=self["webpackChunksalon_booking_plugin_pwa"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],function(){return s(3044)});i=s.O(i)})();
//# sourceMappingURL=app.js.map